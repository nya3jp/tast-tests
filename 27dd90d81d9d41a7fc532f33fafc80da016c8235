{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "4e09e766_391177f8",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 61,
      "author": {
        "id": 1166720
      },
      "writtenOn": "2022-01-31T05:44:47Z",
      "side": 1,
      "message": "Sorry I missed this earlier.\nsectionAttribute() parses this output. Use of CombinedOutput for parsing is generally avoided because it may have both stderr and stdout without detereministic order.\nIf we know which stream actually contains the needed information, we should use that.\nhttps://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/code_review_comments.md#combinedoutput",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "50ac6d27_e7e85c28",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 61,
      "author": {
        "id": 1402113
      },
      "writtenOn": "2022-02-02T01:58:57Z",
      "side": 1,
      "message": "There are two different types of usages of `runCommandLine` in this test.\n\n1) Just running command line. In this case we are interested in any output from a run, just everything, both stderr and stdout. Also in this case we are interested to see the output regardless of return value of command line invocation (doesn\u0027t matter, success of failure, we need all output).\n\n2) Running command line and parsing the output. In this case we are interested in stdout, because if there is an error that means nothing to parse.\n\nAt the moment using `CombinedOutput` covers both cases nicely and compactly.\n\nIt covers 1) because we need any output.\nIn case of 2) we have\n2a) normal execution, output contains stdout only, parsing goes ahead successfully\n2b) something went wrong, output contains both stderr and stdout. Then parsing will fail, and test will fail as well, which is WAI.\n\nI thought about it for a while, but I came to a conclusion that re-writing `runCommandLine` with conditional statements, or splitting it into two different functions would just bloat the code without giving any benefits.\nWhat do you think?",
      "parentUuid": "4e09e766_391177f8",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab85fd12_df0597ff",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 61,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2022-02-02T11:53:14Z",
      "side": 1,
      "message": "Recommendation:\noutput the both stdout/stderr to a log file always. Preserve some of them (maybe on failure) to output directory.\nLet it return stdout only for parsing.\n\nmixing up stdout/stderr does not sound a good design anyways.",
      "parentUuid": "50ac6d27_e7e85c28",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d52d7dcd_14777e60",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 61,
      "author": {
        "id": 1402113
      },
      "writtenOn": "2022-02-03T07:29:28Z",
      "side": 1,
      "message": "How do I get both stdout and stderr while running command only once? Maybe I am missing something, but I don\u0027t see anything except for CombinedOutput that can give me both. `cmd.Output()` gives only stdout. I can\u0027t run command second time to get stderr.",
      "parentUuid": "ab85fd12_df0597ff",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1caf38f8_7cc63cab",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 61,
      "author": {
        "id": 1166720
      },
      "writtenOn": "2022-02-04T00:41:03Z",
      "side": 1,
      "message": "Please see the linked page in my previous comment. The section has an example of reading stderr.\n\nTast\u0027s testexec.CommandContext uses exec.Cmd in golang standard libs.\nhttps://pkg.go.dev/os/exec#Cmd\nIn the same was done for exec.Cmd, we can set a Writer to the class to get each Stdout and Stderr.\n\n    var stderr bytes.Buffer\n    cmd.Stderr \u003d \u0026stderr",
      "parentUuid": "d52d7dcd_14777e60",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9ae104f_3b252073",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 61,
      "author": {
        "id": 1402113
      },
      "writtenOn": "2022-02-07T03:20:47Z",
      "side": 1,
      "message": "I read the linked page, but it assumes that only one is needed: either stdout or stderr. In this case we always need both.\ncmd.CombinedOutput() seems like exactly what is needed: it always gives both stdout and stderr. It already exists in the library, and it is used in many places. Why we can\u0027t just use this library function, like lots of other tests are doing?\n\nMore importantly, I wanted to say that running flashrom via command line (subprocess) is a temporary solution. We are in process of upgrading everything to use libflashrom (a library, not subprocess), this effort is literally happening right now. So the end result for all flashrom tests will be to use libflashrom. Which means, code around command line invocations will be changed. We do need Go cgo bindings for this, but that\u0027s a matter of time.",
      "parentUuid": "1caf38f8_7cc63cab",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "370ce1d3_1aac1832",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 61,
      "author": {
        "id": 1166720
      },
      "writtenOn": "2022-02-07T05:31:38Z",
      "side": 1,
      "message": "\u003e it assumes that only one is needed: either stdout or stderr.\nNo. We can set different Writer objects to each, cmd.Stderr and cmd.Stdout, so that we can get two outputs separately by running cmd.Run().\nhttps://pkg.go.dev/os/exec#Cmd\n\nThere was a test flakiness issue caused by relying on the order of the combined stdout and stderr in the past. Lots of other tests uses it, meaning that they should be examined for if they have the same flakiness.\n\nWhat I think necessary is:\n- Do not parse results originated from CombinedOutput() for any test assertions. \nAnd some recommendations:\n- It may be acceptable to write CombinedOutput result if it is just for the purpose of human readers. (to a dedicated output file separated from the log)\n- However I still recommend to output them to separate files, like \"foo_stderr.txt\" and \"foo_stdout.txt\".",
      "parentUuid": "c9ae104f_3b252073",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d4df0a84_232f3f22",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 61,
      "author": {
        "id": 1402113
      },
      "writtenOn": "2022-02-14T03:02:14Z",
      "side": 1,
      "message": "I re-wrote runCommandLine, it does not use CombinedOutput anymore.",
      "parentUuid": "370ce1d3_1aac1832",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ec4b9e96_5a63d2e7",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 228,
      "author": {
        "id": 1166720
      },
      "writtenOn": "2022-01-31T05:44:47Z",
      "side": 1,
      "message": "For these functions using command execution, I still think reporting error from the Command class in case of execution failure is usually better.\nIt is because that err can tell what happened in case the command execution itself failed (e.g. command not found) even before the program can write something to stderr/stdout.\n\nExample:\nhttps://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go;l\u003d229;drc\u003d9ec715139635146810e152efafb79da23dabff55",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "81654737_c28fc72c",
        "filename": "src/chromiumos/tast/remote/bundles/cros/firmware/fw_flash_erasers.go",
        "patchSetId": 17
      },
      "lineNbr": 228,
      "author": {
        "id": 1402113
      },
      "writtenOn": "2022-02-02T01:58:57Z",
      "side": 1,
      "message": "I added err into fatal message for flashromRead and flashromWrite, so now if err contains some useful information it will also be logged.",
      "parentUuid": "ec4b9e96_5a63d2e7",
      "revId": "27dd90d81d9d41a7fc532f33fafc80da016c8235",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}