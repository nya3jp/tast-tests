{
  "comments": [
    {
      "key": {
        "uuid": "93e99404_2ad98eab",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 54,
      "author": {
        "id": 1313390
      },
      "writtenOn": "2020-02-13T14:48:33Z",
      "side": 1,
      "message": "Is there a reason these exist, and the same logic in `/tast/local/session/ownership.go`. The remote vs local location seems to be the only real difference",
      "range": {
        "startLine": 54,
        "startChar": 23,
        "endLine": 54,
        "endChar": 39
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "98f5a0a4_6ef92f81",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 54,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2020-02-13T15:16:57Z",
      "side": 1,
      "message": "/tast/local/session/ownership.go only deletes the files. This actually resets the TPM and performs a reboot.",
      "parentUuid": "93e99404_2ad98eab",
      "range": {
        "startLine": 54,
        "startChar": 23,
        "endLine": 54,
        "endChar": 39
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ae2911d_5dc587e3",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 95,
      "author": {
        "id": 1313390
      },
      "writtenOn": "2020-02-13T14:48:33Z",
      "side": 1,
      "message": "Is it worth checking if the TPM is owned prior to running through the full clear + reboot?",
      "range": {
        "startLine": 95,
        "startChar": 5,
        "endLine": 95,
        "endChar": 23
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5e3912ad_335cbfd8",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 95,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2020-02-13T15:16:57Z",
      "side": 1,
      "message": "Line 105.",
      "parentUuid": "5ae2911d_5dc587e3",
      "range": {
        "startLine": 95,
        "startChar": 5,
        "endLine": 95,
        "endChar": 23
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0667d18a_b222b823",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 95,
      "author": {
        "id": 1313390
      },
      "writtenOn": "2020-02-13T16:26:39Z",
      "side": 1,
      "message": "so `TPM Ready: false` is \u003d\u003d `TPM Owned: false`?\n\nIs there ever a time when they !\u003d? And why do both exist in the status?",
      "parentUuid": "5e3912ad_335cbfd8",
      "range": {
        "startLine": 95,
        "startChar": 5,
        "endLine": 95,
        "endChar": 23
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64d1c9ee_07791961",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 95,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2020-02-13T16:53:47Z",
      "side": 1,
      "message": "`TPM Ready: false` and `TPM Owned: false` are not equivalent, but not owned certainly means not ready as the TPM has not been initialized.\n\nhttps://osscs.corp.google.com/chromiumos/chromiumos/codesearch/+/master:src/platform2/cryptohome/tpm_init.h;l\u003d74",
      "parentUuid": "0667d18a_b222b823",
      "range": {
        "startLine": 95,
        "startChar": 5,
        "endLine": 95,
        "endChar": 23
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e982e569_60b67ea1",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 95,
      "author": {
        "id": 1313390
      },
      "writtenOn": "2020-02-13T17:26:37Z",
      "side": 1,
      "message": "huh good to know. I am going to swap autotest (still lots of device tests there!) to use ready rather than owned. Seems safer.",
      "parentUuid": "64d1c9ee_07791961",
      "range": {
        "startLine": 95,
        "startChar": 5,
        "endLine": 95,
        "endChar": 23
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "71b12ea7_23ba6a66",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 105,
      "author": {
        "id": 1313390
      },
      "writtenOn": "2020-02-13T14:48:33Z",
      "side": 1,
      "message": "should this polled as done in L134? And if so, can we make the polling a simple fx this line and 133 call",
      "range": {
        "startLine": 105,
        "startChar": 25,
        "endLine": 105,
        "endChar": 35
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "56c86019_e852cb37",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 105,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2020-02-13T15:16:57Z",
      "side": 1,
      "message": "This is a check to see if ownership is not taken. This is a shortcut if there is nothing to do.",
      "parentUuid": "71b12ea7_23ba6a66",
      "range": {
        "startLine": 105,
        "startChar": 25,
        "endLine": 105,
        "endChar": 35
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0a0e019e_bfa37c0a",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 105,
      "author": {
        "id": 1313390
      },
      "writtenOn": "2020-02-13T16:26:39Z",
      "side": 1,
      "message": "Agreed, but it looks like L134 polls to ensure the call to cryptohome doesn\u0027t bomb?\n\nIs there a chance there would be a reboot directly before this fx is called, thus resulting in the error from bug:879797? That is why I am asking to make L105 --\u003e L108 a poll to ensure cryptohome is up and rady",
      "parentUuid": "56c86019_e852cb37",
      "range": {
        "startLine": 105,
        "startChar": 25,
        "endLine": 105,
        "endChar": 35
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb3c5199_e4afa91f",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 105,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2020-02-13T16:53:47Z",
      "side": 1,
      "message": "L134 waits until the reboot is complete (it fails to connect in the meantime). I will test tomorrow what happens if the check is done after reboot right when the DUT becomes responsive.\n\nWhile testing\nhttps://chromium-review.googlesource.com/c/chromiumos/platform/tast-tests/+/2011847\nwhich contains two tests that perform reboots at the end I did not encounter any issues.",
      "parentUuid": "0a0e019e_bfa37c0a",
      "range": {
        "startLine": 105,
        "startChar": 25,
        "endLine": 105,
        "endChar": 35
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2514bd0f_04e78231",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 105,
      "author": {
        "id": 1313390
      },
      "writtenOn": "2020-02-18T14:35:50Z",
      "side": 1,
      "message": "It still seems much safer to wrap this in the same wait/try. Just because your single Chromebook does not have doesn\u0027t have a slow reboot, does not guarantee the hundreds in a lab won\u0027t flake out here.\n\nIf we have a call that we are intentionally wrapping in a poll due known flake with reboots, we should always wrap that call in a poll, since we do not know what will always be happening prior to this util.",
      "parentUuid": "eb3c5199_e4afa91f",
      "range": {
        "startLine": 105,
        "startChar": 25,
        "endLine": 105,
        "endChar": 35
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d0a0588_f0fc49c7",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 125,
      "author": {
        "id": 1313390
      },
      "writtenOn": "2020-02-13T14:48:33Z",
      "side": 1,
      "message": "Is there not a common function out there that already does TPM clearing? The fx above \"EnsureTPMIsReset\" seems like it should contain the file removal as well, then this could call that?\n\nIt seems like splitting there two function\u0027s doesn\u0027t really make sense. In the parent CL this fx `EnsureOwnerIsReset` is what is being called to do the TPM clear.\n\nTl;dr, I vote to move all of this logic into EnsureTPMIsReset (better naming imo), then make this function check if the TPM is ready, and have EnsureTPMIsReset call this.",
      "range": {
        "startLine": 113,
        "startChar": 0,
        "endLine": 125,
        "endChar": 69
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39b5d1bd_303e361d",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 125,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2020-02-13T15:16:57Z",
      "side": 1,
      "message": "EnsureOwnerIsReset doe not requre initializing CmdRunnerRemote, UtilityCryptohomeBinary and HelperRemote in each test by encapsulating all that setup.\n\nI am open to any other way to make this ergonomic in tests.",
      "parentUuid": "2d0a0588_f0fc49c7",
      "range": {
        "startLine": 113,
        "startChar": 0,
        "endLine": 125,
        "endChar": 69
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "10fbd39c_aebb6828",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 142,
      "author": {
        "id": 1313390
      },
      "writtenOn": "2020-02-13T14:48:33Z",
      "side": 1,
      "message": "could we make this a fx \"WaitForTPMReady\"?\n\ncan we get the \"isReady\" state from the poll as well and rm L140-142",
      "range": {
        "startLine": 133,
        "startChar": 0,
        "endLine": 142,
        "endChar": 89
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19974284_da0cdeb5",
        "filename": "src/chromiumos/tast/remote/hwsec/helpers_remote.go",
        "patchSetId": 2
      },
      "lineNbr": 142,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2020-02-13T15:16:57Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "10fbd39c_aebb6828",
      "range": {
        "startLine": 133,
        "startChar": 0,
        "endLine": 142,
        "endChar": 89
      },
      "revId": "7ed2d27313d931e69038ebb78728f394dc30187d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}