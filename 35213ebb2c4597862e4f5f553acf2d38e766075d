{
  "comments": [
    {
      "key": {
        "uuid": "c1543884_82162529",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/scan_perf.go",
        "patchSetId": 3
      },
      "lineNbr": 93,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2020-05-27T21:03:44Z",
      "side": 1,
      "message": "so, the original test just ignored failures due to conflict, and you\u0027re choosing to poll instead?\n\nSeems like we should tell Shill to stop managing the device instead. Otherwise, you really have no guarantee the your \u0027iw\u0027-based scan will ever succeed.\n\n(BTW, I don\u0027t like this pattern in general, of having both Shill and iw operating on the device. It\u0027s the source of all sorts of flake.)",
      "range": {
        "startLine": 93,
        "startChar": 0,
        "endLine": 93,
        "endChar": 121
      },
      "revId": "35213ebb2c4597862e4f5f553acf2d38e766075d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "864ae022_9883a33c",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/scan_perf.go",
        "patchSetId": 3
      },
      "lineNbr": 93,
      "author": {
        "id": 1001853
      },
      "writtenOn": "2020-05-28T16:15:56Z",
      "side": 1,
      "message": "The Autotest version [1] uses self.context.client.timed_scan(). It uses poll_for_condition() [2]. You may refer to the iw_runner.timed_scan() [3], which just ignore device busy case.\n\nYes you are right, having potential failures of resource conflict is the source of test flakiness. However, what I don\u0027t quite know if how to measure \"background full scan\" if we ask shill to disable wifi technology temporary. Can you give me some hint?\n\n[1] https://source.corp.google.com/chromeos_public/src/third_party/autotest/files/server/site_tests/network_WiFi_ScanPerformance/network_WiFi_ScanPerformance.py;l\u003d48?q\u003dautotest%2Ffiles%2Fserver%20package:%5Echromeos_public$%20network_WiFi_ScanPerformance\n[2] https://source.corp.google.com/chromeos_public/src/third_party/autotest/files/server/cros/network/wifi_client.py;l\u003d536?q\u003dWiFiClient\u0026ss\u003dpiper%2FGoogle%2Fchromeos_public:src%2Fthird_party%2Fautotest%2Ffiles%2F\n[3] https://source.corp.google.com/chromeos_public/src/third_party/autotest/files/client/common_lib/cros/network/iw_runner.py;l\u003d869?q\u003dtimed_scan\u0026ss\u003dpiper%2FGoogle%2Fchromeos_public:src%2Fthird_party%2Fautotest%2Ffiles%2Fclient%2F",
      "parentUuid": "c1543884_82162529",
      "range": {
        "startLine": 93,
        "startChar": 0,
        "endLine": 93,
        "endChar": 121
      },
      "revId": "35213ebb2c4597862e4f5f553acf2d38e766075d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8f565e0b_08c77bc7",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/scan_perf.go",
        "patchSetId": 3
      },
      "lineNbr": 93,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2020-06-02T19:06:13Z",
      "side": 1,
      "message": "\u003e The Autotest version [1] uses self.context.client.timed_scan(). It uses poll_for_condition() [2]. You may refer to the iw_runner.timed_scan() [3], which just ignore device busy case.\n\nAh, thanks for the pointer. Indeed, I missed the poll_for_condition() usage. My mistake.\n\n\u003e Yes you are right, having potential failures of resource conflict is the source of test flakiness. However, what I don\u0027t quite know if how to measure \"background full scan\" if we ask shill to disable wifi technology temporary. Can you give me some hint?\n\nGood point, sorry I missed that.\n\nOne could just use the D-Bus API to start scans (Manager.RequestScan(\"wifi\")) and watch for the Device.Scanning property to move false-\u003etrue-\u003efalse.\n\nOne could also monitor wpa_supplicant directly, with something similar to \u0027wpa_mon\u0027 that Matthew was implementing for Autotest:\nhttps://chromium-review.googlesource.com/c/chromiumos/third_party/autotest/+/2166762\n\nOr even watch wpa_supplicant on D-Bus, similar to what I just noted for DisconnectReason:\nhttps://bugs.chromium.org/p/chromium/issues/detail?id\u003d1041325#c4\n\n---\n\nI guess one thing I would *not* like: for this test to use too many different mechanisms for initiating and monitoring scans. So if there aren\u0027t good ways to cover all cases without using \u0027iw ... scan\u0027, then we might just be able to stick with \u0027iw\u0027 -- polling for a succeeding case has apparently worked well enough in the past...",
      "parentUuid": "864ae022_9883a33c",
      "range": {
        "startLine": 93,
        "startChar": 0,
        "endLine": 93,
        "endChar": 121
      },
      "revId": "35213ebb2c4597862e4f5f553acf2d38e766075d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "efaccf96_921354d3",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/scan_perf.go",
        "patchSetId": 3
      },
      "lineNbr": 114,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-05-27T02:59:39Z",
      "side": 1,
      "message": "minor note: Autotest will just fail here. (i.e. outside Poll) I guess retry for this case is more friendly for non-lab open air environments. But the meaning of the test might be slightly different. (original: one single scan finished in timeout \u0026\u0026 ssid scaned in this scan; now: ssid scaned in timeout)\n\nThe bug of the test does not say much about the motivation: crbug.com/344050, so this looks good to me.",
      "revId": "35213ebb2c4597862e4f5f553acf2d38e766075d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4477d4ce_36127a24",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/scan_perf.go",
        "patchSetId": 3
      },
      "lineNbr": 114,
      "author": {
        "id": 1001853
      },
      "writtenOn": "2020-05-27T03:42:03Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "efaccf96_921354d3",
      "revId": "35213ebb2c4597862e4f5f553acf2d38e766075d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}