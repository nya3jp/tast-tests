{
  "comments": [
    {
      "key": {
        "uuid": "2b1ed679_c09dd53a",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/network_listeners_arc.go",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1000985
      },
      "writtenOn": "2020-03-09T17:43:08Z",
      "side": 1,
      "message": "This shouldn\u0027t be listening on all interfaces, should it?",
      "range": {
        "startLine": 34,
        "startChar": 5,
        "endLine": 34,
        "endChar": 6
      },
      "revId": "29e14129fcf810f27e88c12b843716f525f5e27b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "776ccfa4_87d31235",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/network_listeners_arc.go",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1346383
      },
      "writtenOn": "2020-03-10T04:08:00Z",
      "side": 1,
      "message": "We actually would like it to listen on all interfaces (or at least physical interfaces).\n\nCurrently any connections not handled by the host will be retried to ARC (go/arc++inbound). This means if a user connects to \u003cDUT:5555\u003e, it essentially reaches ARC\u0027s ADB. Now that we support non-TCP ADB connections, we\u0027d like to route connection to \u003cDUT:5555\u003e to adb-proxy too, by listening on the host.",
      "parentUuid": "2b1ed679_c09dd53a",
      "range": {
        "startLine": 34,
        "startChar": 5,
        "endLine": 34,
        "endChar": 6
      },
      "revId": "29e14129fcf810f27e88c12b843716f525f5e27b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "794e0d7d_e5828cd3",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/network_listeners_arc.go",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2020-03-10T04:19:24Z",
      "side": 1,
      "message": "\u003e we\u0027d like to route connection to \u003cDUT:5555\u003e to adb-proxy too\n\nThe why are explained in details in b/129907372 and children bugs, but in summary the main reasons are:\n - improve adb stability (no dependency on Android networking)\n - necessary for reverting a bunch of hacks in Android netd (b/121294898)\n - helps abstracting over arcvm / arc++ exact datapath setup (atm they have different IPv4s assigned)",
      "parentUuid": "776ccfa4_87d31235",
      "range": {
        "startLine": 34,
        "startChar": 5,
        "endLine": 34,
        "endChar": 6
      },
      "revId": "29e14129fcf810f27e88c12b843716f525f5e27b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8e8e5893_1eaad2a3",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/network_listeners_arc.go",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1000985
      },
      "writtenOn": "2020-03-11T01:59:43Z",
      "side": 1,
      "message": "Remind me again if this is listening at all times or only when sideloading is enabled?",
      "parentUuid": "794e0d7d_e5828cd3",
      "range": {
        "startLine": 34,
        "startChar": 5,
        "endLine": 34,
        "endChar": 6
      },
      "revId": "29e14129fcf810f27e88c12b843716f525f5e27b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3e6b7c18_7d6de344",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/network_listeners_arc.go",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1346383
      },
      "writtenOn": "2020-03-11T02:02:49Z",
      "side": 1,
      "message": "This is listening at all times.",
      "parentUuid": "8e8e5893_1eaad2a3",
      "range": {
        "startLine": 34,
        "startChar": 5,
        "endLine": 34,
        "endChar": 6
      },
      "revId": "29e14129fcf810f27e88c12b843716f525f5e27b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "476e2158_e587af21",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/network_listeners_arc.go",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1000985
      },
      "writtenOn": "2020-03-11T02:05:25Z",
      "side": 1,
      "message": "I\u0027m not sure it\u0027s great to have this firewall hole open to external traffic by default on all devices on base images.\n\nWhat are other options here?",
      "parentUuid": "3e6b7c18_7d6de344",
      "range": {
        "startLine": 34,
        "startChar": 5,
        "endLine": 34,
        "endChar": 6
      },
      "revId": "29e14129fcf810f27e88c12b843716f525f5e27b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9475f35e_b46507ee",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/network_listeners_arc.go",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1346383
      },
      "writtenOn": "2020-03-11T02:20:59Z",
      "side": 1,
      "message": "We discussed:\n- Routing *:5555 to localhost:5550. This needs additional \u0027route_localnet\u0027 on all physical interfaces. Also essentially opens *:5555 just with different way.\n\n(I did not test) We might be able to only start this whenever ARC ADB is enabled. Wdyt?\nI don\u0027t have any other options as of now. Let me try to brainstorm too.\n\nOne quick note is that, at the moment, even if there is no *:5555 listening, we can connect to \u003cDUT:5555\u003e whenever ADB is enabled because of go/arc++inbound.",
      "parentUuid": "476e2158_e587af21",
      "range": {
        "startLine": 34,
        "startChar": 5,
        "endLine": 34,
        "endChar": 6
      },
      "revId": "29e14129fcf810f27e88c12b843716f525f5e27b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ff7a00eb_8ee1c3c1",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/network_listeners_arc.go",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2020-03-11T03:56:55Z",
      "side": 1,
      "message": "\u003e. This is listening at all times.\n\nNot really, only when ARC is enabled.\n\n\u003e  listening at all times or only when sideloading is enabled?\n\nIt is not enough to scope it to just sideloading enabled, because we still have to support people enabling adbd and connecting over :5555. I think this requires dev mode atm. Sideloading will allow them to stay in safe mode and have adbd running, but that does not help with external remote adb clients. We could manage to tell from the ARC side if adbd is running and then use that trigger the listening on *:5555.\n\n\n\u003e What are other options here?\n\nWe can also decide not to add any additional listening on :5555 on all images and take on the regression in adb connection stability caused by my reverts of the netd hacks in m82. In practice anybody with an adb connection going directly to adb will see the connection drop when:\n - a VPN network connect or disconnect\n - the default network changes inside Android (typically another higher priority network connected).\n\nWhat are no regressions are losing the network when there is one only, or losing the network  which the adb client \n\nUltimately it is more important to unfork Android netd, and with adb sideloading we have a migration story for people affected. So extending the listening on *:5555 when sideloading is enabled looks like a good compromise.",
      "parentUuid": "9475f35e_b46507ee",
      "range": {
        "startLine": 34,
        "startChar": 5,
        "endLine": 34,
        "endChar": 6
      },
      "revId": "29e14129fcf810f27e88c12b843716f525f5e27b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3a427d0e_bd29369c",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/network_listeners_arc.go",
        "patchSetId": 1
      },
      "lineNbr": 34,
      "author": {
        "id": 1000985
      },
      "writtenOn": "2020-03-12T14:45:08Z",
      "side": 1,
      "message": "So we only enable this when ARC++ is enabled, and the only cases where something is listening is sideloading or ADB enabled while in dev mode?\n\nIn that case it might make sense to add a short comment to the test to this effect.",
      "parentUuid": "ff7a00eb_8ee1c3c1",
      "range": {
        "startLine": 34,
        "startChar": 5,
        "endLine": 34,
        "endChar": 6
      },
      "revId": "29e14129fcf810f27e88c12b843716f525f5e27b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}