{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "af9a179b_3e949111",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2022-08-09T08:40:54Z",
      "side": 1,
      "message": "why do you need to poll? \"SetOverviewModeAndWait\" does not wait properly, do you mean?",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d4b352bc_8aebac17",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-08-09T16:24:12Z",
      "side": 1,
      "message": "Thanks for the catch. Yes, `SetOverviewModeAndWait` doesn\u0027t seem to wait enough for all windows actions to be settled (particularly for lacros). Looking at http://cs/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/chrome/ash/overview.go?l\u003d16 there is no wait implemented, but it calls `chrome.autotestPrivate.setOverviewModeState` which I think is async. How would we better address this?",
      "parentUuid": "af9a179b_3e949111",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3d884b4_caad1d8c",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1522762
      },
      "writtenOn": "2022-08-09T17:30:18Z",
      "side": 1,
      "message": "A lot of tests uses: \n\tif err :\u003d ac.WithInterval(2*time.Second).WaitUntilNoEvent(nodewith.Root(), event.LocationChanged)(ctx); err !\u003d nil {\n\t\treturn errors.Wrap(err, \"failed to wait for overview animation to be completed\")\n\t}\nto address that waiting issue.",
      "parentUuid": "d4b352bc_8aebac17",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a26c704_2b7e70f8",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-08-09T18:10:27Z",
      "side": 1,
      "message": "Yup, that\u0027s one way to mitigate this with `uiauto` or we can also consider adding `WaitWindowFinishAnimating` that doesn\u0027t need the instance of `uiauto` to `SetOverviewModeAndWait`. Example: http://cs/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/chrome/ash/wm.go?l\u003d252\nBtw, it probably needs to get https://crrev.com/c/3818763 in first.\n\nHidehiko, can you tell what you think works out best?",
      "parentUuid": "b3d884b4_caad1d8c",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d24cf9b_1d745c37",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2022-08-10T14:06:51Z",
      "side": 1,
      "message": "https://source.chromium.org/chromium/chromium/src/+/main:ash/wm/overview/overview_test_api.cc;l\u003d39;drc\u003d2fb84bdb28dcfe5eb7264f4e2f93ed4434d84f6b\n\nso it is expected that animation is completed here?\nIf not looks like an issue? (or if it is WAI I think it\u0027s better that is explicitly documented to avoid confusion).\n\noshima-san, what\u0027s the expected behavior of the ash?",
      "parentUuid": "3a26c704_2b7e70f8",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "305a851f_a1cc30b0",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-08-10T16:18:22Z",
      "side": 1,
      "message": "(FWIW I saw `setOverviewModeState` return false occasionally in Tast specifically when a lacros window is open. What is a situation this could happen? Is it safe to call it again until it returns true? Would it wait only for the animation to be done but not guarantee that all windows appear in the a11y tree by the time GetAllWindows at L164 is called?)\nAny clarification would be helpful to see whether an extra wait or polling should be added.",
      "parentUuid": "4d24cf9b_1d745c37",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3acea465_9621c7e3",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1001380
      },
      "writtenOn": "2022-08-10T17:51:23Z",
      "side": 1,
      "message": "Isn\u0027t it just because creating lacros windows are async?",
      "parentUuid": "305a851f_a1cc30b0",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1e1a7720_10e2f842",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 162,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-08-15T17:07:51Z",
      "side": 1,
      "message": "Marking as resolved. As Matthew suggested, adding `WaitUntilNoEvent(nodewith.Root(), event.LocationChanged)` after SetOverviewModeAndWait seems to fix this issue. I believe SetOverviewModeAndWait waits for the mode to be on but not for individual windows to be visible which sounds like two independent events to be waited on.",
      "parentUuid": "3acea465_9621c7e3",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "60bb6562_8228c1c3",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 172,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2022-08-09T08:40:54Z",
      "side": 1,
      "message": "nit: s.Fatal(\"Failed to verify the app windows: \", err)",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8b6c482d_627b7217",
        "filename": "src/chromiumos/tast/local/bundles/cros/wmp/admin_templates_launch.go",
        "patchSetId": 1
      },
      "lineNbr": 172,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-08-09T16:24:12Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "60bb6562_8228c1c3",
      "revId": "841357aa0b7f1130bbff55841235a11421f31dec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}