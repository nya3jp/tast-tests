{
  "comments": [
    {
      "key": {
        "uuid": "4b49ce9a_cf484655",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/crosconfig/crosconfig.go",
        "patchSetId": 7
      },
      "lineNbr": 18,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2020-01-30T17:27:20Z",
      "side": 1,
      "message": "cf) https://github.com/golang/go/wiki/CodeReviewComments#in-band-errors\n\nIn go, it is recommended not to do, unless \"unset\" and \"set to an empty value\" mean exact same thing (maybe not, in this case, I think).\n\nOften, we introduce \"ErrNotFound\" or something, and return it as an error, and/or provides \"IsNotFound\" method to check whether the returned error is caused by \"not-found\".",
      "range": {
        "startLine": 17,
        "startChar": 71,
        "endLine": 18,
        "endChar": 32
      },
      "revId": "f076dfe245b583dcd0e4d4bb3e32c581837f3a71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "15baa067_c93cfea8",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/crosconfig/crosconfig.go",
        "patchSetId": 7
      },
      "lineNbr": 18,
      "author": {
        "id": 1296737
      },
      "writtenOn": "2020-01-30T17:34:50Z",
      "side": 1,
      "message": "For most of these properties, we\u0027re only setting them for the subset of boards that support them. For all other boards, an unset value is acceptable, and cros_config returns an empty string. Would it make more sense for me to return something like \"unset\" instead of the empty string? In either case, I don\u0027t want to throw an error when a property is unset since we still want to test the behavior of cros_healthd in these scenarios.",
      "parentUuid": "4b49ce9a_cf484655",
      "range": {
        "startLine": 17,
        "startChar": 71,
        "endLine": 18,
        "endChar": 32
      },
      "revId": "f076dfe245b583dcd0e4d4bb3e32c581837f3a71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f2c630f0_c0630d92",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/crosconfig/crosconfig.go",
        "patchSetId": 7
      },
      "lineNbr": 18,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2020-01-30T18:15:37Z",
      "side": 1,
      "message": "Even if you return an error, call can decide whether or not the test should be continued.\nTo be clear, my recommendation is;\n\ntype errNotFound {\n  *errors.E\n}\n\nfunc IsNotFound(err error) bool {\n  _, ok :\u003d err.(*errNotFound)\n  return ok\n}\n\nfunc Get(...) (string, err) {\n  b, err :\u003d testexec.CommandContext(...).Output(...)\n  if err !\u003d nil {\n     status, ok :\u003d testexec.GetWaitStatus(err)\n     if ok \u0026\u0026 status.ExitStatus() \u003d\u003d 1 {\n       return nil, \u0026errNotFound{E: errors.New(...)}\n     }\n     return nil, err\n  }\n  return strings.TrimSpace(...)\n}\n\n// in test...\nhasSku, err :\u003d crosconfig.Get(...)\nif err !\u003d nil \u0026\u0026 !crosconfig.IsNotFound(err) {\n  s.Fatal(...)\n}\n\nif err !\u003d nil \u0026\u0026 hasSku \u003d\u003d \"true\" {\n  // verify sku !\u003d \"\". \n} else {\n  // verify sku \u003d\u003d \"NA\"\n}\n\nIIUC, this is one of the common pattern in go.\nE.g.: https://golang.org/pkg/os/#IsNotExist\n\nTo verify file does not exist, \n\nif _, err :\u003d os.Stat(...); err !\u003d nil \u0026\u0026 !os.IsNotExist(err) {\n  ...\n}\n\n\nWe should consider whether \"empty string\" and \"unset string\" are identical.\nIn other words, if cros_config does not accept \"setting empty string explicitly\", then returning \"\" is fine, I think. If not, we should consider alternative.\nWDYT?\n\nIn either case, returning \"unset\" is not a way to go I think.",
      "parentUuid": "15baa067_c93cfea8",
      "range": {
        "startLine": 17,
        "startChar": 71,
        "endLine": 18,
        "endChar": 32
      },
      "revId": "f076dfe245b583dcd0e4d4bb3e32c581837f3a71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "46676813_02386241",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/crosconfig/crosconfig.go",
        "patchSetId": 7
      },
      "lineNbr": 18,
      "author": {
        "id": 1296737
      },
      "writtenOn": "2020-01-30T19:30:02Z",
      "side": 1,
      "message": "Thanks! I made the updates as you suggested.\n\nAs for empty string vs. unset string, someone could set a property to an empty string in a model.yaml file, but it would be pretty redundant since that\u0027s what cros_config already returns when the property is unset.",
      "parentUuid": "f2c630f0_c0630d92",
      "range": {
        "startLine": 17,
        "startChar": 71,
        "endLine": 18,
        "endChar": 32
      },
      "revId": "f076dfe245b583dcd0e4d4bb3e32c581837f3a71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "04088889_291f1520",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/crosconfig/crosconfig.go",
        "patchSetId": 7
      },
      "lineNbr": 18,
      "author": {
        "id": 1296737
      },
      "writtenOn": "2020-01-30T19:39:31Z",
      "side": 1,
      "message": "I just thought of another case. If the property is not a string (such as a bool), then you can\u0027t expicitly set the property as an empty string. The user could set the property to true or false (which would make cros_config return \"true\" or \"false\" strings), or it could be left unset, which would make cros_config return \"\".",
      "parentUuid": "46676813_02386241",
      "range": {
        "startLine": 17,
        "startChar": 71,
        "endLine": 18,
        "endChar": 32
      },
      "revId": "f076dfe245b583dcd0e4d4bb3e32c581837f3a71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "57cddd4e_42aaa7db",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/crosconfig/crosconfig.go",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2020-01-30T17:27:20Z",
      "side": 1,
      "message": "Naming: In go, we do not use getter prefixes, like Get, Is, Has etc.\nMaybe just \"Property()\" ?\n\nOr, do you plan to extend this to other types, like int, bool, etc?\nIf not, maybe you can me just \"Get\", which I can find some examples even in Go\u0027s standard lib.",
      "revId": "f076dfe245b583dcd0e4d4bb3e32c581837f3a71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ab206dc7_953fb465",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/crosconfig/crosconfig.go",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1296737
      },
      "writtenOn": "2020-01-30T17:39:26Z",
      "side": 1,
      "message": "I changed it to \"Get\" as you suggested. I\u0027ll put together another CL though to move crosconfig to its own support library.",
      "parentUuid": "57cddd4e_42aaa7db",
      "revId": "f076dfe245b583dcd0e4d4bb3e32c581837f3a71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a8e3f9af_d876488d",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/crosconfig/crosconfig.go",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1296737
      },
      "writtenOn": "2020-01-30T19:30:02Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ab206dc7_953fb465",
      "revId": "f076dfe245b583dcd0e4d4bb3e32c581837f3a71",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}