{
  "comments": [
    {
      "key": {
        "uuid": "f65a0b2b_d8e0434b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-07-08T08:30:26Z",
      "side": 1,
      "message": "cc nya for the question on PreState.OutDir.",
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4adbaa90_809513d6",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/data/scene.pdf",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-07-08T07:07:06Z",
      "side": 1,
      "message": "Do you think it is better to move this to external data file?\n\nhttps://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/writing_tests.md#External-data-files",
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "67b4588e_aec4e490",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/data/scene.pdf",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1271173
      },
      "writtenOn": "2020-07-09T04:31:50Z",
      "side": 1,
      "message": "Hi, after I move the file to google cloud storage, the test will failed with:\nRequired data file scene.pdf missing: failed to download gs://chromiumos-test-assets-public/camerabox/scene.pdf: no devserver is up\n\nIs it because it\u0027s not running in lab environment? Is there any workaround for this if I want to run it in chroot on my workstation?",
      "parentUuid": "4adbaa90_809513d6",
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6667cee8_161dfd59",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 46,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-07-08T07:07:06Z",
      "side": 1,
      "message": "I\u0027m not totally sure if this is good. In current usage, all sub-tests with different parameters will have the same chartPre object so this works. However, if you have multiple tests with this precondition, each of them will create a new object even with a same \"name\" and the inner prepare will still be run once for each object. Is this intended?\n\nIf not, maybe you can do something like keeping a map[string]*chartPre. (but I didn\u0027t see similar usage before.)",
      "range": {
        "startLine": 46,
        "startChar": 8,
        "endLine": 46,
        "endChar": 29
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d590ac09_f47ea345",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 46,
      "author": {
        "id": 1271173
      },
      "writtenOn": "2020-07-09T04:31:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6667cee8_161dfd59",
      "range": {
        "startLine": 46,
        "startChar": 8,
        "endLine": 46,
        "endChar": 29
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "37d50d87_3d6364f1",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 64,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-07-08T07:07:06Z",
      "side": 1,
      "message": "nit: Should we remove the displayOutputLog on chart after GetFile?",
      "range": {
        "startLine": 64,
        "startChar": 2,
        "endLine": 64,
        "endChar": 3
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c498f57f_c521323b",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 64,
      "author": {
        "id": 1271173
      },
      "writtenOn": "2020-07-09T04:31:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "37d50d87_3d6364f1",
      "range": {
        "startLine": 64,
        "startChar": 2,
        "endLine": 64,
        "endChar": 3
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "daeb4185_0ae7649d",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 130,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-07-08T07:07:06Z",
      "side": 1,
      "message": "nit: not sure if these parameters might contain characters which need to be escaped?",
      "range": {
        "startLine": 130,
        "startChar": 33,
        "endLine": 130,
        "endChar": 46
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1e57d513_76ba428e",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 130,
      "author": {
        "id": 1271173
      },
      "writtenOn": "2020-07-09T04:31:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "daeb4185_0ae7649d",
      "range": {
        "startLine": 130,
        "startChar": 33,
        "endLine": 130,
        "endChar": 46
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8173c632_34d8586c",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 170,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-07-08T07:07:06Z",
      "side": 1,
      "message": "nit: This might be dropped as zero value for string is already \"\".",
      "range": {
        "startLine": 168,
        "startChar": 3,
        "endLine": 170,
        "endChar": 3
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f2e621c1_411296cb",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 170,
      "author": {
        "id": 1271173
      },
      "writtenOn": "2020-07-09T04:31:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8173c632_34d8586c",
      "range": {
        "startLine": 168,
        "startChar": 3,
        "endLine": 170,
        "endChar": 3
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "75f3b73e_20c06dfb",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 171,
      "author": {
        "id": 1271173
      },
      "writtenOn": "2020-07-08T07:54:02Z",
      "side": 1,
      "message": "Hi tast owners,\nWould like to know if there\u0027s any docs mention about how to use |testing.PreState.Outdir()|.\nThe |testing.PreState.Outdir()| will point to a directory not exist in chroot environment:\n/tmp/tast/results/20200708-154226/tast_out.20200708-154226.976778533/camera.HAL3Remote.module_back\nWhile the test log directory locate at:\n/tmp/tast/results/20200708-154226/tests/camera.HAL3Remote.module_back",
      "range": {
        "startLine": 171,
        "startChar": 69,
        "endLine": 171,
        "endChar": 77
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "52c26394_4e43f526",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 171,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-07-08T08:30:26Z",
      "side": 1,
      "message": "IIUC, the path from s.OutDir() is a temporary storage path and the one in PreState is currently shared with the test (i.e. Prepare shares the one of the up-comming test, Close shares the one of the last test right before Close). The temporary dir will be renamed after the test exits. (i.e. to the log location you mentioned)\n\nSome information can be found in https://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/writing_tests.md#output-files. (it is for testing.State, but I guess PreState should be similar?)\n\nMay I know the problem you have when operating OutDir?",
      "parentUuid": "75f3b73e_20c06dfb",
      "range": {
        "startLine": 171,
        "startChar": 69,
        "endLine": 171,
        "endChar": 77
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a069d475_1411ac55",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 171,
      "author": {
        "id": 1271173
      },
      "writtenOn": "2020-07-08T09:43:01Z",
      "side": 1,
      "message": "I try to pull chart_service.log from chart to OutDir in |chartPre.Close()|\nL183 src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go \n\nBut the OutDir is somehow gone in |chartPre.Close()|.\nI check that the OutDir used in |testing.State| and |testing.PreState| point to the same location.",
      "parentUuid": "52c26394_4e43f526",
      "range": {
        "startLine": 171,
        "startChar": 69,
        "endLine": 171,
        "endChar": 77
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ffa0b662_62c5d8dc",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 171,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-07-09T02:16:56Z",
      "side": 1,
      "message": "Ah, I probably found the problem. The current code uses outdir as dst in GetFile call which will call RemoveAll(dst). So, the dir is removed and then the file is downloaded to dst but not to path.Join(dst, path.Base(src)). As a result, the framework cannot collect the data in OutDir as it is gone.\n\nBy replacing the call in pre.go:L58 with\n  linuxssh.GetFile(ctx, p.conn, displayOutputLog, filepath.Join(outdir, filepath.Base(displayOutputLog)))\n\nI can successfully see chart_service.log collected in the result.",
      "parentUuid": "a069d475_1411ac55",
      "range": {
        "startLine": 171,
        "startChar": 69,
        "endLine": 171,
        "endChar": 77
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9bd835cd_783baec4",
        "filename": "src/chromiumos/tast/remote/bundles/cros/camera/pre/pre.go",
        "patchSetId": 3
      },
      "lineNbr": 171,
      "author": {
        "id": 1271173
      },
      "writtenOn": "2020-07-09T04:31:50Z",
      "side": 1,
      "message": "Yes, that\u0027s the root cause of my problem. Thanks a lot for investigation on it.",
      "parentUuid": "ffa0b662_62c5d8dc",
      "range": {
        "startLine": 171,
        "startChar": 69,
        "endLine": 171,
        "endChar": 77
      },
      "revId": "ee7b7fd6f8e29f713657dff107f425acfcc74db4",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}