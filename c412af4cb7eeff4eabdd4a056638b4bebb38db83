{
  "comments": [
    {
      "key": {
        "uuid": "b4bc19db_47dcc8ce",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 105,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-02-06T22:55:05Z",
      "side": 1,
      "message": "This triggers a presubmit error (and Close func at L164)\n\nsrc/chromiumos/tast/local/wpr/pre.go:105:50: \u0027testing.State\u0027 should not be used in support packages, except for precondition implementation\n\nBut we have to do this for implementing a testing.Precondition, right?",
      "range": {
        "startLine": 105,
        "startChar": 47,
        "endLine": 105,
        "endChar": 63
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f495dee0_347d77b1",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 105,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-02-07T05:40:21Z",
      "side": 1,
      "message": "Please create another CL in platform/tast to allow this (see https://chromium.googlesource.com/chromiumos/platform/tast/+/refs/heads/master/src/chromiumos/cmd/tast-lint/check/disallow_testingstate.go#21)",
      "parentUuid": "b4bc19db_47dcc8ce",
      "range": {
        "startLine": 105,
        "startChar": 47,
        "endLine": 105,
        "endChar": 63
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0e90724f_65273b07",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 105,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-02-07T21:26:19Z",
      "side": 1,
      "message": "Will do. Thanks for the pointer.",
      "parentUuid": "f495dee0_347d77b1",
      "range": {
        "startLine": 105,
        "startChar": 47,
        "endLine": 105,
        "endChar": 63
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39291aa8_26d6520b",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 137,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-02-06T22:55:05Z",
      "side": 1,
      "message": "This is also a presubmit error. But we have to run WPR process with a Context that stays for all tests that use the pre-condition.",
      "range": {
        "startLine": 137,
        "startChar": 36,
        "endLine": 137,
        "endChar": 56
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "072530f8_d8685783",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 137,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-02-07T05:40:21Z",
      "side": 1,
      "message": "isn\u0027t the \u0027ctx\u0027 (parameter to Prepare) working?",
      "parentUuid": "39291aa8_26d6520b",
      "range": {
        "startLine": 137,
        "startChar": 36,
        "endLine": 137,
        "endChar": 56
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f76d45f6_e237b1a7",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 137,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-02-07T21:26:19Z",
      "side": 1,
      "message": "Unfortunately, |ctx| arg of Prepare does not work.\n\nIt is used to create wpr process via testexec.CommandContext [1]. When |ctx| times out or canceled, the wpr process is killed with it. Prepare is called as a stage [2]. Each stage has its own derived Context [3] and gets canceled when the stage finishes.\n\nWPR process in procondition needs to be alive for all tests that depend on it. A similar case is arc.startLogcat [4] that starts logcat daemon used by multiple tests.\n\n[1] https://cs.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/platform/chromewpr/chromewpr.go?rcl\u003de23c15a6274ba584ec3803b972172aa190698dff\u0026l\u003d179\n\n[2] https://cs.corp.google.com/chromeos_public/src/platform/tast/src/chromiumos/tast/testing/test_instance.go?rcl\u003d3ff970d16ac159dde602c2ddd41a485a3d76855e\u0026l\u003d294\n\n[3] https://cs.corp.google.com/chromeos_public/src/platform/tast/src/chromiumos/tast/testing/stage.go?rcl\u003d3ff970d16ac159dde602c2ddd41a485a3d76855e\u0026l\u003d38\n\n[4] https://cs.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/arc/arc.go?rcl\u003d1676ad7a1418f58f0ef1ea4ccd725cf9d448423d\u0026l\u003d374",
      "parentUuid": "072530f8_d8685783",
      "range": {
        "startLine": 137,
        "startChar": 36,
        "endLine": 137,
        "endChar": 56
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cbcac8f3_caea7d4f",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 137,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-02-10T22:46:03Z",
      "side": 1,
      "message": "Hmm, I see. Let\u0027s go with the current code and wait for the tast-owner\u0027s review.\n\nMaybe we can avoid this by using os/exec package instead of testexec -- though I\u0027m not sure that is a good idea. I\u0027m fine with keeping this as-is.",
      "parentUuid": "f76d45f6_e237b1a7",
      "range": {
        "startLine": 137,
        "startChar": 36,
        "endLine": 137,
        "endChar": 56
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3137d738_0a85635b",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 137,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-02-18T13:36:29Z",
      "side": 1,
      "message": "Sorry, this is a know problem. For now please use context.Background. There\u0027s in-flight proposal to allow preconditions to have access to longer context. crrev.com/c/2050463",
      "parentUuid": "cbcac8f3_caea7d4f",
      "range": {
        "startLine": 137,
        "startChar": 36,
        "endLine": 137,
        "endChar": 56
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "260a1c31_5e9ad529",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 140,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-02-06T22:55:05Z",
      "side": 1,
      "message": "Using Background context has a side effect that we lost logs in wpr.New() call since the Background context does not have logger associated with it.\n\nAny suggestions on how to fix it? Or it does not matter?",
      "range": {
        "startLine": 140,
        "startChar": 22,
        "endLine": 140,
        "endChar": 25
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "180f1bab_57ae7618",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 140,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-02-10T22:46:03Z",
      "side": 1,
      "message": "Hypothetically there\u0027s a way to attach a logger with testing.WithTestContext with your own custom TestContext class with a logger (https://godoc.org/chromium.googlesource.com/chromiumos/platform/tast.git/src/chromiumos/tast/testing#WithTestContext).\n\nBut this would be too hacky and I\u0027m afraid that tast owners wouldn\u0027t be happy with that. Let\u0027s keep this as-is and wait for the replies.  Or, maybe asking to tast-users@chroimum.org might be good.",
      "parentUuid": "260a1c31_5e9ad529",
      "range": {
        "startLine": 140,
        "startChar": 22,
        "endLine": 140,
        "endChar": 25
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "587f693e_2abe1c27",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 140,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-02-18T13:36:29Z",
      "side": 1,
      "message": "If crrev.com/c/2050463 is accepted, the new context will give you access to logging as well. Without it I don\u0027t have any better idea than just using a context derived from context.Background.",
      "parentUuid": "180f1bab_57ae7618",
      "range": {
        "startLine": 140,
        "startChar": 22,
        "endLine": 140,
        "endChar": 25
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "904f6536_1908912c",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 182,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-02-07T05:40:21Z",
      "side": 1,
      "message": "nit: key can be a struct and it would suite with this case with private struct (cf. https://blog.golang.org/go-maps-in-action#TOC_5.) That way you don\u0027t need hash functions.",
      "range": {
        "startLine": 182,
        "startChar": 22,
        "endLine": 182,
        "endChar": 28
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a02a3c81_ad9cd8c0",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 182,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-02-07T21:26:19Z",
      "side": 1,
      "message": "Good to know. Revised to use struct as key.",
      "parentUuid": "904f6536_1908912c",
      "range": {
        "startLine": 182,
        "startChar": 22,
        "endLine": 182,
        "endChar": 28
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9f788223_c6bbd7f3",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 184,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-02-07T05:40:21Z",
      "side": 1,
      "message": "I personally prefer not naming as \u0027newPrecondition\u0027, that is typically for a factory/constructor function in Golang. \"getOrCreatePrecondition()\" might be good.",
      "range": {
        "startLine": 184,
        "startChar": 5,
        "endLine": 184,
        "endChar": 20
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55805fc6_1f5a719a",
        "filename": "src/chromiumos/tast/local/wpr/pre.go",
        "patchSetId": 4
      },
      "lineNbr": 184,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-02-07T21:26:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9f788223_c6bbd7f3",
      "range": {
        "startLine": 184,
        "startChar": 5,
        "endLine": 184,
        "endChar": 20
      },
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b45172ce_d808b27f",
        "filename": "src/chromiumos/tast/local/wpr/wpr.go",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-02-06T22:55:05Z",
      "side": 1,
      "message": "This is a move of chromewpr.go. Not sure why gerrit show it as a new file. Locally, \"git diff\" shows it as a moved file.",
      "revId": "c412af4cb7eeff4eabdd4a056638b4bebb38db83",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}