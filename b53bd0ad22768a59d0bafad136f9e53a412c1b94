{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "73d5ae71_b15a9154",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-26T22:52:09Z",
      "side": 1,
      "message": "bluetoothPrivate flow for PersistenceWifiSansBluetooth now works. A patch on chromium is needed (chromium:2500445) is necessary for this test to work.",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "278dd29d_c4a1347a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-29T03:42:09Z",
      "side": 1,
      "message": "Sorry for the delay. I don\u0027t have much knowledge of BT so some comments are questions rather than actionable suggestions.",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "89351904_5d597031",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2020-10-29T23:07:32Z",
      "side": 1,
      "message": "bluetoothPrivate / javascript is pretty new to me, and I don\u0027t have much to say for it. If you can\u0027t find a decent reviewer for that, I can try my best.\n\nOther stuff LGTM, modulo the few comments Yen-lin and I made.",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bb2e7137_ad71a01a",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/bluetooth_service.go",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-29T03:42:09Z",
      "side": 1,
      "message": "I tried to monitor dbus when changing the setting of BT on UI but does not find anything special. Maybe the persistent setting is stored in some other place?\n\nbluetoothPrivate might be OK, but one downside is: starting chrome can take much time. Also, we\u0027re not yet sure why it does not work with startup window...\n\nabhishekpandit@, do you have some suggestions on how to set/get the persistent BT powered setting?",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd32a82f_4d48ba7b",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/bluetooth_service.go",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-29T05:54:58Z",
      "side": 1,
      "message": "The persistent setting is stored through settingsPrivate. It\u0027s stored as \"ash.system.bluetooth.adapter_enabled\" (This is toggled in line 69 of bluetooth_service.go). You will need to patch chromium in order for this line to work (see chromium:2500445).\n\nBluez does not store a persistence setting, so this is stored in chromium. It\u0027s also a bit confusing that bluetoothPrivate is not responsible for this setting as well. I have filed a bug regarding this behavior in this bug: https://b.corp.google.com/issues/171805553",
      "parentUuid": "bb2e7137_ad71a01a",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "613f8c5c_cde81a91",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/bluetooth_service.go",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-29T06:22:30Z",
      "side": 1,
      "message": "Thanks for the info! The setting is stored in chrome (ash), so we\u0027ll always need the chrome...\n\nGiven this, I wonder if we can modify the GetBluetoothPowered to get the setting from chrome (and this might address another comment)? And then, we can also divide the check into two more detailed part:\n1. the setting in chrome persists after reboot\n2. the behavior in Bluez adapter is consistent with the persistent setting\n\nWDYT? (I\u0027m not really sure if they\u0027re feasible, so just some thoughts)",
      "parentUuid": "fd32a82f_4d48ba7b",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "969a65af_510ecf84",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/bluetooth_service.go",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-30T22:50:27Z",
      "side": 1,
      "message": "This is feasible. The tradeoff is that I have to reinitialize the chrome ui every time I want to access this. I just had the getter return both booleans and let the test poll this function and determine whether to fail early.",
      "parentUuid": "613f8c5c_cde81a91",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "de042127_c0581897",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/bluetooth_service.go",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-11-02T03:34:03Z",
      "side": 1,
      "message": "Yeah, I don\u0027t know a good solution for it now and it is also why I suggested separating the two parts as the persistent setting in chrome shouldn\u0027t need polling and we can save a few chrome initialization there. Current version also LGTM. I\u0027ll take a look if there are other remote tests that need UI information and if we can refine this a little more.",
      "parentUuid": "969a65af_510ecf84",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e200af3_33de091a",
        "filename": "src/chromiumos/tast/local/chrome/chrome.go",
        "patchSetId": 2
      },
      "lineNbr": 824,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-29T03:42:09Z",
      "side": 1,
      "message": "It might be better to separate this part of change into another CL and include maintainers of chrome package to review? Or directly in this CL if you think chrome folks can help with why we need this option for bluetoothPrivate.",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e414fd32_683982d9",
        "filename": "src/chromiumos/tast/local/chrome/chrome.go",
        "patchSetId": 2
      },
      "lineNbr": 824,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2020-10-29T23:07:32Z",
      "side": 1,
      "message": "+1\n\nThis is slightly concerning (and I really enjoy your \"I have no idea\" comment elsewhere), and probably should be reviewed separately. And if we stick with it, maybe it needs a TODO(b/....) comment on the usage, alongside \"I have no idea\".",
      "parentUuid": "5e200af3_33de091a",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6d068d40_dc900db8",
        "filename": "src/chromiumos/tast/local/chrome/chrome.go",
        "patchSetId": 2
      },
      "lineNbr": 824,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-30T22:50:27Z",
      "side": 1,
      "message": "Done. I have moved this to another cl for review.",
      "parentUuid": "e414fd32_683982d9",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ccac99bb_a67ce8f7",
        "filename": "src/chromiumos/tast/local/chrome/extensions.go",
        "patchSetId": 2
      },
      "lineNbr": 129,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-29T03:42:09Z",
      "side": 1,
      "message": "The indent seems to be unmatched. (I think it\u0027s using spaces here)",
      "range": {
        "startLine": 129,
        "startChar": 0,
        "endLine": 129,
        "endChar": 1
      },
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4c674f10_6d90437f",
        "filename": "src/chromiumos/tast/local/chrome/extensions.go",
        "patchSetId": 2
      },
      "lineNbr": 129,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-30T22:50:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ccac99bb_a67ce8f7",
      "range": {
        "startLine": 129,
        "startChar": 0,
        "endLine": 129,
        "endChar": 1
      },
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "574a866f_aba81596",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 37,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-29T03:42:09Z",
      "side": 1,
      "message": "nit: This is used multiple times, maybe worth a clearer variable for it e.g. credKey?",
      "range": {
        "startLine": 37,
        "startChar": 2,
        "endLine": 37,
        "endChar": 68
      },
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "904cb76d_c1a3e798",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 37,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-30T22:50:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "574a866f_aba81596",
      "range": {
        "startLine": 37,
        "startChar": 2,
        "endLine": 37,
        "endChar": 68
      },
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97b0dba6_2914d789",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 104,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-29T03:42:09Z",
      "side": 1,
      "message": "TestFixture will close UI in its init, so I\u0027d suggest moving these outside of this function as the gRPC will start chrome now. It is not harmful for now as TestFixture does not depend much on the assumption.",
      "range": {
        "startLine": 81,
        "startChar": 0,
        "endLine": 104,
        "endChar": 0
      },
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8f285194_dd60de57",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 104,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2020-10-29T23:07:32Z",
      "side": 1,
      "message": "I wonder if we should add a parameter to the TestFixture and/or wifi_service\u0027s InitDUT() to prevent NewTestFixture() stopping Chrome. It\u0027s useful for some cases (to prevent spurious Chrome-requested scans), but not important for basic connection tests like this. Then you don\u0027t need to worry about separating Chrome-dependent and Chrome-clobbering helpers, and you save time too.",
      "parentUuid": "97b0dba6_2914d789",
      "range": {
        "startLine": 81,
        "startChar": 0,
        "endLine": 104,
        "endChar": 0
      },
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c701bbd3_e67031e0",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 104,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-30T10:18:39Z",
      "side": 1,
      "message": "This sounds reasonable. And if we have more tests need interaction with UI, we\u0027ll likely want a precondition. Although Precondition is probably not yet for this test as reboot can destroy the setup + gRPC and will need some more effort to support Reboot there. A quick PoC in crrev.com/c/2509531.",
      "parentUuid": "8f285194_dd60de57",
      "range": {
        "startLine": 81,
        "startChar": 0,
        "endLine": 104,
        "endChar": 0
      },
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d552c272_8078a32d",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 104,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-30T22:50:27Z",
      "side": 1,
      "message": "Done. I have to restart the rpc connection to achieve this.",
      "parentUuid": "c701bbd3_e67031e0",
      "range": {
        "startLine": 81,
        "startChar": 0,
        "endLine": 104,
        "endChar": 0
      },
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b361260_fcac236e",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 122,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-29T03:42:09Z",
      "side": 1,
      "message": "Similar to the case in crrev.com/c/2478322, this might be a potential flake: when the disabled setting does not persist after reboot, it is still possible that we get \"down\" state here if the device is not yet initialized. Then the test will wrongly pass.\n\nWe\u0027ll need a way to tell uninitialized/disabled or to get the persistent setting directly for this test.",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3a28e494_05023616",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 122,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-30T22:50:27Z",
      "side": 1,
      "message": "Done, solved by polling the bluetooth state and persistence state for consistency.",
      "parentUuid": "1b361260_fcac236e",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f47145c6_51254441",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 135,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2020-10-29T23:07:32Z",
      "side": 1,
      "message": "any reason not to run another wifiutil.AssertWifiEnabled()? It actually seems more important to verify here than to verify at L78 -- at 78, we\u0027re just at normal steady-state conditions: both BT and WiFi are enabled and haven\u0027t been messed with. The \"tough\" part is when we\u0027ve disabled one and rebooted.",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0289cba4_11737295",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/persistence_wifi_sans_bluetooth.go",
        "patchSetId": 2
      },
      "lineNbr": 135,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-30T22:50:27Z",
      "side": 1,
      "message": "Done. I agree with your assessment here.",
      "parentUuid": "f47145c6_51254441",
      "revId": "b53bd0ad22768a59d0bafad136f9e53a412c1b94",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}