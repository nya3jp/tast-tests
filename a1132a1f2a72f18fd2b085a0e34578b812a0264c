{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "13e3272b_9c65aeb5",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 10
      },
      "lineNbr": 179,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-29T18:03:55Z",
      "side": 1,
      "message": "I could see this functionality potentially being used in other tast tests across chromeOS. Thoughts on if this should be in its own separate package, maybe under common or local? If so, I will probably do it in another CL for simplicity.",
      "range": {
        "startLine": 154,
        "startChar": 0,
        "endLine": 179,
        "endChar": 1
      },
      "revId": "a1132a1f2a72f18fd2b085a0e34578b812a0264c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e317a967_01d5d0b0",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 10
      },
      "lineNbr": 179,
      "author": {
        "id": 1243287
      },
      "writtenOn": "2022-07-29T22:12:32Z",
      "side": 1,
      "message": "It could be useful in common in case we need to do this for remote tests. Also, could you maybe leave some comments explaining how this all works?",
      "parentUuid": "13e3272b_9c65aeb5",
      "range": {
        "startLine": 154,
        "startChar": 0,
        "endLine": 179,
        "endChar": 1
      },
      "revId": "a1132a1f2a72f18fd2b085a0e34578b812a0264c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a5ef5264_0e5496e9",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 10
      },
      "lineNbr": 179,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-07-29T22:15:03Z",
      "side": 1,
      "message": "I was thinking the same thing myself. Even if we don\u0027t end up using it elsewhere, it would be nice to remove some of the added dependencies to this test.",
      "parentUuid": "13e3272b_9c65aeb5",
      "range": {
        "startLine": 154,
        "startChar": 0,
        "endLine": 179,
        "endChar": 1
      },
      "revId": "a1132a1f2a72f18fd2b085a0e34578b812a0264c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd37083d_00c8596b",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/env/env.go",
        "patchSetId": 10
      },
      "lineNbr": 153,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-29T18:03:55Z",
      "side": 1,
      "message": "I needed to add this as I was running into a scenario where the interface on the global netns was not being removed. It only happened in my parameterized tast test. This fix works for my tast test and had no effect on others.",
      "range": {
        "startLine": 151,
        "startChar": 2,
        "endLine": 153,
        "endChar": 3
      },
      "revId": "a1132a1f2a72f18fd2b085a0e34578b812a0264c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b8a09718_7e218869",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/env/env.go",
        "patchSetId": 10
      },
      "lineNbr": 153,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2022-08-01T00:15:18Z",
      "side": 1,
      "message": "\u003e I needed to add this as I was running into a scenario where the interface on the global netns was not being removed. \n\nWhat about the namespace where the other veth interface of the veth pair is ? Was that namespace correctly removed ? Jie can confirm what the teardown process should do but normally I would not expect that interface to still be around so there might be some other error going on there.\n\nFor instance if you create a netns and add a veth pair across the current netns and that netns:\n  ip netns add bar\n  ip link add foo_left0 type veth peer foo_right0 netns bar\n  ip link show foo_left0\n    31: foo_left0@if2: ...\nthen deleting the netns deletes the interface in the current netns as well:\n  ip netns delete bar\n  ip link show foo_left0\n    Device \"foo_left0\" does not exist.",
      "parentUuid": "fd37083d_00c8596b",
      "range": {
        "startLine": 151,
        "startChar": 2,
        "endLine": 153,
        "endChar": 3
      },
      "revId": "a1132a1f2a72f18fd2b085a0e34578b812a0264c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2b92d594_c07570c8",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/env/env.go",
        "patchSetId": 10
      },
      "lineNbr": 153,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-08-01T01:53:51Z",
      "side": 1,
      "message": "Sorry I just noticed this comment.\n\nTheoretically, the veth should be removed automatically once the netns which contains it is deleted (\"When a namespace is freed, the veth(4) devices that it contains are destroyed\" [1]), as Hugo mentioned.\n\nActually I encountered the same behavior when I was trying to use this for VPNConnect tests. It seems to me that veth may keep existing for 1 ~ 2 seconds in my case after removing the netns, so I use a poll in my patch [2].\n\nYou can use the code in [2] to verify if this is the case here. I\u0027m fine with the code in this patch (delete veth explicitly) since it seems not harmful (except for that this cmd may fail if there is only netns but no veth, which could happen on the failure path in SetUp()), or feel free to use the code in my patch (I\u0027m not going to submit that soon). \n\n\n[1] https://man7.org/linux/man-pages/man7/network_namespaces.7.html\n[2] https://chromium-review.googlesource.com/c/chromiumos/platform/tast-tests/+/3801887/1/src/chromiumos/tast/local/bundles/cros/network/virtualnet/env/env.go",
      "parentUuid": "b8a09718_7e218869",
      "range": {
        "startLine": 151,
        "startChar": 2,
        "endLine": 153,
        "endChar": 3
      },
      "revId": "a1132a1f2a72f18fd2b085a0e34578b812a0264c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}