{
  "comments": [
    {
      "key": {
        "uuid": "24b57c62_301450b6",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/data/low_memory_killer_background.js",
        "patchSetId": 3
      },
      "lineNbr": 5,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "The implementation looks a bit complicated. Could you add document what this does?",
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2783fb4b_8f2513f5",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/data/low_memory_killer_background.js",
        "patchSetId": 3
      },
      "lineNbr": 5,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "24b57c62_301450b6",
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b3e83305_fe563d3b",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/data/low_memory_killer_background.js",
        "patchSetId": 3
      },
      "lineNbr": 13,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "Any error handling is needed?",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 13,
        "endChar": 68
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6e8cb41b_20b492c1",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/data/low_memory_killer_background.js",
        "patchSetId": 3
      },
      "lineNbr": 13,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "To test whether we will detect an error if it happens, I ran those functions with invalid parameters (i.e. non-existent tabId or processId), and the error (TypeError) is successfully propagated to the Go code. Additionally, I checked the API calls at developer.chrome.com/extensions/ and the callback functions do not receive any errors, there is also no error-handling in the example code.",
      "parentUuid": "b3e83305_fe563d3b",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 13,
        "endChar": 68
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2ee8f103_b81f070e",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/data/low_memory_killer_background.js",
        "patchSetId": 3
      },
      "lineNbr": 13,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-03-27T21:58:46Z",
      "side": 1,
      "message": "not sure if it applies here, but many chrome APIs set chrome.runtime.lastError on failure: https://developer.chrome.com/apps/runtime#property-lastError\n\nthere are various other places in tast where we return chrome.runtime.lastError.message",
      "parentUuid": "6e8cb41b_20b492c1",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 13,
        "endChar": 68
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c94411d2_e9282dc5",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/data/low_memory_killer_background.js",
        "patchSetId": 3
      },
      "lineNbr": 13,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-28T15:01:27Z",
      "side": 1,
      "message": "Yes, IIUC, lastError is the field to be checked. Actually, APIs are returning errors. E.g.\nhttps://cs.chromium.org/chromium/src/chrome/browser/extensions/api/processes/processes_api.cc?q\u003dgetProcessIdForTab\u0026sq\u003dpackage:chromium\u0026g\u003d0\u0026l\u003d453\n\nThe error should be propagated so that we can investigate easier in case of failure.\n\n(optional/style): Also, TBH, this looks a bit too nested specifically if you introduce error handling.\nMaybe nice to split into some smaller functions. E.g.;\n\nconst TabPids \u003d function() {\n  function queryTabs() {\n    return new Promise((resolve, reject) \u003d\u003e\n      chrome.tabs.query({}, () \u003d\u003e {\n        if (chrome.runtime.lastError) {\n          reject(new Error(chrome.runtime.lastError.message);\n        } else {\n          resolve(tabs);\n        }\n      }));\n  }\n\n  ... // similar wrapper for getProcessIdForTab, getProcesInfo; or introducing a meta function to return a wrapped function may be another option if it looks not very ugly?\n  \n  return async function() {\n    const tabs \u003d await queryTabs();\n    const pids \u003d tabs.filter(tab \u003d\u003e tab.id).map(async tab \u003d\u003e {\n      return await getProcessIdForTab(tab.id);\n    });\n    const procs \u003d await ...\n    ...\n  }\n}();\n\nWDYT?",
      "parentUuid": "2ee8f103_b81f070e",
      "range": {
        "startLine": 4,
        "startChar": 0,
        "endLine": 13,
        "endChar": 68
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9c32efe_214b1db7",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 132,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "Clar: I guess you don\u0027t need [:] ?",
      "range": {
        "startLine": 132,
        "startChar": 29,
        "endLine": 132,
        "endChar": 36
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8a139123_e7965131",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 132,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f9c32efe_214b1db7",
      "range": {
        "startLine": 132,
        "startChar": 29,
        "endLine": 132,
        "endChar": 36
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8028f731_c34354db",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 139,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "style: In this kind of case, we use\n\nif set, err :\u003d ... ; err !\u003d nil {\n  ...\n} else if !set {\n  ...\n}",
      "range": {
        "startLine": 133,
        "startChar": 3,
        "endLine": 139,
        "endChar": 4
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "34e133b2_f275bf9f",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 139,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8028f731_c34354db",
      "range": {
        "startLine": 133,
        "startChar": 3,
        "endLine": 139,
        "endChar": 4
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "47d80322_396e96f3",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 171,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "nit/style:\n\nvar bgJobs []*testexec.Cmd\n\nfor empty initialization.",
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ab933e56_7d19fd34",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 171,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "47d80322_396e96f3",
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0cb05d81_d6c26e92",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 179,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "We inline this.\n\ndefer func() {\n  for _, cmd :\u003d range bgJobs {\n    ...\n  }\n}()",
      "range": {
        "startLine": 172,
        "startChar": 1,
        "endLine": 179,
        "endChar": 0
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "80ab99af_38f3066d",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 179,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0cb05d81_d6c26e92",
      "range": {
        "startLine": 172,
        "startChar": 1,
        "endLine": 179,
        "endChar": 0
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8478d362_0d61bd95",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 180,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "Do you need to keep the file open?\nShould it be read every time in poll?\nIf this is intentional, could you comment?",
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cac8960e_022523cf",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 180,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "Yes, I keep it open because it is read multiple times on each loop iteration. I added a comment to indicate this.",
      "parentUuid": "8478d362_0d61bd95",
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "241b2d0c_927a5ff7",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 225,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "You can drop them. Then, defer\u0027s function terminates the processes at the end of the function.",
      "range": {
        "startLine": 224,
        "startChar": 1,
        "endLine": 225,
        "endChar": 13
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a07d20d4_3aae18f9",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 225,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "241b2d0c_927a5ff7",
      "range": {
        "startLine": 224,
        "startChar": 1,
        "endLine": 225,
        "endChar": 13
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "276f3ab2_628f060c",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 225,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-03-27T21:58:46Z",
      "side": 1,
      "message": "ah, sorry -- i had assumed that it was important to kill the jobs before continuing in the test function.",
      "parentUuid": "a07d20d4_3aae18f9",
      "range": {
        "startLine": 224,
        "startChar": 1,
        "endLine": 225,
        "endChar": 13
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "30a18134_7e4f36f1",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 227,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "You can move this to L194.\nSo that long-live killEvent variable can be removed.",
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9d802259_8cdda16f",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 227,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "30a18134_7e4f36f1",
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d586ab3e_e6a59925",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 277,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2019-03-27T05:18:24Z",
      "side": 1,
      "message": "score, err :\u003d readOOMScoreAdj(pid)",
      "range": {
        "startLine": 275,
        "startChar": 0,
        "endLine": 277,
        "endChar": 34
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bd4b82d6_c40d4e37",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/low_memory_killer.go",
        "patchSetId": 3
      },
      "lineNbr": 277,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2019-03-27T20:00:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d586ab3e_e6a59925",
      "range": {
        "startLine": 275,
        "startChar": 0,
        "endLine": 277,
        "endChar": 34
      },
      "revId": "a67550b2782fc72319f1a2998716d2094dd7c362",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}