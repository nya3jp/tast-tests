{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "7b852031_58a9941e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-06-16T02:23:07Z",
      "side": 1,
      "message": "(Only took a look at the Env setup)",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8ce3bbd5_8e0e621d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T17:05:47Z",
      "side": 1,
      "message": "I mostly focused on the test itself as I\u0027m still catching up on how the lower layers work.",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e277f24c_c10f2116",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 29,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T17:05:47Z",
      "side": 1,
      "message": "This contains implementation details. It should just describe what we are testing. e.g. \"Ensures that setting up a virtual ethernet pair with an http server results in an online veth Service.\"",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "40ecca83_c045402a",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 29,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-06-16T23:01:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e277f24c_c10f2116",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3bb966a8_aa4aecd7",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 37,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T17:05:47Z",
      "side": 1,
      "message": "We should avoid resetting Shill unless it is part of the test or otherwise necessary. We should assume that Shill is in a reasonable state at the beginning of the test.",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d911ad41_85c50b6a",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 37,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-06-16T23:01:58Z",
      "side": 1,
      "message": "Would an improvement be to use a test profile like you made in shill_veth.go here: https://chromium-review.googlesource.com/c/chromiumos/platform/tast-tests/+/3668362/7/src/chromiumos/tast/local/shill/manager.go#444\n\nThat way we can safely pop the test profile once we are done. LMK if you think this could be useful/necessary.",
      "parentUuid": "3bb966a8_aa4aecd7",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bb701e2d_23fabb91",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 37,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T23:37:20Z",
      "side": 1,
      "message": "Yes, that is probably a good idea. I forgot about that helpful part from that CL :-) I\u0027ll work on landing it tomorrow.",
      "parentUuid": "d911ad41_85c50b6a",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52485993_007aebc9",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 37,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-06-17T02:03:22Z",
      "side": 1,
      "message": "I include that test profile code in my patch which is in CQ: https://crrev.com/c/3689373\nBut Steven please feel free to do that patch on your side since I don\u0027t want to steal your idea :)\n\nSpeaking of this, there is another issue with that test profile: it seems to me that it does not work when we have a user profile, i.e., the test profile cannot be pushed upon a user profile [1]. That means that it will fail when there is a Chrome session, and for the test runs in the lab, I think it\u0027s possible that the previous test leaves an active Chrome session.\n\nI can think of the following solutions for this now:\n1) use shillReset, since there will be no user profile after it;\n2) remove that limitation in shill (I assume creating and pushing a non-user profile is test-only?)\n\nWDYT?\n\n[1] https://crsrc.org/o/src/platform2/shill/manager.cc;drc\u003db848cb4cf4f0216f3815d2e7d379f1c3e3afb215;l\u003d552",
      "parentUuid": "bb701e2d_23fabb91",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c84cef46_ac670a9c",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 50,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T17:05:47Z",
      "side": 1,
      "message": "This appears to be unused. We could inline it or maybe make it part of CreateCaptivePortalEnv?",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6214a8b5_920e94b5",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 50,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-06-16T23:01:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c84cef46_ac670a9c",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "89c464e6_15070f45",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 52,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T17:05:47Z",
      "side": 1,
      "message": "Why 5?",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "07cf428d_273b4196",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 52,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-06-16T23:01:58Z",
      "side": 1,
      "message": "My assumption is this is high enough to be the biggest priority. I copied this part from Jie\u0027s original routing test here: https://chromium-review.googlesource.com/c/chromiumos/platform/tast-tests/+/3670620/4/src/chromiumos/tast/local/bundles/cros/network/routing.go\n\n@Jie, could you comment here why 5?",
      "parentUuid": "89c464e6_15070f45",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ba985c2_814a3b69",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 52,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-06-17T02:03:22Z",
      "side": 1,
      "message": "\u003e could you comment here why 5?\nAny positive number is fine if you want to make it a default network after Online.",
      "parentUuid": "07cf428d_273b4196",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "72cdb0bb_393fd976",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 55,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T17:05:47Z",
      "side": 1,
      "message": "The struct on the other hand would be more readable if declared out of line.",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "604ac5de_888d813e",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 55,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-06-16T23:01:58Z",
      "side": 1,
      "message": "Done. Also removed the suffix struct variable as it seemed unnecessary.",
      "parentUuid": "72cdb0bb_393fd976",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "44b438ea_9e45fd79",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 62,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T17:05:47Z",
      "side": 1,
      "message": "192.168.101.1:80 should be a named constant.",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2b1d3cd5_2b7e996c",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 62,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-06-16T23:01:58Z",
      "side": 1,
      "message": "Changed the implementation to get the address from the veth interface, no constant needed.",
      "parentUuid": "44b438ea_9e45fd79",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2046824c_9794bf56",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 92,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T17:05:47Z",
      "side": 1,
      "message": "Maybe add a helper for running commands in netns? Maybe as a helper in virtualnet since it sets up \"netns\"? (We should be using a constant regardless).",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5b66bf5c_2c532081",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 92,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-06-16T23:01:58Z",
      "side": 1,
      "message": "Done, added it to the env.go instead since that is technically the environment that contains the netns.",
      "parentUuid": "2046824c_9794bf56",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f3223764_4b9c552f",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 95,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T17:05:47Z",
      "side": 1,
      "message": "No else after a return unless required for context, e.g.:\nif out, err :\u003d ...; err !\u003d nil {\n  return err;\n} else {\n  // code using |out|\n}\nHere I might suggest the if/else pattern, especially if we simplify the curl call with a helper.",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d867595f_6257b8ad",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 95,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-06-16T23:01:58Z",
      "side": 1,
      "message": "I made the change to simplify running commands in an env but I think I am confused by what you suggested here. I still need to have another `if` inside the `else` to check if |out| contains |okHeader|. Is the following what you are looking for?:\n\n```\nif out, err :\u003d portal.RunCommandInNetNS(ctx, cmd); err !\u003d nil; err !\u003d nil {\n  return err;\n} else {\n  if !bytes.Contains(out, okHeader) {\n    return errors.Errorf(\"unexpected curl result: got %s; want %s\", out, okHeader)\n  }\n}\n```\n\nCould you clarify what you are suggesting here?",
      "parentUuid": "f3223764_4b9c552f",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3966a9a4_facd959d",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 6
      },
      "lineNbr": 95,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-06-16T23:37:20Z",
      "side": 1,
      "message": "What you did is what I was suggesting: combining the RunCommand with the if/else.",
      "parentUuid": "d867595f_6257b8ad",
      "revId": "86f743da8bcfdf98135c6ca648abf830a0001e18",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}