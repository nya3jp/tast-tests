{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "857b1497_9a9920b2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1529818
      },
      "writtenOn": "2022-02-21T18:14:07Z",
      "side": 1,
      "message": "Hi! I have added the check to skip the known failure checks if the milestone is \u003c100. I have updated the proto to be able to add details about the failure, so the failure message clearly states that the failure is expected in the image. This failure message gives flexibility to inform about the failure reason in case we need to add new verification checks that will cause it to be unsuccessful. Please, let me know if you have any questions or comments. Thanks!",
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dfc555a8_e373f284",
        "filename": "src/chromiumos/tast/local/bundles/cros/autoupdate/rollback_service.go",
        "patchSetId": 1
      },
      "lineNbr": 129,
      "author": {
        "id": 1400492
      },
      "writtenOn": "2022-02-22T08:01:12Z",
      "side": 1,
      "message": "Let\u0027s use the new property here and set response.FailureDetails to something meaningful like \"psk network was not preserved\"? :)",
      "range": {
        "startLine": 129,
        "startChar": 2,
        "endLine": 129,
        "endChar": 29
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "231bcf1e_dbad782f",
        "filename": "src/chromiumos/tast/local/bundles/cros/autoupdate/rollback_service.go",
        "patchSetId": 1
      },
      "lineNbr": 129,
      "author": {
        "id": 1529818
      },
      "writtenOn": "2022-02-22T10:51:46Z",
      "side": 1,
      "message": "Done, thanks!",
      "parentUuid": "dfc555a8_e373f284",
      "range": {
        "startLine": 129,
        "startChar": 2,
        "endLine": 129,
        "endChar": 29
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1df29311_405b82a6",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 259,
      "author": {
        "id": 1401350
      },
      "writtenOn": "2022-02-22T09:50:35Z",
      "side": 1,
      "message": "It is easier to make the assumption that when `.Successful` is false, `.FailureDetails` is populated.",
      "range": {
        "startLine": 256,
        "startChar": 2,
        "endLine": 259,
        "endChar": 3
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7e1d69be_d977cb7f",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 259,
      "author": {
        "id": 1529818
      },
      "writtenOn": "2022-02-22T10:51:46Z",
      "side": 1,
      "message": "You are right, I have updated the code, thanks!",
      "parentUuid": "1df29311_405b82a6",
      "range": {
        "startLine": 256,
        "startChar": 2,
        "endLine": 259,
        "endChar": 3
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3766165f_9549c2de",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1400492
      },
      "writtenOn": "2022-02-22T08:01:12Z",
      "side": 1,
      "message": "I\u0027d propose to just do s.Log this if it\u0027s the \"image does not support a full rollback verification\" error. That makes it easier for us to see if there\u0027s an actual failure or not.\n\nYou could make the error publicly accessible similar to here: https://source.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/remote/bundles/cros/policy/enterprise_rollback_in_place.go;l\u003d88\n\nNot sure whether error definition needs to go into \"common\", or could be in \"local\", i.e. src/chromiumos/tast/local/bundles/cros/autoupdate/rollback_service.go?",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 19
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a112a552_6c13fa74",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1401350
      },
      "writtenOn": "2022-02-22T09:50:35Z",
      "side": 1,
      "message": "I don\u0027t think you can use this approach, as the core error is only a string, and it can be any string that is returned by `VerifyRollback`.\nIt might be possible, if the order of error is swapped, and a common `VerificationError`  is wrapped into the `.FailureDetails`.\nBut if you want to go down this path, we need to involve more reviewers, as it is not the common practice, and requires a discussion.",
      "parentUuid": "3766165f_9549c2de",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 19
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "14af46ba_650f4d27",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1529818
      },
      "writtenOn": "2022-02-22T10:51:46Z",
      "side": 1,
      "message": "I think it makes sense if the test fails, even if it is expected, because we are not really being able to completely verify everything works. With the details, we are aware that the error is the expected one and can just ignore it when it appears. \n\nHowever, if you think it is best that the test passes and to use Log instead if the failure is expected, maybe instead of checking failureDetails, we can have a new failureExpected \u003d true and just use Log in that case?",
      "parentUuid": "a112a552_6c13fa74",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 19
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "76090c93_06f52676",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1400492
      },
      "writtenOn": "2022-02-22T11:53:56Z",
      "side": 1,
      "message": "Yes, something like failureExpected \u003d true was what I had in mind when I proposed this change since it\u0027s not that anything fails, it\u0027s just that we can\u0027t verify it (there\u0027s a lot of other properties of rollback we don\u0027t verify either).\n\nI think leaving it as error case is also fine, your call. :)\n\nRegarding error comparison: Introducing a string constant and checking that FailureDetails contains that string doesn\u0027t seem that uncommon to me.",
      "parentUuid": "14af46ba_650f4d27",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 19
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3380f1aa_d68ee38c",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1529818
      },
      "writtenOn": "2022-02-22T12:17:10Z",
      "side": 1,
      "message": "As the test is set to pass when the failure is expected in other cases (e.g. when the test skips), it probably makes sense to have the same outcome in here as well. I will make the updates to introduce failureExpected",
      "parentUuid": "76090c93_06f52676",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 19
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d3ecd98b_dd93c487",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1529818
      },
      "writtenOn": "2022-02-22T12:17:10Z",
      "side": 1,
      "message": "If when the failure is expected",
      "parentUuid": "14af46ba_650f4d27",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 19
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6add4266_adb99509",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1401350
      },
      "writtenOn": "2022-02-22T14:54:13Z",
      "side": 1,
      "message": "Error comparison: Yes, the string comparison is not uncommon. What I meant is using `errors.Is()` is problematic here.",
      "parentUuid": "d3ecd98b_dd93c487",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 19
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4219c84e_c271fabf",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1529818
      },
      "writtenOn": "2022-02-22T15:00:42Z",
      "side": 1,
      "message": "I have updated the code and the test passes when skipping the checks. Including a new failureExpected made the code a little convoluted and repetitive/confusing with Success being false but then not failing. Instead, Success is marked as true but VerificationDetails (renamed from failureDetails) is populated and logged if provided. I think the code is clearer this way. I have made the corresponding updates in EnterpriseRollbackInPlace as well.",
      "parentUuid": "d3ecd98b_dd93c487",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 19
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4103be25_3e2e2ef6",
        "filename": "src/chromiumos/tast/remote/bundles/cros/autoupdate/enterprise_rollback_previous_version.go",
        "patchSetId": 1
      },
      "lineNbr": 260,
      "author": {
        "id": 1400492
      },
      "writtenOn": "2022-02-23T07:48:15Z",
      "side": 1,
      "message": "Yes, that looks good, thanks for changing it!",
      "parentUuid": "4219c84e_c271fabf",
      "range": {
        "startLine": 260,
        "startChar": 2,
        "endLine": 260,
        "endChar": 19
      },
      "revId": "1263bffbebe1629931846b35b67cf88bd9e77127",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}