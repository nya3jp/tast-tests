{
  "comments": [
    {
      "key": {
        "uuid": "8cfd69d8_2622da37",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 5
      },
      "lineNbr": 165,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-11T18:48:29Z",
      "side": 1,
      "message": "by just reading the comment, it is not obvious what prefixes and suffixes mean. could you expand your comment?",
      "range": {
        "startLine": 165,
        "startChar": 3,
        "endLine": 165,
        "endChar": 79
      },
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9519a71c_88d713a8",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 5
      },
      "lineNbr": 165,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-12T02:48:35Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8cfd69d8_2622da37",
      "range": {
        "startLine": 165,
        "startChar": 3,
        "endLine": 165,
        "endChar": 79
      },
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7d3e1219_3d7a3105",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 5
      },
      "lineNbr": 168,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-11T18:48:29Z",
      "side": 1,
      "message": "do you have a use case that uses both prefixes and suffixes?\n\n(just double-checking, because the policy in Tast is only add functionality when it is needed, and not \"just in case\").",
      "range": {
        "startLine": 168,
        "startChar": 1,
        "endLine": 168,
        "endChar": 33
      },
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f24f96ee_d532d903",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 5
      },
      "lineNbr": 168,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-12T02:48:35Z",
      "side": 1,
      "message": "Yes. am start -n pkgName/activityName bla bla\ncrrev.com/c/1924216/7/src/chromiumos/tast/local/graphics/patrace/paretrace.go#54",
      "parentUuid": "7d3e1219_3d7a3105",
      "range": {
        "startLine": 168,
        "startChar": 1,
        "endLine": 168,
        "endChar": 33
      },
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "86175ac9_104341ac",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 5
      },
      "lineNbr": 168,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-12T19:17:22Z",
      "side": 1,
      "message": "Ack.\n\nnit: Would you mind renaming it to StartWithArgs() ?",
      "parentUuid": "f24f96ee_d532d903",
      "range": {
        "startLine": 168,
        "startChar": 1,
        "endLine": 168,
        "endChar": 33
      },
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b0074139_25fdaa98",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 5
      },
      "lineNbr": 168,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-13T02:04:09Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "86175ac9_104341ac",
      "range": {
        "startLine": 168,
        "startChar": 1,
        "endLine": 168,
        "endChar": 33
      },
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d2352a78_3f510ca5",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 5
      },
      "lineNbr": 402,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-11T18:48:29Z",
      "side": 1,
      "message": "huge nit: end sentence with \u0027.\u0027",
      "range": {
        "startLine": 402,
        "startChar": 72,
        "endLine": 402,
        "endChar": 73
      },
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a5713068_6f9e3f9a",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 5
      },
      "lineNbr": 402,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-12T02:48:35Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d2352a78_3f510ca5",
      "range": {
        "startLine": 402,
        "startChar": 72,
        "endLine": 402,
        "endChar": 73
      },
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "65f02521_0ec7bc9a",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-11T07:01:21Z",
      "side": 1,
      "message": "Ricardo, do you have any idea about this? I cannot find any documentation about \"dumpsys activity --proto activities\".",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e33f42b8_0f4e0adc",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-11T18:48:29Z",
      "side": 1,
      "message": "we are migrating away from \"regexp\" to \"proto\". the \"regexp\" version is very fragile. So, if we cannot get the info from proto, I would try to use an alternative approach.\n\nThe info regarding how to know what\u0027s available in proto is here:\nhttps://cs.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/arc/README_dumpsys.md\n\n(LMK if that helps, otherwise I can point you other links... but the \"protoc --decode\" is what you should run).",
      "parentUuid": "65f02521_0ec7bc9a",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85bbef12_89b2c92a",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-12T02:48:35Z",
      "side": 1,
      "message": "Thanks for the info. I cannot find an equivalent of finishing either.\n\nhttps://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/proto/android/server/activitymanagerservice.proto;bpv\u003d0;l\u003d100",
      "parentUuid": "e33f42b8_0f4e0adc",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9d1a0505_599dfe1d",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-12T19:17:22Z",
      "side": 1,
      "message": "If there is no equivalent, then I rather not that this function to activity.go.\nWe are trying to get rid of the \"dumpsys | regexp\" version in favor of the \"dumpsys --proto\" one.\n\none alternative is to write your own .apk, and report the activity state from the .apk and read it with UIAutomator (or similar).",
      "parentUuid": "85bbef12_89b2c92a",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fac29c89_7ead8c28",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-12T19:18:49Z",
      "side": 1,
      "message": "Now that I think of it, UIAutomator might not be possible since the activity will be finishing, but you can log the state to logcat and parse logcat (since technique is used by many CTS tests)",
      "parentUuid": "9d1a0505_599dfe1d",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "90c878ae_1e7eb539",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-13T02:04:09Z",
      "side": 1,
      "message": "The idea here is to provide an utility function as this seems to be a basic and common pattern. Writing my own apk is too much effort and not always possible. It seems a bit too early to fully move to \"proto\" when it does not even contain information about if an activity is finishing/resumed.",
      "parentUuid": "fac29c89_7ead8c28",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6957fc73_65598e8e",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-13T17:15:41Z",
      "side": 1,
      "message": "The problem with \"regexp\" is that it breaks too often.\n\nFor example, the change that you want to introduce, does it work on N, does it work on Q, does it work on R? And will it work on S? (until recently, regexp was broken on ARCVM P... I had to patch it manually).\n\nAdding new functionality to dumpsys regexp is too fragile and brings huge maintenance costs.\n\nIn my experience, creating a new .apk is not expensive, specially for trivial apks. And most probably there are already some .apk from CTS that might be logging the activity lifecycle.",
      "parentUuid": "90c878ae_1e7eb539",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f886222_667b6cdb",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-16T04:29:55Z",
      "side": 1,
      "message": "Print/log does not handle activity crash. Waiting for the test to time out is less than ideal.\n\nCan we add resumed/finishing to proto?",
      "parentUuid": "6957fc73_65598e8e",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "74eff094_e57e1007",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-19T16:43:34Z",
      "side": 1,
      "message": "I guess it is possible. But it is something that must be added in Android Master (and then back-port it to R). It will take some time to do it.\n\nCould you describe what are you trying to test? perhaps there are some alternatives.",
      "parentUuid": "2f886222_667b6cdb",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "efc95ec6_3cd68980",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-20T02:46:25Z",
      "side": 1,
      "message": "See the child CL. Without this, the test will be wasting so much time waiting for timeout if the app crashes.\n\nI know my teammates are creating their own versions of dumpsys resumed/finishing check. I am trying to help here.",
      "parentUuid": "74eff094_e57e1007",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85e6018f_1cf74bad",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1366225
      },
      "writtenOn": "2019-12-20T06:58:49Z",
      "side": 1,
      "message": "The reason why I was looking at the finishing state was that, the paretrace app in the child CL stays in the finishing state for a few seconds after the app is \"closed\", probably doing some resources cleanup. My teammate pointed out that it\u0027s better to wait for the app to finish its cleanup. I will just wait for the entry to disappear in dumpsys in waitForFinish then.",
      "parentUuid": "efc95ec6_3cd68980",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c7838d0e_f3cc5dd0",
        "filename": "src/chromiumos/tast/local/arc/dumpsys.go",
        "patchSetId": 5
      },
      "lineNbr": 379,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2019-12-20T23:26:24Z",
      "side": 1,
      "message": "thanks. I have a better understanding now.\nIIUC, you want to know exactly then the .apk finishes doing what it needs to do, so that you can start the perf report.\n\nAnd also, you don\u0027t want to wait until the apk is destroyed since the cleanup can take some seconds (minutes?).\n\nIn that case, my suggestion is to modify the .apk so that it notifies \"i\u0027m done\" once it is done. This could be be writing something to a file, or something in logcat, or whatever you think is the best way to notify when it is \"done\".\n\nIn any case, \"waiting for is finished\" is be error prone. It is not guaranteed that \"activity.OnDestroy\" will be called:\n\n\u003e There are situations where the system will simply kill the activity\u0027s hosting process without calling this method (or any others) in it\n\nhttps://developer.android.com/reference/android/app/Activity.html#onDestroy()\n\nAnd, it might also be possible that the application does the cleanup before Tast has the chance to call \"WaitForfinnished\".\n\n\nAnd in case you don\u0027t need the \"WaitForFinished\" function, then I would also call \"am start\" manually, since it seems that the test doesn\u0027t really need the \"activity\" concept. By looking at how \"start2\" is being called, is not obvious how the parameters are being used.  Example of how \"am start\" is being used on other tests:\nhttps://source.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/arc/ui_automator.go;cl\u003dmaster;l\u003d60?q\u003dui_automator\u0026sq\u003dpackage:%5Echromeos_(public%7Cinternal)\n\ne.g:\n\nif err :\u003d a.Command(ctx, \"am\", \"start\", \"-W\" \"-S\", \"-n\", pkg+\"/\"+cls, \"--es\", \"fileName\", \".....\").Run(testexec.DumpLogOnError); err !\u003d nil {\n\t\ts.Fatal(\"Failed starting app: \", err)\n\t}",
      "parentUuid": "85e6018f_1cf74bad",
      "revId": "fc2b6624b5816ec230affb9d623bf971b1d494d6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}