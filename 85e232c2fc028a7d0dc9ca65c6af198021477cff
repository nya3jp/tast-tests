{
  "comments": [
    {
      "key": {
        "uuid": "c3703b87_e1266da4",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision.go",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-02-05T13:00:26Z",
      "side": 1,
      "message": "Generally, when calling s.Fatal/s.Error because of an error, include err in the error message. It\u0027s difficult to debug failures without details.",
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "742b01ea_4b3f75b7",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision.go",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1322146
      },
      "writtenOn": "2020-02-18T01:57:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c3703b87_e1266da4",
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2cc2a919_b8ff6407",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision.go",
        "patchSetId": 8
      },
      "lineNbr": 63,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-02-05T13:00:26Z",
      "side": 1,
      "message": "Optional: IMO it\u0027s much more readable to inline these constants. But I don\u0027t have strong opinion.",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 63,
        "endChar": 2
      },
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9f1fdabf_67d2efde",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision.go",
        "patchSetId": 8
      },
      "lineNbr": 63,
      "author": {
        "id": 1322146
      },
      "writtenOn": "2020-02-18T01:57:59Z",
      "side": 1,
      "message": "I haven\u0027t grown my knowledge or style to judge/feel which is better. An interesting observation is that some reviewers (like Eric) did leave some comments in other CLs to suggest make them const variables.\n\nFor now I will keep as it; one day we can revisit my decision again.",
      "parentUuid": "2cc2a919_b8ff6407",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 63,
        "endChar": 2
      },
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b7df1a52_7727b79f",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision.go",
        "patchSetId": 8
      },
      "lineNbr": 95,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-02-05T13:00:26Z",
      "side": 1,
      "message": "Optional: You might want to use testing.State.Run to run subtests.",
      "range": {
        "startLine": 95,
        "startChar": 18,
        "endLine": 95,
        "endChar": 63
      },
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "93e24b78_0eb95173",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision.go",
        "patchSetId": 8
      },
      "lineNbr": 95,
      "author": {
        "id": 1322146
      },
      "writtenOn": "2020-02-18T01:57:59Z",
      "side": 1,
      "message": "Good to know. Sure it\u0027s better. Sadly I didn\u0027t manage to find a pretty way to make those if-else also disappear. tried to do things like https://cs.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/policy/incognito_mode_availability.go?rcl\u003d943a400c3bafc6a936c43312a7ec49f09632a63d\u0026l\u003d44 but the naming of 3 aliases are confusing (i.e., mechanism in string, cyrpto.SHA{1|256}, and sha{1|256}.Sum.\n\nI will focus on wrapping them in testing.State.Run as comment suggested but no more refactoring.",
      "parentUuid": "b7df1a52_7727b79f",
      "range": {
        "startLine": 95,
        "startChar": 18,
        "endLine": 95,
        "endChar": 63
      },
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5a6d4cfc_63460f53",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision_no_database.go",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-02-05T13:00:26Z",
      "side": 1,
      "message": "Generally, when calling s.Fatal/s.Error because of an error, include err in the error message. It\u0027s difficult to debug failures without details.",
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3b1e14e3_e55f32aa",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision_no_database.go",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1322146
      },
      "writtenOn": "2020-02-18T01:57:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5a6d4cfc_63460f53",
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f45bc582_777999b5",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision_no_database.go",
        "patchSetId": 8
      },
      "lineNbr": 89,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-02-05T13:00:26Z",
      "side": 1,
      "message": "Doing these operations in sequence is fragile to errors. For example, when Wipe fails attestation is kept stopped, which is likely not we want.\n\nIIUC we do these 4 steps because:\n\n- to wipe, attestation must be stopped beforehand\n- after restarting attestation, we have to restart cryptohome\n\nam I right? Then I would write this as:\n\n if err :\u003d func() (retErr error) {\n   if err :\u003d dCtrl.StopAttestation(ctx); err !\u003d nil {\n     return errors.Wrap(err, \"failed to stop attestationd\")\n   }\n   defer func() {\n     if err :\u003d dCtrl.StartAttestation(ctx); err !\u003d nil \u0026\u0026 retErr \u003d\u003d nil {\n       retErr \u003d errors.Wrap(err, \"failed to restart attestationd\")\n     }\n     if err :\u003d dCtrl.RestartCryptohome(ctx); err !\u003d nil \u0026\u0026 retErr \u003d\u003d nil {\n       retErr \u003d errors.Wrap(err, \"failed to restart cryptohome\")\n     }\n   }()\n   return fw.Wipe(ctx, hwsec.AttestationDBPath)\n }(); err !\u003d nil {\n   s.Fatal(\"Failed to wipe out attestation database: \", err)\n }",
      "range": {
        "startLine": 78,
        "startChar": 0,
        "endLine": 89,
        "endChar": 2
      },
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3b0cdde4_7cf57d6a",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision_no_database.go",
        "patchSetId": 8
      },
      "lineNbr": 89,
      "author": {
        "id": 1322146
      },
      "writtenOn": "2020-02-18T01:57:59Z",
      "side": 1,
      "message": "Thanks for the comment, it really helped! didn\u0027t know the named return value is that useful.\nBTW, the deferred function that follows also has to consider the similar case, and the solution, I think, is just to change Fatal to Error so the restoration doesn\u0027t get bypassed if attestationd fails to stop (probably doesn\u0027t really matter because other attestation-related tests are still like to fail, though).\n\nBTW#2, I don\u0027t restart cryptohome now because the related bug is fixed and we don\u0027t need the workaround (more details, see crrev/c/1971966)",
      "parentUuid": "f45bc582_777999b5",
      "range": {
        "startLine": 78,
        "startChar": 0,
        "endLine": 89,
        "endChar": 2
      },
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5620e029_2cc744d5",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision_no_database.go",
        "patchSetId": 8
      },
      "lineNbr": 117,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-02-05T13:00:26Z",
      "side": 1,
      "message": "Don\u0027t drop err.",
      "range": {
        "startLine": 117,
        "startChar": 8,
        "endLine": 117,
        "endChar": 9
      },
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "016b2206_ceb3ea3d",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/cert_provision_no_database.go",
        "patchSetId": 8
      },
      "lineNbr": 117,
      "author": {
        "id": 1322146
      },
      "writtenOn": "2020-02-18T01:57:59Z",
      "side": 1,
      "message": "the ignored part is not an error.\nhttps://golang.org/pkg/encoding/pem/#Decode",
      "parentUuid": "5620e029_2cc744d5",
      "range": {
        "startLine": 117,
        "startChar": 8,
        "endLine": 117,
        "endChar": 9
      },
      "revId": "85e232c2fc028a7d0dc9ca65c6af198021477cff",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}