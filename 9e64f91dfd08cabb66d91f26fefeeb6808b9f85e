{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "69f75e0d_7537c7b2",
        "filename": "src/chromiumos/tast/local/bundles/cros/lacros/docs_cuj.go",
        "patchSetId": 3
      },
      "lineNbr": 108,
      "author": {
        "id": 1003168
      },
      "writtenOn": "2022-07-19T23:12:01Z",
      "side": 1,
      "message": "Running iterations and derived metrics is basically what ui/perfutil is for.\nMy understanding is that it\u0027s not available in lacros/ due to dependency constraints, but maybe we want to move perfutil/ to some shared location.\n\nAnd you will not need to make your metrics multiple-value just to make them through the histogram pipeline and calculate average later.\n\nEliot, WDYT?",
      "range": {
        "startLine": 108,
        "startChar": 0,
        "endLine": 108,
        "endChar": 38
      },
      "revId": "9e64f91dfd08cabb66d91f26fefeeb6808b9f85e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c1396834_d2c075d0",
        "filename": "src/chromiumos/tast/local/bundles/cros/lacros/docs_cuj.go",
        "patchSetId": 3
      },
      "lineNbr": 108,
      "author": {
        "id": 1179631
      },
      "writtenOn": "2022-07-20T01:52:54Z",
      "side": 1,
      "message": "What\u0027s the blocker for RunMultiple for lacros? I think I see it used e.g. here https://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/ui/launcher_animation_perf.go;l\u003d222;drc\u003d312f6351ad78d93635231ca1dd6d3ef9de72f7d8 which has a lacros variation.\n\nIt does seem like it could be useful here.",
      "parentUuid": "69f75e0d_7537c7b2",
      "range": {
        "startLine": 108,
        "startChar": 0,
        "endLine": 108,
        "endChar": 38
      },
      "revId": "9e64f91dfd08cabb66d91f26fefeeb6808b9f85e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "42b50a0f_8dadba71",
        "filename": "src/chromiumos/tast/local/bundles/cros/lacros/docs_cuj.go",
        "patchSetId": 3
      },
      "lineNbr": 108,
      "author": {
        "id": 1520127
      },
      "writtenOn": "2022-07-20T20:30:01Z",
      "side": 1,
      "message": "Thank you for pointing this out, Alexander! ui/perfutil looks very interesting indeed.\n\nBut before I jump and try to code it, do you know whether perfutil assumes that all performance values need to be in the kind of Histograms? That\u0027s what I understood by glancing at it. \n\nIf that\u0027s the case, then I\u0027m not sure if we want to invest time to convert DocsCUJ to it right now, because DocsCUJ main metric is `visibleLoadTime`, which is very simply recorded by measuring an amount of time elapsed in Tast\u0027s side.\n\nI\u0027m marking this issue as resolved for now, but feel free to open it again if that\u0027s the case please.",
      "parentUuid": "c1396834_d2c075d0",
      "range": {
        "startLine": 108,
        "startChar": 0,
        "endLine": 108,
        "endChar": 38
      },
      "revId": "9e64f91dfd08cabb66d91f26fefeeb6808b9f85e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8371c338_84d3d96d",
        "filename": "src/chromiumos/tast/local/bundles/cros/lacros/docs_cuj.go",
        "patchSetId": 3
      },
      "lineNbr": 108,
      "author": {
        "id": 1003168
      },
      "writtenOn": "2022-07-21T06:05:03Z",
      "side": 1,
      "message": "\u003e What\u0027s the blocker for RunMultiple for lacros? I think I see it used e.g. here https://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/ui/launcher_animation_perf.go;l\u003d222 which has a lacros variation\n\nThe issue is that perfutil is under bundles/cros/ui so launcher_animation_perf.go in the same directory could use it.\n\nBut bundles/cros/lacros cannot include bundles/cros/ui/perfutil because of the presubmit failures. See https://crrev.com/c/3543108/1#message-5de0d888233ff442a09fd97c20ee77bb9180641f . As a result we had to move perfutil/recorder.go to the common component here: \nhttps://crrev.com/c/3574165 to allow its use from bundles/cros/lacros.",
      "parentUuid": "42b50a0f_8dadba71",
      "range": {
        "startLine": 108,
        "startChar": 0,
        "endLine": 108,
        "endChar": 38
      },
      "revId": "9e64f91dfd08cabb66d91f26fefeeb6808b9f85e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e89ede09_b0f5d948",
        "filename": "src/chromiumos/tast/local/bundles/cros/lacros/docs_cuj.go",
        "patchSetId": 3
      },
      "lineNbr": 108,
      "author": {
        "id": 1003168
      },
      "writtenOn": "2022-07-21T20:48:48Z",
      "side": 1,
      "message": "\u003e If that\u0027s the case, then I\u0027m not sure if we want to invest time to convert\n\u003e DocsCUJ to it right now, because DocsCUJ main metric is  visibleLoadTime ,\n\u003e which is very simply recorded by measuring an amount of time elapsed in\n\u003e Tast\u0027s side.\n\nI see that you are creating metrics manually below:\n```\nperf.Metric{\n\t\tName:      \"docs.load\",\n\t\tUnit:      \"seconds\",\n\t\tDirection: perf.SmallerIsBetter,\n\t\tMultiple:  true,\n\t},\n```\nso it should not be a big issue.\n\n\nI would not insist on migrating this test to perfutil now (because one would need to move perfutil/run.go a few levels above first). But it is more of a question to Eliot as a tast owner that we might want to make perfutil shared too.\n\nHere use of perfutil could let us use one less local function (i.e. old pv.MergeWithSuffix instead of new appendPerfValues).",
      "parentUuid": "8371c338_84d3d96d",
      "range": {
        "startLine": 108,
        "startChar": 0,
        "endLine": 108,
        "endChar": 38
      },
      "revId": "9e64f91dfd08cabb66d91f26fefeeb6808b9f85e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0aa4b46c_98d7cf3a",
        "filename": "src/chromiumos/tast/local/bundles/cros/lacros/docs_cuj.go",
        "patchSetId": 3
      },
      "lineNbr": 108,
      "author": {
        "id": 1179631
      },
      "writtenOn": "2022-07-22T01:13:32Z",
      "side": 1,
      "message": "Looks like we would just have to move it out of bundles into shared code (like what you\u0027ve done for perfutil/recorder.go). It seems pretty reasonable to me to move it. WDYT?",
      "parentUuid": "e89ede09_b0f5d948",
      "range": {
        "startLine": 108,
        "startChar": 0,
        "endLine": 108,
        "endChar": 38
      },
      "revId": "9e64f91dfd08cabb66d91f26fefeeb6808b9f85e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bec69119_bb7cda8c",
        "filename": "src/chromiumos/tast/local/bundles/cros/lacros/docs_cuj.go",
        "patchSetId": 3
      },
      "lineNbr": 108,
      "author": {
        "id": 1520127
      },
      "writtenOn": "2022-07-26T19:47:11Z",
      "side": 1,
      "message": "I tried some experiments on moving ui/perfutil up a few layers to src/chromiumos/tast/local/perfutil.\n\nOne problem I noticed is that we\u0027d need to implement `RunMultiple` without relying on `s.Run`. This issue indeed is shown up in my experiment by pre-submit script, which complains with \"\u0027testing.State\u0027 should not be used in support packages, except for precondition implementation\".\n\nAny thoughts?",
      "parentUuid": "0aa4b46c_98d7cf3a",
      "range": {
        "startLine": 108,
        "startChar": 0,
        "endLine": 108,
        "endChar": 38
      },
      "revId": "9e64f91dfd08cabb66d91f26fefeeb6808b9f85e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c7c1874_3f4d3444",
        "filename": "src/chromiumos/tast/local/bundles/cros/lacros/docs_cuj.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1003168
      },
      "writtenOn": "2022-07-19T23:12:01Z",
      "side": 1,
      "message": "You may not need these suffixes anymore as you now have Lacros/Ash test variants.",
      "range": {
        "startLine": 118,
        "startChar": 3,
        "endLine": 118,
        "endChar": 61
      },
      "revId": "9e64f91dfd08cabb66d91f26fefeeb6808b9f85e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f2882c57_cd6576e2",
        "filename": "src/chromiumos/tast/local/bundles/cros/lacros/docs_cuj.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1520127
      },
      "writtenOn": "2022-07-20T20:30:01Z",
      "side": 1,
      "message": "This comment became invalid now I think because I change to use a single variant that test both type of browsers.",
      "parentUuid": "6c7c1874_3f4d3444",
      "range": {
        "startLine": 118,
        "startChar": 3,
        "endLine": 118,
        "endChar": 61
      },
      "revId": "9e64f91dfd08cabb66d91f26fefeeb6808b9f85e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}