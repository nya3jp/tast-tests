{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3d1079c0_1d2d8c81",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-04-08T07:51:41Z",
      "side": 1,
      "message": "Thanks for the patch! LGTM % several questions",
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee58e49f_a0e00aaa",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 58,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-04-08T07:51:41Z",
      "side": 1,
      "message": "nit: perhaps use swanctl since we\u0027re going to deprecate stroke, but I think it doesn\u0027t matter here and I\u0027ll do the clean up when the deprecation happens",
      "range": {
        "startLine": 58,
        "startChar": 29,
        "endLine": 58,
        "endChar": 35
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d0cda86a_7704345e",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 58,
      "author": {
        "id": 1520542
      },
      "writtenOn": "2022-04-09T02:55:11Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ee58e49f_a0e00aaa",
      "range": {
        "startLine": 58,
        "startChar": 29,
        "endLine": 58,
        "endChar": 35
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f43f16f6_e9f044c7",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 63,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-04-08T07:51:41Z",
      "side": 1,
      "message": "Question: if we don\u0027t defer cleanup how do we guarantee that the cleanup is ran properly if there is a Error happening in the middle?",
      "range": {
        "startLine": 62,
        "startChar": 53,
        "endLine": 63,
        "endChar": 23
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "831ec847_aefed4e1",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 63,
      "author": {
        "id": 1520542
      },
      "writtenOn": "2022-04-09T02:55:11Z",
      "side": 1,
      "message": "Ah you\u0027re right. Added the deferred cleanup",
      "parentUuid": "f43f16f6_e9f044c7",
      "range": {
        "startLine": 62,
        "startChar": 53,
        "endLine": 63,
        "endChar": 23
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d864fe17_ef76972c",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 79,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-04-08T07:51:41Z",
      "side": 1,
      "message": "(not for this patch) Cleanup() will also destroy the server. I guess we can split the Start() into Setup() (which setup the server and configure the service) and Connect(), and also expose a Disconnect() which only disconnects the service without remove the service from shill. Then you can safely defer the Cleanup() above.\n\nWDYT?",
      "range": {
        "startLine": 79,
        "startChar": 16,
        "endLine": 79,
        "endChar": 23
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "21e6ec4f_412ba705",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 79,
      "author": {
        "id": 1520542
      },
      "writtenOn": "2022-04-09T02:55:11Z",
      "side": 1,
      "message": "sgtm! I made an attempt of it in http://crrev/c/3579885",
      "parentUuid": "d864fe17_ef76972c",
      "range": {
        "startLine": 79,
        "startChar": 16,
        "endLine": 79,
        "endChar": 23
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f03e3978_65f99967",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 115,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-04-08T07:51:41Z",
      "side": 1,
      "message": "Question: what\u0027s the purpose of this group? It seems to me that it can be merged into next group?",
      "range": {
        "startLine": 98,
        "startChar": 1,
        "endLine": 115,
        "endChar": 2
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "53febabf_05ee3a0e",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 115,
      "author": {
        "id": 1520542
      },
      "writtenOn": "2022-04-09T02:55:11Z",
      "side": 1,
      "message": "This group is meant to test normal connect/disconnect flow (i.e. when the host VPN disconnects, then ArcHostVpnService should also disconnect). The next group is supposed to test that if ArcHostVpnService gets force-stopped unexpectedly, but the host VPN is still running normally, then everything should still work.\n\nTried to clean up the comments a bit to make this more clear. I guess relatedly, do you have suggestions on  how to organize this test better? There are 3 distinct cases I\u0027m testing here, but between http://go/tast-writing#test-consolidation and trying not to make too many different test files, I\u0027m not sure what the best way to structure this?",
      "parentUuid": "f03e3978_65f99967",
      "range": {
        "startLine": 98,
        "startChar": 1,
        "endLine": 115,
        "endChar": 2
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff2b798d_9f8bff06",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 217,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-04-08T07:51:41Z",
      "side": 1,
      "message": "Does this mean that the VPN is actually not usable for a while after the state changed to Connected?",
      "range": {
        "startLine": 217,
        "startChar": 16,
        "endLine": 217,
        "endChar": 72
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "396b315f_6ae829cf",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/arc_vpn_connect.go",
        "patchSetId": 2
      },
      "lineNbr": 217,
      "author": {
        "id": 1520542
      },
      "writtenOn": "2022-04-09T02:55:11Z",
      "side": 1,
      "message": "Yup, although it\u0027s mitigated in practice.\n- ArcNetworkService manually sends a ping to try and get this populated before the ArcHostVpnService connects\n- Android usually sends a DNS request in parallel, which happens before our ping sometimes (not sure what\u0027s causing this so it\u0027s more of a nice side effect)\n- Observing on a local DUT, takes about 20-50ms to populate\n- The fake ethernet network is still up in Android so VPN traffic shouldn\u0027t be lost. It\u0027s just that Android traffic might go through eth0 instead of our fake tun0 for a brief time",
      "parentUuid": "ff2b798d_9f8bff06",
      "range": {
        "startLine": 217,
        "startChar": 16,
        "endLine": 217,
        "endChar": 72
      },
      "revId": "bcf8ae6a9613b1483ef01c8c9f47e5603a80dd6e",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}