{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ea0f42d8_c83c0042",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1356183
      },
      "writtenOn": "2021-02-16T01:04:16Z",
      "side": 1,
      "message": "Btw Jie you\u0027ll need tast-owners@ review.",
      "revId": "ef817c8e6ae8162dc7342c70f2a21745a68b2b04",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d539e4ec_75401c44",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2021-02-16T01:59:07Z",
      "side": 1,
      "message": "Thanks for the review!",
      "revId": "ef817c8e6ae8162dc7342c70f2a21745a68b2b04",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a93d0b39_80388368",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/vpn_connect.go",
        "patchSetId": 1
      },
      "lineNbr": 170,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2021-02-15T13:46:31Z",
      "side": 1,
      "message": "Note that the same is also true for shill: I would not be surprised if shill announces the service as connected before all rtnetlink setup have fully finished.",
      "range": {
        "startLine": 170,
        "startChar": 4,
        "endLine": 170,
        "endChar": 72
      },
      "revId": "ef817c8e6ae8162dc7342c70f2a21745a68b2b04",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "82551dad_60498a05",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/vpn_connect.go",
        "patchSetId": 1
      },
      "lineNbr": 170,
      "author": {
        "id": 1356183
      },
      "writtenOn": "2021-02-16T01:02:37Z",
      "side": 1,
      "message": "Is it? Shill only set service as connected after all the Connection set up has returned. And I believe all those rtnetlink setup are synchronized calls so a Connected state should guarantee that everything already setup.\n\nI feel we might need a feedback channel in shill-patchpanel interaction to make sure that service is set as connected only after everything is ready. Maybe have patchpanel create a file in /var and shill monitoring that?",
      "parentUuid": "a93d0b39_80388368",
      "range": {
        "startLine": 170,
        "startChar": 4,
        "endLine": 170,
        "endChar": 72
      },
      "revId": "ef817c8e6ae8162dc7342c70f2a21745a68b2b04",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "06ccef19_1848caa3",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/vpn_connect.go",
        "patchSetId": 1
      },
      "lineNbr": 170,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2021-02-16T01:59:07Z",
      "side": 1,
      "message": "I assume we\u0027re going to move the routing part into patchpanel, right? Will that plan affect this?",
      "parentUuid": "82551dad_60498a05",
      "range": {
        "startLine": 170,
        "startChar": 4,
        "endLine": 170,
        "endChar": 72
      },
      "revId": "ef817c8e6ae8162dc7342c70f2a21745a68b2b04",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "75136131_82dcd6fd",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/vpn_connect.go",
        "patchSetId": 1
      },
      "lineNbr": 172,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2021-02-15T09:12:07Z",
      "side": 1,
      "message": "I was thinking about polling specific iptables rules instead of Sleep here, and decided to use sleep for now, because:\n1) This is much simpler, checking rules need to know the ifindex of the VPN service;\n2) Don\u0027t want to bind the test to the specific implementation;\n3) If there is flakiness with this timeout, it may indicate that users are able to see this issue.\nAny thoughts here?",
      "range": {
        "startLine": 172,
        "startChar": 1,
        "endLine": 172,
        "endChar": 41
      },
      "revId": "ef817c8e6ae8162dc7342c70f2a21745a68b2b04",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6bf0af2_0bc79342",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/vpn_connect.go",
        "patchSetId": 1
      },
      "lineNbr": 172,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2021-02-15T13:46:31Z",
      "side": 1,
      "message": "\u003e 2) Don\u0027t want to bind the test to the specific implementation;\n\nI would be very much against checking the existing of specific iptables for this reason. We ve had to deal in the past with a lot of spurious autotest errors when we started changing some of the old assumptions on IP assignements and iptables setup for ARC 2 years ago.\n\nFor now I would just go with your timeout. If there is still some flakiness, we can do a retry loop but it need to be done such that it would generate a new conntrack entry. I am not exactly sure how conntrack tracks icmp packets, but I think doing a new attempt with a new process should be enough.",
      "parentUuid": "75136131_82dcd6fd",
      "range": {
        "startLine": 172,
        "startChar": 1,
        "endLine": 172,
        "endChar": 41
      },
      "revId": "ef817c8e6ae8162dc7342c70f2a21745a68b2b04",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "352f5da8_714c1775",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/vpn_connect.go",
        "patchSetId": 1
      },
      "lineNbr": 172,
      "author": {
        "id": 1356183
      },
      "writtenOn": "2021-02-16T01:02:37Z",
      "side": 1,
      "message": "\u003e how conntrack tracks icmp packets\nTook a look at this and it looks like each icmp echo request-reply roundtrip is considered a new session. This actually changes our assumed reason for this bug - it\u0027s not that the later pings get wrongly enforced to the old interface, but maybe just now the new connection setting needs more time to converge since it involves shill-patchpanel interaction.",
      "parentUuid": "f6bf0af2_0bc79342",
      "range": {
        "startLine": 172,
        "startChar": 1,
        "endLine": 172,
        "endChar": 41
      },
      "revId": "ef817c8e6ae8162dc7342c70f2a21745a68b2b04",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4160616b_ce54374e",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/vpn_connect.go",
        "patchSetId": 1
      },
      "lineNbr": 172,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2021-02-16T01:59:07Z",
      "side": 1,
      "message": "Thanks for the information! I\u0027ll update the comment if we have confirmed the reason.\nIt seems to me that we will ping for 3 times, if only the first one failed we will get another error.",
      "parentUuid": "352f5da8_714c1775",
      "range": {
        "startLine": 172,
        "startChar": 1,
        "endLine": 172,
        "endChar": 41
      },
      "revId": "ef817c8e6ae8162dc7342c70f2a21745a68b2b04",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}