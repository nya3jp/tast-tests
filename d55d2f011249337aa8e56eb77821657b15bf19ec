{
  "comments": [
    {
      "key": {
        "uuid": "d2251b85_dd83dc57",
        "filename": "android/ArcInputLatencyTest/AndroidManifest.xml",
        "patchSetId": 2
      },
      "lineNbr": 3,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: is it tab? Could we convert it to spaces?",
      "range": {
        "startLine": 3,
        "startChar": 0,
        "endLine": 3,
        "endChar": 1
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3ebb575e_b251013b",
        "filename": "android/ArcInputLatencyTest/AndroidManifest.xml",
        "patchSetId": 2
      },
      "lineNbr": 3,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T00:53:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d2251b85_dd83dc57",
      "range": {
        "startLine": 3,
        "startChar": 0,
        "endLine": 3,
        "endChar": 1
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "82d2cccc_bad171de",
        "filename": "android/ArcInputLatencyTest/AndroidManifest.xml",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: remove empty line?",
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7bb53197_cb99b461",
        "filename": "android/ArcInputLatencyTest/AndroidManifest.xml",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T00:53:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "82d2cccc_bad171de",
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "febc7a7f_1c306861",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/EventListAdapter.java",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: may be final?",
      "range": {
        "startLine": 36,
        "startChar": 8,
        "endLine": 36,
        "endChar": 22
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "456d86c8_222310cf",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/EventListAdapter.java",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T00:53:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "febc7a7f_1c306861",
      "range": {
        "startLine": 36,
        "startChar": 8,
        "endLine": 36,
        "endChar": 22
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "941c70ff_06f1f4ac",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: mAdapter, mList?",
      "range": {
        "startLine": 21,
        "startChar": 29,
        "endLine": 21,
        "endChar": 36
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a28bffa6_19424407",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T00:53:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "941c70ff_06f1f4ac",
      "range": {
        "startLine": 21,
        "startChar": 29,
        "endLine": 21,
        "endChar": 36
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d95fae19_5ae089b4",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 45,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: please add comment for public methods",
      "range": {
        "startLine": 45,
        "startChar": 16,
        "endLine": 45,
        "endChar": 26
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6234eb68_ca88b4b0",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 45,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T00:53:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d95fae19_5ae089b4",
      "range": {
        "startLine": 45,
        "startChar": 16,
        "endLine": 45,
        "endChar": 26
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "498e0b7e_0f7f51da",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit:\nif (event \u003d\u003d null) {\n    return;\n}\nBTW, is it expected to be null?",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 46,
        "endChar": 28
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a4f3f7a7_b2910cbe",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T00:53:00Z",
      "side": 1,
      "message": "Just checked and it is not expected to be null. Will remove it. The reason this is here is because I originally converted this from Kotlin code, where the function signature for dispatchKeyEvent is nullable (e.g. KeyEvent? )",
      "parentUuid": "498e0b7e_0f7f51da",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 46,
        "endChar": 28
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6acba936_0ecda11d",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 52,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "may be write to sdcard output file and parse it then?\nLog is not 100% reliable.",
      "range": {
        "startLine": 52,
        "startChar": 0,
        "endLine": 52,
        "endChar": 40
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0217d18_952d745c",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 52,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T00:53:00Z",
      "side": 1,
      "message": "Implemented logging to file but am currently having trouble reading it from tast test (using ARC.ReadFile()) so I will keep the logcat here as well for now.",
      "parentUuid": "6acba936_0ecda11d",
      "range": {
        "startLine": 52,
        "startChar": 0,
        "endLine": 52,
        "endChar": 40
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3e688a37_cc9838ee",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-17T18:15:14Z",
      "side": 1,
      "message": "this is good, we need this info.\nBut my understanding is that info comes from Android and doesn\u0027t take into account the Chrome latency.\n\nIf what I said is correct, then I\u0027d add a comment saying that.",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 42
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "41a45a98_a2520fd4",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-18T00:07:25Z",
      "side": 1,
      "message": "At least on ARC container, the event timestamp is propagated through Chrome/Wayland/inputflinger, so it should be consistent with the timestamp of the kernel\u0027s input_event. Just did a quick test on P, InputEvent.getEventTime() is the same as the corresponding input_event.time timestamp (logged from here https://source.chromium.org/chromium/chromium/src/+/master:ui/events/ozone/evdev/event_converter_evdev_impl.cc;l\u003d155).\nOn ARCVM, Android and CrOS are running different monotonic clocks, so the event timestamp from the host doesn\u0027t make sense and is re-written in inputflinger (see http://ag/9608274). I did the same test as above; InputEvent.getEventTime and input_event.time are very different. http://b/123416853 is tracking the work around syncing the clocks, though it doesn\u0027t look like there\u0027s been an update recently. I\u0027ll add a comment clarifying this.\nUntil that\u0027s done, you\u0027re right that we will need another solution for measuring the host portion of the event latency for ARCVM. Re: your comment here https://crrev.com/c/2250164/2/src/chromiumos/tast/local/bundles/cros/arc/keyboard_perf.go#98 we could add traces in Chrome to help us calculate the time an input event takes from kernel to being sent on the wayland socket to Android. Then we can add this to our current calculation for Android latency to get an approx. total latency. Let me know what you think.",
      "parentUuid": "3e688a37_cc9838ee",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 42
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cce50778_aca76d5a",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-18T17:12:21Z",
      "side": 1,
      "message": "Thanks Willie.\n\nYou are right about the keyboard and touches. Wayland-server passes the kernel-timestamp all the way to ARC++, and then ARC++ injects that event with the passed timestamp.\n\nBut in the case of gamepad, the timestamp is created in Wayland-server (Search for NowInMillis):\nhttps://source.chromium.org/chromium/chromium/src/+/master:components/exo/wayland/zcr_gaming_input.cc;l\u003d71\n\nThis is a bug. We shouldn\u0027t pass a \"fake\" timestamp. We should pass the kernel one as in Touch and Keyboard. Although I don\u0027t know how much plumbing is needed.\n\nSo, until the gamepad timestamp is fixed, we need to get the timestamp in the test, when we inject the event.\n\n\nSo, for the test that you created, it works Ok.\n\nBut if we want to make it more generic so that it supports gamepad events as well, we should get the timestamp just before we inject the event in the kernel.",
      "parentUuid": "41a45a98_a2520fd4",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 42
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "95a8bfad_30aa1d05",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T00:53:00Z",
      "side": 1,
      "message": "Ah gotcha, I wasn\u0027t aware of the differences for gamepad events. Based on your suggestion, I\u0027ll modify the helper app to log realtime timestamp as well (System.currentTimeMillis) so that it can be compared to a timestamp taken from the app. AFAICT, on both ARC++ and ARCVM, the rtc clocks are synced between host and guest. Hopefully it\u0027s safe to use since it\u0027s unlikely the DUT will be put into sleep or have it\u0027s system clock set during the test.",
      "parentUuid": "cce50778_aca76d5a",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 42
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd0b0930_234731e4",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T01:13:43Z",
      "side": 1,
      "message": "Update: it turns out the rtc clock in ARCVM is not *quite* synced to the host as I thought initially. While they are within 1 second of each other, the ARCVM rtc clock seems to be somewhere on the order of ~10ms behind the host clock. This means that our current method of measuring total latency (rtc timestamp in the test and in the app) does not work and reports negative latencies on ARCVM. On ARC++ it works fine and reports latencies very similar to the Android latency. We may have to wait until the ARCVM clock-sync work is further along before this will work. For now, I will disable the test on ARCVM.",
      "parentUuid": "95a8bfad_30aa1d05",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 42
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "79a10e1b_488a5053",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 25,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: not sure, but per convention we should use {}?",
      "range": {
        "startLine": 25,
        "startChar": 37,
        "endLine": 25,
        "endChar": 40
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2d2ce148_5812ffdf",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 25,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-19T00:53:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "79a10e1b_488a5053",
      "range": {
        "startLine": 25,
        "startChar": 37,
        "endLine": 25,
        "endChar": 40
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}