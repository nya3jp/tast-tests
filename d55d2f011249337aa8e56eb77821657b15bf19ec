{
  "comments": [
    {
      "key": {
        "uuid": "d2251b85_dd83dc57",
        "filename": "android/ArcInputLatencyTest/AndroidManifest.xml",
        "patchSetId": 2
      },
      "lineNbr": 3,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: is it tab? Could we convert it to spaces?",
      "range": {
        "startLine": 3,
        "startChar": 0,
        "endLine": 3,
        "endChar": 1
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "82d2cccc_bad171de",
        "filename": "android/ArcInputLatencyTest/AndroidManifest.xml",
        "patchSetId": 2
      },
      "lineNbr": 11,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: remove empty line?",
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "febc7a7f_1c306861",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/EventListAdapter.java",
        "patchSetId": 2
      },
      "lineNbr": 36,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: may be final?",
      "range": {
        "startLine": 36,
        "startChar": 8,
        "endLine": 36,
        "endChar": 22
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "941c70ff_06f1f4ac",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 21,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: mAdapter, mList?",
      "range": {
        "startLine": 21,
        "startChar": 29,
        "endLine": 21,
        "endChar": 36
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d95fae19_5ae089b4",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 45,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: please add comment for public methods",
      "range": {
        "startLine": 45,
        "startChar": 16,
        "endLine": 45,
        "endChar": 26
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "498e0b7e_0f7f51da",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit:\nif (event \u003d\u003d null) {\n    return;\n}\nBTW, is it expected to be null?",
      "range": {
        "startLine": 46,
        "startChar": 0,
        "endLine": 46,
        "endChar": 28
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6acba936_0ecda11d",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/MainActivity.java",
        "patchSetId": 2
      },
      "lineNbr": 52,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "may be write to sdcard output file and parse it then?\nLog is not 100% reliable.",
      "range": {
        "startLine": 52,
        "startChar": 0,
        "endLine": 52,
        "endChar": 40
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3e688a37_cc9838ee",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-17T18:15:14Z",
      "side": 1,
      "message": "this is good, we need this info.\nBut my understanding is that info comes from Android and doesn\u0027t take into account the Chrome latency.\n\nIf what I said is correct, then I\u0027d add a comment saying that.",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 42
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "41a45a98_a2520fd4",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2020-06-18T00:07:25Z",
      "side": 1,
      "message": "At least on ARC container, the event timestamp is propagated through Chrome/Wayland/inputflinger, so it should be consistent with the timestamp of the kernel\u0027s input_event. Just did a quick test on P, InputEvent.getEventTime() is the same as the corresponding input_event.time timestamp (logged from here https://source.chromium.org/chromium/chromium/src/+/master:ui/events/ozone/evdev/event_converter_evdev_impl.cc;l\u003d155).\nOn ARCVM, Android and CrOS are running different monotonic clocks, so the event timestamp from the host doesn\u0027t make sense and is re-written in inputflinger (see http://ag/9608274). I did the same test as above; InputEvent.getEventTime and input_event.time are very different. http://b/123416853 is tracking the work around syncing the clocks, though it doesn\u0027t look like there\u0027s been an update recently. I\u0027ll add a comment clarifying this.\nUntil that\u0027s done, you\u0027re right that we will need another solution for measuring the host portion of the event latency for ARCVM. Re: your comment here https://crrev.com/c/2250164/2/src/chromiumos/tast/local/bundles/cros/arc/keyboard_perf.go#98 we could add traces in Chrome to help us calculate the time an input event takes from kernel to being sent on the wayland socket to Android. Then we can add this to our current calculation for Android latency to get an approx. total latency. Let me know what you think.",
      "parentUuid": "3e688a37_cc9838ee",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 42
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cce50778_aca76d5a",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 23,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-18T17:12:21Z",
      "side": 1,
      "message": "Thanks Willie.\n\nYou are right about the keyboard and touches. Wayland-server passes the kernel-timestamp all the way to ARC++, and then ARC++ injects that event with the passed timestamp.\n\nBut in the case of gamepad, the timestamp is created in Wayland-server (Search for NowInMillis):\nhttps://source.chromium.org/chromium/chromium/src/+/master:components/exo/wayland/zcr_gaming_input.cc;l\u003d71\n\nThis is a bug. We shouldn\u0027t pass a \"fake\" timestamp. We should pass the kernel one as in Touch and Keyboard. Although I don\u0027t know how much plumbing is needed.\n\nSo, until the gamepad timestamp is fixed, we need to get the timestamp in the test, when we inject the event.\n\n\nSo, for the test that you created, it works Ok.\n\nBut if we want to make it more generic so that it supports gamepad events as well, we should get the timestamp just before we inject the event in the kernel.",
      "parentUuid": "41a45a98_a2520fd4",
      "range": {
        "startLine": 23,
        "startChar": 0,
        "endLine": 23,
        "endChar": 42
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "79a10e1b_488a5053",
        "filename": "android/ArcInputLatencyTest/src/org/chromium/arc/testapp/inputlatency/ReceivedEvent.java",
        "patchSetId": 2
      },
      "lineNbr": 25,
      "author": {
        "id": 1136699
      },
      "writtenOn": "2020-06-18T06:54:28Z",
      "side": 1,
      "message": "nit: not sure, but per convention we should use {}?",
      "range": {
        "startLine": 25,
        "startChar": 37,
        "endLine": 25,
        "endChar": 40
      },
      "revId": "d55d2f011249337aa8e56eb77821657b15bf19ec",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}