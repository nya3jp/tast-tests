{
  "comments": [
    {
      "key": {
        "uuid": "9c1bab0b_7e0ec654",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1411065
      },
      "writtenOn": "2020-07-07T09:51:51Z",
      "side": 1,
      "message": "PTAL",
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d99708c0_6191f62e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1357438
      },
      "writtenOn": "2020-07-07T11:42:43Z",
      "side": 1,
      "message": "Thanks a lot for writing this test, this is very helpful!\nDo you plan to keep working on it?\n\nIIUC currently we check certificates only via pkcs11-tool.\nWill we add some UI interactions later?\n\nAlso itâ€™d be great to make FakeDMS more flexible.\nCurrently it always answers in the same way, we could add more different scenarios if we could configure it. \n",
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fcfac3de_9ce8a3c4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T13:04:54Z",
      "side": 1,
      "message": "Hi Michael,\n\nIn one test you can test multiple scenarios, but you need to restart FakeDMS and reset TPM each time. See example:\nhttps://source.chromium.org/chromiumos/chromiumos/codesearch/+/master:src/platform/tast-tests/src/chromiumos/tast/remote/bundles/cros/policy/device_wilco_dtc_allowed.go",
      "parentUuid": "d99708c0_6191f62e",
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "78ca497d_01ef1c24",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1357438
      },
      "writtenOn": "2020-07-07T13:36:50Z",
      "side": 1,
      "message": "This sounds kind of wasteful (and slow). \nCan\u0027t we just give new policies to FakeDMS and make device fetch them?\nAlso for some scenarios it is also necessary to make FakeDMS to respond differently on some other requests besides getting policies. And at the moment this responses are not configurable even with restart (https://source.chromium.org/chromium/chromium/src/+/master:components/policy/test_support/policy_testserver.py;l\u003d1269;drc\u003d46c3a3dddf8eb719b9991d0355fcfa0f07723578).",
      "parentUuid": "fcfac3de_9ce8a3c4",
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "428d192f_534b7b55",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T13:45:05Z",
      "side": 1,
      "message": "Agree, but IIUC it\u0027ll change soon and you won\u0027t need to reset TMP. I guess Victor is the best person for status update about it.\n\nI guess end prod team can add missing functionality to FakeDMS ðŸ˜Š",
      "parentUuid": "78ca497d_01ef1c24",
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e683474b_ebdb0ed6",
        "filename": "src/chromiumos/tast/local/bundles/cros/policy/required_client_certificate_for_device_service.go",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T13:04:54Z",
      "side": 1,
      "message": "nit: can it be no more than 80 symbols?",
      "range": {
        "startLine": 34,
        "startChar": 0,
        "endLine": 35,
        "endChar": 112
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db75a1b5_ab3eae6b",
        "filename": "src/chromiumos/tast/local/bundles/cros/policy/required_client_certificate_for_device_service.go",
        "patchSetId": 1
      },
      "lineNbr": 35,
      "author": {
        "id": 1411065
      },
      "writtenOn": "2020-07-07T15:00:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e683474b_ebdb0ed6",
      "range": {
        "startLine": 34,
        "startChar": 0,
        "endLine": 35,
        "endChar": 112
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f88b15b7_fa214633",
        "filename": "src/chromiumos/tast/local/bundles/cros/policy/required_client_certificate_for_device_service.go",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T13:04:54Z",
      "side": 1,
      "message": "Maybe i am missing something, but why do you use this constant here?\n\nAlso, don\u0027t you want to verify other certificate parameters like renewal period, name, key algorithm?",
      "range": {
        "startLine": 47,
        "startChar": 32,
        "endLine": 47,
        "endChar": 40
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ad158a25_de00ad5e",
        "filename": "src/chromiumos/tast/local/bundles/cros/policy/required_client_certificate_for_device_service.go",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1411065
      },
      "writtenOn": "2020-07-07T15:00:16Z",
      "side": 1,
      "message": "Currently the policy_testserver.py script serves one hard coded certificate, so the parameters will always be the same. So currently we can only check that by setting the policy a certificate will be installed. Modifying the policy_testserver.py script further to generate certificates on the fly for each request is currently out of scope.\nTastTest is the issuer of the hard coded certificate so the test looks for that string. However I should place a comment here stating that.",
      "parentUuid": "f88b15b7_fa214633",
      "range": {
        "startLine": 47,
        "startChar": 32,
        "endLine": 47,
        "endChar": 40
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8aa2a29d_9dc90612",
        "filename": "src/chromiumos/tast/local/bundles/cros/policy/required_client_certificate_for_device_service.go",
        "patchSetId": 1
      },
      "lineNbr": 47,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T15:13:53Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "ad158a25_de00ad5e",
      "range": {
        "startLine": 47,
        "startChar": 32,
        "endLine": 47,
        "endChar": 40
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "33daa798_ffbe75cb",
        "filename": "src/chromiumos/tast/local/bundles/cros/policy/required_client_certificate_for_device_service.go",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T13:04:54Z",
      "side": 1,
      "message": "I am not sure we should limit timeout here, because RPC call already have context with deadline. It\u0027ll be more flexible if client will setup timeout/deadline",
      "range": {
        "startLine": 54,
        "startChar": 11,
        "endLine": 54,
        "endChar": 27
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c9f00279_167fbe1b",
        "filename": "src/chromiumos/tast/local/bundles/cros/policy/required_client_certificate_for_device_service.go",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1411065
      },
      "writtenOn": "2020-07-07T15:00:16Z",
      "side": 1,
      "message": "If I\u0027m not mistaken if we don\u0027t timeout here and the context times out instead we won\u0027t get the error from within the loop as return value.",
      "parentUuid": "33daa798_ffbe75cb",
      "range": {
        "startLine": 54,
        "startChar": 11,
        "endLine": 54,
        "endChar": 27
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cefb1db9_f43ff684",
        "filename": "src/chromiumos/tast/local/bundles/cros/policy/required_client_certificate_for_device_service.go",
        "patchSetId": 1
      },
      "lineNbr": 54,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T15:13:53Z",
      "side": 1,
      "message": "It\u0027ll return last error: https://source.chromium.org/chromiumos/chromiumos/codesearch/+/master:src/platform/tast/src/chromiumos/tast/testing/util.go;l\u003d31?q\u003dtesting.Poll",
      "parentUuid": "c9f00279_167fbe1b",
      "range": {
        "startLine": 54,
        "startChar": 11,
        "endLine": 54,
        "endChar": 27
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fcc2dcb7_bce7269a",
        "filename": "src/chromiumos/tast/remote/bundles/cros/policy/required_client_certificate_for_device.go",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T13:04:54Z",
      "side": 1,
      "message": "I see that for wilco policy we have 3 minutes for cleanup, maybe we should use 3 minutes here as well?",
      "range": {
        "startLine": 45,
        "startChar": 37,
        "endLine": 45,
        "endChar": 38
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8c1678c0_c09dec69",
        "filename": "src/chromiumos/tast/remote/bundles/cros/policy/required_client_certificate_for_device.go",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1411065
      },
      "writtenOn": "2020-07-07T15:00:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fcc2dcb7_bce7269a",
      "range": {
        "startLine": 45,
        "startChar": 37,
        "endLine": 45,
        "endChar": 38
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "febfb659_fa54019d",
        "filename": "src/chromiumos/tast/remote/bundles/cros/policy/required_client_certificate_for_device.go",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T13:04:54Z",
      "side": 1,
      "message": "i\u0027d like it to be closer to the first use.\n\nAlso, you can do next:\n\npb.AddPolicy(\u0026policy.AttestationEnabledForDevice{Val: true}) \n\npb.AddPolicy(\u0026policy.RequiredClientCertificateForDevice{\n  Val: []*policy.RequiredClientCertificateForDeviceValue{\n      \u0026policy.RequiredClientCertificateForDeviceValue{\n\t\t\tCertProfileId:        \"cert_profile_device_1\",\n\t\t\tKeyAlgorithm:         \"rsa\",\n\t\t\tName:                 \"Cert Profile Device 1\",\n\t\t\tPolicyVersion:        \"policy_version_1\",\n\t\t\tRenewalPeriodSeconds: 60 * 60 * 24 * 365,\n      }\n   }\n})",
      "range": {
        "startLine": 48,
        "startChar": 1,
        "endLine": 59,
        "endChar": 0
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "acc7a5f6_bead4d22",
        "filename": "src/chromiumos/tast/remote/bundles/cros/policy/required_client_certificate_for_device.go",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1411065
      },
      "writtenOn": "2020-07-07T15:00:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "febfb659_fa54019d",
      "range": {
        "startLine": 48,
        "startChar": 1,
        "endLine": 59,
        "endChar": 0
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "660ca99a_b687ae3a",
        "filename": "src/chromiumos/tast/services/cros/policy/required_client_certificate_for_device_service.proto",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1306673
      },
      "writtenOn": "2020-07-07T13:04:54Z",
      "side": 1,
      "message": "Can we reuse this service for other certificate related things in the future? If so, maybe ClientCertificateService name fits better?",
      "range": {
        "startLine": 14,
        "startChar": 8,
        "endLine": 14,
        "endChar": 49
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b3fe721_54b8c19a",
        "filename": "src/chromiumos/tast/services/cros/policy/required_client_certificate_for_device_service.proto",
        "patchSetId": 1
      },
      "lineNbr": 14,
      "author": {
        "id": 1411065
      },
      "writtenOn": "2020-07-07T15:00:16Z",
      "side": 1,
      "message": "Actually RequiredClientCertificateForUser would require almost the same test, so that would make sense.",
      "parentUuid": "660ca99a_b687ae3a",
      "range": {
        "startLine": 14,
        "startChar": 8,
        "endLine": 14,
        "endChar": 49
      },
      "revId": "edb47e7914f0f136e119be5dc8604cd423829a79",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}