{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5545d276_f1fb623d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-13T05:38:17Z",
      "side": 1,
      "message": "The test still fails with \"Bluetooth is off, expected to be on\" on my DUT. I\u0027ll try again after updating my DUT. The change is still good as TestFixture can properly initialize default router.",
      "revId": "31f92a980a3b1471e2612d217d1c30100da22260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c9ae1daf_1cd101d0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-13T10:45:39Z",
      "side": 1,
      "message": "The test still fails on my grunt with latest-canary. I checked UI after the test, BT is toggled, so I guess the problem might be that Bluetooth device does not instantly get \"Powered\" after reboot. A polling might fix the problem but it is out of the scope of thie CL. I\u0027ll change the $TEST of this CL for now.",
      "parentUuid": "5545d276_f1fb623d",
      "revId": "31f92a980a3b1471e2612d217d1c30100da22260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bf5198c0_5ad0b422",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-13T18:00:00Z",
      "side": 1,
      "message": "So just to clarify, are you saying that Bluetooth remains on throughout the first part of the test, the DUT reboots, and Bluetooth still appears to be on after the DUT reboots, but appears to not be powered? Bluetooth is not toggled during by this test ever (only WiFi is being toggled). IIUC, I do believe that the kernel explicitly enables bluetooth as the persistence setting for bluetooth is saved by the kernel. In either case, I\u0027m not able to reproduce the powered issue that you\u0027re observing on my hatch :(.",
      "parentUuid": "c9ae1daf_1cd101d0",
      "revId": "31f92a980a3b1471e2612d217d1c30100da22260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "20e3e716_8fabbb17",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-14T05:46:07Z",
      "side": 1,
      "message": "Mostly yes but:\n\n\u003e Bluetooth still appears to be on after the DUT reboots, but appears to not be powered?\n\nI only looked at the BT status on UI but didn\u0027t check Powered state after running the test, so I guess the \"not powered\" state is temporary.\n\nI did some more experiments today that if I add a polling on the BT Powered check after reboot, the test can pass after one retry (2 seconds interval). So there might be a short interval that \"DUT is booted but BT not yet ready/powered\".",
      "parentUuid": "bf5198c0_5ad0b422",
      "revId": "31f92a980a3b1471e2612d217d1c30100da22260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "098c10f8_964fa04e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1432127
      },
      "writtenOn": "2020-10-14T17:11:53Z",
      "side": 1,
      "message": "I looked at my DUT logs (/var/log/messages) to verify the behavior you\u0027re seeing. https://paste.googleplex.com/5903347723796480\n\nIt looks like iwlwifi firmware is loaded within one second of coreboot code being executed. iwlwifi Wifi is found in 5 seconds from coreboot code being executed. Bluetooth adapter is turned on within 10 seconds post reboot. I guess it\u0027s still worth having the polling timeout, but I\u0027m not sure if this is enough time for the tast test to invoke the bluetooth check post reboot.",
      "parentUuid": "20e3e716_8fabbb17",
      "revId": "31f92a980a3b1471e2612d217d1c30100da22260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c8fca30b_e7eb79c1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1371981
      },
      "writtenOn": "2020-10-16T06:00:38Z",
      "side": 1,
      "message": "I also took a look at the logic of enabled technologies in shill. The devices seems to added in the callback of rtnl message, so it should be async. Then it is possible that eth is ready and our SSH connect is established but the WiFi device is not yet found. So both WiFi and BT needs a polling as you said. I can add them in another CL as it is not very related to this fix.",
      "parentUuid": "098c10f8_964fa04e",
      "revId": "31f92a980a3b1471e2612d217d1c30100da22260",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}