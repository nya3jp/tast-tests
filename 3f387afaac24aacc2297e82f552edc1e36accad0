{
  "comments": [
    {
      "key": {
        "uuid": "b077374d_f3c8ee02",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2018-11-06T05:39:30Z",
      "side": 1,
      "message": "In code reviews I generally asked to avoid passing around testing.State to utility functions as far as possible. It\u0027s because testing.State holds many members so it\u0027s difficult to tell what kind of information is needed, it will be harder to write unit tests, and so on.\n\nWhat do you think? This is a point I was wondering for some time, so it might be good to mention in go/tast-writing.",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5f05af72_4cdf2b6a",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-06T06:00:07Z",
      "side": 1,
      "message": "i debated this too. do you think it\u0027d be reasonable to make these functions panic on error instead?",
      "parentUuid": "b077374d_f3c8ee02",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72c5a3ff_009c2d24",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2018-11-06T06:02:38Z",
      "side": 1,
      "message": "IMO panic is okay for these functions since they are expected to succeed always.",
      "parentUuid": "5f05af72_4cdf2b6a",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6de012eb_7fb3de0e",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-06T06:28:50Z",
      "side": 1,
      "message": "thanks, done!",
      "parentUuid": "72c5a3ff_009c2d24",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "78d0e1af_cbc152ed",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2018-11-06T07:18:42Z",
      "side": 1,
      "message": "for consistency, I prefer errors, and report Fatal error in test main. WDYT?",
      "parentUuid": "72c5a3ff_009c2d24",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "db516008_9d2c6909",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-06T09:50:35Z",
      "side": 1,
      "message": "i\u0027d like to keep it this way, as we never expect these to fail (i.e. they\u0027re not the thing that we actually want to test), and returning errors will require a lot of repetitive error handling in the test.\n\ni guess that one option would be to return errors here and then have the test define its own trivial wrapper functions that check for errors and call s.Fatal, but i\u0027m not sure that it\u0027s better, since other tests will need to duplicate the code.\n\nplease let me know if you feel strongly about this, though.",
      "parentUuid": "78d0e1af_cbc152ed",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "06d027b7_3bb59ca7",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2018-11-06T16:04:00Z",
      "side": 1,
      "message": "\u003e i\u0027d like to keep it this way, as we never expect these to fail (i.e. they\u0027re not the thing that we actually want to test), and returning errors will require a lot of repetitive error handling in the test.\n\nIIUC, this is actually what we do for many tests.\nE.g., in tests with chrome login, in most cases, chrome login should always succeed (or, at least we expect so). But we\u0027re using return error style rather than panic().\n\nI don\u0027t have strong opinion which we should use, panic() or return error.\nBut, I prefer consistency across tast.\n\nIf panic() is allowed in this kind of case, e.g., maybe we should think about introducing a kind of wrapper of chrome.New(), something like\n\nfunc ChromeNew(...) *chrome.Chrome {\n  c, err :\u003d chrome.New(...)\n  if err {\n    panic(...)\n  }\n  return c\n}\n\nso that we can remove most of \"if err\" block for Chrome login from tests. Maybe nice to think about ioutils wrappers, D-Bus communications, etc., too.\n\nWDYT?",
      "parentUuid": "db516008_9d2c6909",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6692e2c1_35910d0f",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-06T16:18:27Z",
      "side": 1,
      "message": "i think that the main differences for me are:\n\n- creating/chmod-ing files should always succeed (unless there\u0027s a serious problem like disk corruption or a full disk that means that running any tests is hopeless), and we\u0027re not trying to test it. chrome login fails all the time and is one of the things that we\u0027re actually trying to test.\n- this is a subpackage (which i view as part of the test codebase) rather than a test support package. panicking in support packages or libraries is bad since callers may want to handle errors, and the package isn\u0027t in a place to make that decision. subpackages know how they\u0027ll be used.\n\nso i agree that consistency is good, but i view this as different from the chrome package. does that make sense?",
      "parentUuid": "06d027b7_3bb59ca7",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e66a0dc4_e4105aef",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2018-11-06T17:00:10Z",
      "side": 1,
      "message": "Thank you for explanation!\n\n\u003e creating/chmod-ing files should always succeed (unless there\u0027s a serious problem like disk corruption or a full disk that means that running any tests is hopeless), and we\u0027re not trying to test it. chrome login fails all the time and is one of the things that we\u0027re actually trying to test.\n\nChrome login failure is actually what we\u0027re trying to on a *specific* test (e.g. ui.ChromeLogin).\nHowever, I think, it is just an testing environment for some others, e.g. ARC tests.\nIn that sense, I couldn\u0027t find any diff between file creation/chmod etc failure and Chrome login failure, in those tests, because anyway there\u0027s no hope to continue the tests on either file system failure or Chrome login failure.\n\n\u003e this is a subpackage (which i view as part of the test codebase) rather than a test support package. panicking in support packages or libraries is bad since callers may want to handle errors, and the package isn\u0027t in a place to make that decision. subpackages know how they\u0027ll be used.\n\nI almost agree this point, but let me clarify some edge cases as we\u0027re programmer :-).\n1) Functions defined in this file looks like generic enough to be a part of library. WDYT?\nIf so, and some other tests want to use it, then should the signatures be changed to,\ne.g. func GetUID(username string) (int, error) {...}, on moving?\n2) Is it ok to introduce ChromeNew like utilities in subpackages, to share it across the tests in the package? E.g, it may actually be useful to remove not very interesting \"if err\" check for Chrome login on ARC tests, I guess.\n\nTo keep the consistency across tests, could you add the document that panic() is allowed only in test bundle subpackages (i.e. only in src/chromiumos/tast/{local,remote}/bundles/cros/*/*.go), but discouraged to use in libraries?",
      "parentUuid": "6692e2c1_35910d0f",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6040c5f5_121b0bae",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/filesetup/filesetup.go",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-07T03:30:52Z",
      "side": 1,
      "message": "1. yes, i think i\u0027d change these functions to return errors if they became part of a general non-subpackage package (although i think they\u0027re simple enough that i probably wouldn\u0027t move them into a higher-level package -- i\u0027d be worried that test authors would start using them for non-setup assertions).\n\n2. i think that that\u0027s okay. i have a higher tolerance for less-thought-out APIs in subpackages since it\u0027s easier to change them. :-)\n\nand i\u0027ll improve the documentation around this -- thanks!",
      "parentUuid": "e66a0dc4_e4105aef",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 8,
        "endChar": 99
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07163ad1_00e7039d",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 58,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2018-11-06T05:39:30Z",
      "side": 1,
      "message": "Please avoid going through shells whenever possible. In this case I recommend:\n\n testexec.CommandContext(ctx, \"sudo\", \"-u\", username, \"cat\", path)",
      "range": {
        "startLine": 58,
        "startChar": 41,
        "endLine": 58,
        "endChar": 106
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c55a2bfa_15a19d02",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 58,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-06T06:00:07Z",
      "side": 1,
      "message": "thanks! done",
      "parentUuid": "07163ad1_00e7039d",
      "range": {
        "startLine": 58,
        "startChar": 41,
        "endLine": 58,
        "endChar": 106
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "afaa3014_658f6eb2",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 62,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2018-11-06T05:39:30Z",
      "side": 1,
      "message": "Do we need to compare the content? If we can skip comparing the data, the test might be a bit simpler.",
      "range": {
        "startLine": 62,
        "startChar": 13,
        "endLine": 62,
        "endChar": 35
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cc817225_a87f5c87",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 62,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-06T06:00:07Z",
      "side": 1,
      "message": "i don\u0027t think it\u0027s really necessary. removed",
      "parentUuid": "afaa3014_658f6eb2",
      "range": {
        "startLine": 62,
        "startChar": 13,
        "endLine": 62,
        "endChar": 35
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3d82c8d0_0956b600",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 96,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2018-11-06T05:39:30Z",
      "side": 1,
      "message": "Please use sudo -u instead similiarly as above.",
      "range": {
        "startLine": 96,
        "startChar": 9,
        "endLine": 96,
        "endChar": 122
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "122ddc51_a6fbc472",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 96,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-06T06:00:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3d82c8d0_0956b600",
      "range": {
        "startLine": 96,
        "startChar": 9,
        "endLine": 96,
        "endChar": 122
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "19486333_6359d38d",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 139,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2018-11-06T05:39:30Z",
      "side": 1,
      "message": "nit\u0026optional: the directory should not conflict. How about just creating one with os.Mkdir?",
      "range": {
        "startLine": 139,
        "startChar": 0,
        "endLine": 139,
        "endChar": 96
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "48c55ae3_0210233e",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 139,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-06T06:00:07Z",
      "side": 1,
      "message": "good point; done",
      "parentUuid": "19486333_6359d38d",
      "range": {
        "startLine": 139,
        "startChar": 0,
        "endLine": 139,
        "endChar": 96
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "068cc027_95c95efe",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 153,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2018-11-06T05:39:30Z",
      "side": 1,
      "message": "Same here.",
      "range": {
        "startLine": 153,
        "startChar": 45,
        "endLine": 153,
        "endChar": 55
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "95955569_a59aef07",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/symlink_restrictions.go",
        "patchSetId": 2
      },
      "lineNbr": 153,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2018-11-06T06:00:07Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "068cc027_95c95efe",
      "range": {
        "startLine": 153,
        "startChar": 45,
        "endLine": 153,
        "endChar": 55
      },
      "revId": "3f387afaac24aacc2297e82f552edc1e36accad0",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}