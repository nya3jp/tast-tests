{
  "comments": [
    {
      "key": {
        "uuid": "bf3257b0_594ae7c3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1314760
      },
      "writtenOn": "2020-09-22T10:04:58Z",
      "side": 1,
      "message": "Hello, please help me review this change. Thank you.",
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e3caf86e_c962e8fe",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1387481
      },
      "writtenOn": "2020-09-22T14:50:11Z",
      "side": 1,
      "message": "Just picked a failing DUT and tried the patch. Thanks for the fix!\n\nLGTM % vsavu\u0027s comments.",
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6f105b85_38a26359",
        "filename": "src/chromiumos/tast/common/pkcs11/netcertstore/net_cert_store.go",
        "patchSetId": 1
      },
      "lineNbr": 94,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2020-09-22T10:43:27Z",
      "side": 1,
      "message": "nit: be more explicit",
      "range": {
        "startLine": 94,
        "startChar": 48,
        "endLine": 94,
        "endChar": 62
      },
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d06d517_e080554a",
        "filename": "src/chromiumos/tast/common/pkcs11/netcertstore/net_cert_store.go",
        "patchSetId": 1
      },
      "lineNbr": 94,
      "author": {
        "id": 1001853
      },
      "writtenOn": "2020-09-23T02:09:12Z",
      "side": 1,
      "message": "as the ownership might be released due to clearing TPM in the middle of the test.",
      "range": {
        "startLine": 94,
        "startChar": 24,
        "endLine": 94,
        "endChar": 48
      },
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f180f8f3_b5d57dd8",
        "filename": "src/chromiumos/tast/common/pkcs11/netcertstore/net_cert_store.go",
        "patchSetId": 1
      },
      "lineNbr": 94,
      "author": {
        "id": 1314760
      },
      "writtenOn": "2020-09-25T17:47:35Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6f105b85_38a26359",
      "range": {
        "startLine": 94,
        "startChar": 48,
        "endLine": 94,
        "endChar": 62
      },
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4210b6dd_219a700a",
        "filename": "src/chromiumos/tast/common/pkcs11/netcertstore/net_cert_store.go",
        "patchSetId": 1
      },
      "lineNbr": 96,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2020-09-22T10:43:27Z",
      "side": 1,
      "message": "tast is already ensuring that the TPM is owned\nhttps://osscs.corp.google.com/chromiumos/chromiumos/codesearch/+/master:src/platform/tast-tests/src/chromiumos/tast/local/ready/ready.go;l\u003d119\n\nIs that insufficient for this test?",
      "range": {
        "startLine": 96,
        "startChar": 18,
        "endLine": 96,
        "endChar": 34
      },
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c4c6d0b2_8aedd045",
        "filename": "src/chromiumos/tast/common/pkcs11/netcertstore/net_cert_store.go",
        "patchSetId": 1
      },
      "lineNbr": 96,
      "author": {
        "id": 1322146
      },
      "writtenOn": "2020-09-23T01:17:23Z",
      "side": 1,
      "message": "This library might be used after TPM clear by the test item itself, so it is necessary.\n\nMy concern is that this function creates a singleton and early-return for the second call; so CreateStore-\u003eclear ownership-\u003eCreateStore still has the problem.\n\nPlease consider not doing it but ensuring TPM ownership right at the same place where we clear TPM.",
      "parentUuid": "4210b6dd_219a700a",
      "range": {
        "startLine": 96,
        "startChar": 18,
        "endLine": 96,
        "endChar": 34
      },
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7193346a_7c72278e",
        "filename": "src/chromiumos/tast/common/pkcs11/netcertstore/net_cert_store.go",
        "patchSetId": 1
      },
      "lineNbr": 96,
      "author": {
        "id": 1001853
      },
      "writtenOn": "2020-09-23T02:09:12Z",
      "side": 1,
      "message": "Claiming TPM ownership right after clearing it sounds better.",
      "parentUuid": "c4c6d0b2_8aedd045",
      "range": {
        "startLine": 96,
        "startChar": 18,
        "endLine": 96,
        "endChar": 34
      },
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7eeb0b49_e1bc5274",
        "filename": "src/chromiumos/tast/common/pkcs11/netcertstore/net_cert_store.go",
        "patchSetId": 1
      },
      "lineNbr": 96,
      "author": {
        "id": 1314760
      },
      "writtenOn": "2020-09-25T17:47:35Z",
      "side": 1,
      "message": "If there\u0027s any clear TPM operation during the test, either through the usual reboot cycle or soft-clearing (restarting cryptohomed), will cause the user vault to be unmounted and the chaps keystore to be inaccessible.\n\nTherefore, I would recommend that Cleanup() be called right before clear ownership for the whole thing to work properly. In this case, this function still ensure proper TPM ownership. I can add a CL that properly documents this requirement if we decide to move in this direction.",
      "parentUuid": "7193346a_7c72278e",
      "range": {
        "startLine": 96,
        "startChar": 18,
        "endLine": 96,
        "endChar": 34
      },
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2671f49e_d137d0fb",
        "filename": "src/chromiumos/tast/common/pkcs11/netcertstore/net_cert_store.go",
        "patchSetId": 1
      },
      "lineNbr": 96,
      "author": {
        "id": 1001853
      },
      "writtenOn": "2020-09-26T02:36:26Z",
      "side": 1,
      "message": "Sorry that I have insufficient knowledge about TPM / keystore operation to decide. Leo, please chime in.",
      "parentUuid": "7eeb0b49_e1bc5274",
      "range": {
        "startLine": 96,
        "startChar": 18,
        "endLine": 96,
        "endChar": 34
      },
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92b33ad2_5a72042c",
        "filename": "src/chromiumos/tast/common/pkcs11/netcertstore/net_cert_store.go",
        "patchSetId": 1
      },
      "lineNbr": 96,
      "author": {
        "id": 1322146
      },
      "writtenOn": "2020-09-28T09:36:04Z",
      "side": 1,
      "message": "I understand that it works, like, magically. but to me, for one, it doesn\u0027t necessarily mean a good thing. IMO, just like chaps not taking tpm ownership to make itself work, it doesn\u0027t make sense to see net store to change TPM ownership. What if we wanted to test if an operation that should fail w/o TPM ownership? (BTW, doesn\u0027t wifi team have this kind of test?) and the bug hunting requires engineers to go deeper if EnsureTPMIsReady goes wrong; the function calls jumps between different files.\n\nAnd wifi team has ownership of the very entry-level file of the tests; they should be able to have full control of when/where TPM ownership is taken, no?\n\nso, to make my proposition more specific -- \nJust taking ownership after TPM clear; having a Retake/Clear-then-take helper function at hwsec side seems very reasonable if duplication is concerning (imagine if we have that function -- maybe we thing would just go smoothly w/o this CL.)\n\nI probably should not enforce the decision if wifi team has no objections, though. If the requirement from wifi team is fulfilled even from future-proof perspective, then im fine.",
      "parentUuid": "2671f49e_d137d0fb",
      "range": {
        "startLine": 96,
        "startChar": 18,
        "endLine": 96,
        "endChar": 34
      },
      "revId": "081672ac3384f5670b02129ce8972471c7d111fc",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}