{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5123faff_9105b4a5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-10-14T17:09:35Z",
      "side": 1,
      "message": "+tbarzic for test author\u0027s review\n+hidehiko, edcourtney for tast owner\u0027s review",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9943d3a7_5f3f3c9e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000232
      },
      "writtenOn": "2022-10-14T20:19:36Z",
      "side": 1,
      "message": "test changes itself seem fine",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0e44da00_c13f2620",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-10-14T20:36:54Z",
      "side": 1,
      "message": "+gabormagda for the policy related question in the comment",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c79065de_297690d9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1401350
      },
      "writtenOn": "2022-10-17T07:53:12Z",
      "side": 1,
      "message": "+CC @vsavu@google.com. Victor you are more familiar with the serve and verify process, can you take a look?",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bdffb13a_32986ac0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-10-20T16:29:14Z",
      "side": 1,
      "message": "PTAL at a new patchset.",
      "parentUuid": "c79065de_297690d9",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "88d5a443_d8117012",
        "filename": "src/chromiumos/tast/local/policyutil/policyutil.go",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-10-14T20:36:54Z",
      "side": 1,
      "message": "nit: policy then",
      "range": {
        "startLine": 72,
        "startChar": 62,
        "endLine": 72,
        "endChar": 72
      },
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ab69901d_39675adc",
        "filename": "src/chromiumos/tast/local/policyutil/policyutil.go",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-10-17T17:40:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "88d5a443_d8117012",
      "range": {
        "startLine": 72,
        "startChar": 62,
        "endLine": 72,
        "endChar": 72
      },
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "36eeee30_f428a256",
        "filename": "src/chromiumos/tast/local/policyutil/policyutil.go",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1000232
      },
      "writtenOn": "2022-10-14T20:19:36Z",
      "side": 1,
      "message": "should we just call this before waiting for app install - though, I\u0027m not sure what it\u0027s actually fixing, should ServeAndVerify ensure the policy is refreshed already? Do we instead need a waiter for the policy status set by ServeAndVerify?\n\n(as written, this feels like a roundabout way to do polling, but I might be missing something)",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2bf2363e_2e06df83",
        "filename": "src/chromiumos/tast/local/policyutil/policyutil.go",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-10-14T20:36:54Z",
      "side": 1,
      "message": "As said in the CL description, for lacros it fails to load the PWA app on lacros sometimes (flaky \u003e20%) for unknown reasons. and it\u0027s a workaround to address this flake.\n\nBtw, I\u0027m not very familiar with policy test APIs.\nAt a glance to ServeAndVerify I think it does \u0027Refresh\u0027 internally but not wait for it to take effect as you pointed out.\nIt would be great if anyone who knows can help with this.\n+gabormagda\n\nIf it takes longer to fix it for the Lacros PWA app, I\u0027ll be able to comment out the \u0027pwa_app_lacros\u0027 variant and leave a TODO for that and move on with other variants in this CL.",
      "parentUuid": "36eeee30_f428a256",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b3002fa_843f096f",
        "filename": "src/chromiumos/tast/local/policyutil/policyutil.go",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1179631
      },
      "writtenOn": "2022-10-17T02:15:37Z",
      "side": 1,
      "message": "Do we want to add a test that has workarounds for bugs in lacros? Seems better if the test can catch bugs to me. WDYT?",
      "parentUuid": "2bf2363e_2e06df83",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4f5a95a_e7bc2323",
        "filename": "src/chromiumos/tast/local/policyutil/policyutil.go",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1401350
      },
      "writtenOn": "2022-10-17T07:53:12Z",
      "side": 1,
      "message": "`ServeAndVerify` checks if the set policy is present in Chrome, and fails if not.\nBut it uses the tconn for Chrome, and not for Lacros. So if there is a propagation delay to Lacros, it is possible that `ServeAndVerify` returns without error, but the policy is still not in Lacros.",
      "parentUuid": "1b3002fa_843f096f",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a16d3329_d8557768",
        "filename": "src/chromiumos/tast/local/policyutil/policyutil.go",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2022-10-17T08:12:06Z",
      "side": 1,
      "message": "+1 to what Gabor mentioned.\n\nWe could introduce another ServeAndVerifyOnLacros (the same way we have ServeAndVerifyOnLoginScreen). It would guarantee that the policy was propagated to lacros.\n\nCurrently Lacros needs to read policies from Ash after they are set, which is not instantaneous.",
      "parentUuid": "e4f5a95a_e7bc2323",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e2b36b5f_da813853",
        "filename": "src/chromiumos/tast/local/policyutil/policyutil.go",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1401350
      },
      "writtenOn": "2022-10-17T08:29:06Z",
      "side": 1,
      "message": "Where exactly is the race condition here?\nJust setting the policy does guarantee that the PWA is installed, as the installation needs time.\nAs I see Lacros should not be involved here. So when `ServeAndVerify` is called in line 56, the policy should be there on the device.\nWhat happened when you did not add this extra `Refresh` call?",
      "parentUuid": "a16d3329_d8557768",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "65812dce_016ceb55",
        "filename": "src/chromiumos/tast/local/policyutil/policyutil.go",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-10-17T17:40:34Z",
      "side": 1,
      "message": "Thanks all for your comments!\n\nFiled b/254067263 so that we can discuss further with details and repro steps. Btw, if it is safe to get this workaround in (until a long term solution is proposed/implemented), can we leave a TODO and move on with this CL if it is better than none as Eliot suggested? Any advice would be appreciated.",
      "parentUuid": "e2b36b5f_da813853",
      "revId": "3cba4e805e3a56fbe11c64d7ee54d10dbaa33cc8",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}