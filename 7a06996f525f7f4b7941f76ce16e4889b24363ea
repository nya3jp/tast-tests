{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "30b3d0ff_32048ca7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2022-09-01T03:29:45Z",
      "side": 1,
      "message": "Nick, could you please have a look at the problem described in the comments. Writing to the clipboard from Lacros does not work, apparently due to \"no serial found\". Do you agree that this is the problem? What can be the cause? Thanks!",
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d3e7a8b4_fde3f597",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1322206
      },
      "writtenOn": "2022-09-01T19:56:13Z",
      "side": 1,
      "message": "In Wayland protocol, clipboard \"write\" must be triggered by a user interaction, ie: pointer button/touch/key press, which code-wise is achieved by sending the serial value received (from the Compositor, ie: Exo/Ash in this case) with input event triggering the clipboard operation [1][2]. In other words, you must \"emulate\" a pointer enter and button press within the window which is trying to write data to the clipboard for it to work in Lacros.\n\n[1] https://source.chromium.org/chromium/chromium/src/+/main:ui/ozone/platform/wayland/host/wayland_clipboard.cc;l\u003d123-125;drc\u003df28f4f8f90c4494c9bc9f34a28f5dcc215caa077 \n[2] https://wayland.app/protocols/wayland#wl_data_device:request:set_selection:arg:serial",
      "parentUuid": "30b3d0ff_32048ca7",
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a97c7de2_0ff678cd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2022-09-02T02:58:55Z",
      "side": 1,
      "message": "Got it, thank you!",
      "parentUuid": "d3e7a8b4_fde3f597",
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee22b6c2_20f630d4",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/image_paste.go",
        "patchSetId": 2
      },
      "lineNbr": 121,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-08-27T00:48:32Z",
      "side": 1,
      "message": "Renuga, this is still failing for lacros to bring the extension window to the front, which causes clipboard to fail later.\nIf I manually click on the extension foreground window, then it would pass in copying-and-pasting. I hope this helps you resolve this last piece of the migration.",
      "range": {
        "startLine": 121,
        "startChar": 0,
        "endLine": 121,
        "endChar": 106
      },
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fcf2d305_dd641a01",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/image_paste.go",
        "patchSetId": 2
      },
      "lineNbr": 121,
      "author": {
        "id": 1474010
      },
      "writtenOn": "2022-08-31T00:45:15Z",
      "side": 1,
      "message": "In case of Ash Chrome there is only 1 window and hence no issue. Should lacros be similar having 1 window instead of 2 so that this workaround of bringing extension window to front can be avoided.",
      "parentUuid": "ee22b6c2_20f630d4",
      "range": {
        "startLine": 121,
        "startChar": 0,
        "endLine": 121,
        "endChar": 106
      },
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "449caa81_ecd0885d",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/image_paste.go",
        "patchSetId": 2
      },
      "lineNbr": 121,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-08-31T01:25:19Z",
      "side": 1,
      "message": "The workaround at L122-129 didn\u0027t work for me.\n\nReviewers, is there any reliable way to bring a lacros window to top and get focused so that the extension window can continue to copy the image?",
      "parentUuid": "fcf2d305_dd641a01",
      "range": {
        "startLine": 121,
        "startChar": 0,
        "endLine": 121,
        "endChar": 106
      },
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0c128ff_012d02df",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/image_paste.go",
        "patchSetId": 2
      },
      "lineNbr": 121,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2022-08-31T07:00:26Z",
      "side": 1,
      "message": "The problem here doesn\u0027t look like a test issue to me but like a bug in Chrome. Let me dig deeper.",
      "parentUuid": "449caa81_ecd0885d",
      "range": {
        "startLine": 121,
        "startChar": 0,
        "endLine": 121,
        "endChar": 106
      },
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff8b3956_087f689b",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/image_paste.go",
        "patchSetId": 2
      },
      "lineNbr": 121,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2022-09-01T03:29:45Z",
      "side": 1,
      "message": "When I run arc.ImagePaste.lacros_vm, the test fails as described.\nHowever, when I run it and manually (on the DUT) cycle through the two windows at the beginning, then the test passes.\n\nBy \"at the beginning I mean around the time when the ADB/ARC messages are being logged by the test:\n2022-09-01T03:01:11.484792Z [03:01:11.768] Waiting for Android boot\n2022-09-01T03:01:11.484876Z [03:01:11.768] Waiting for initial ARC process\n2022-09-01T03:01:14.987244Z [03:01:15.315] Setting up ADB connection\n2022-09-01T03:01:15.041423Z [03:01:15.316] Installing ADB vendor keys\n2022-09-01T03:01:15.041494Z [03:01:15.316] Killing existing ADB server process(es)\n2022-09-01T03:01:15.204316Z [03:01:15.504] Starting ADB server\n\nBy \"cycle through the two windows\" I mean press alt+tab and then press it again, so that the after-state looks the same as the before-state. Indeed, when printing the ash.Window states in Tast there is no difference between before and after. Yet the test then passes.\n\nInstrumenting code in ui/ozone/platform/wayland/host/wayland_clipboard.cc and in components/exo/data_offer.cc shows two key differences between the failing and the passing run:\n1) In the failing run, ClipboardImpl::Write (in the Lacros process) hits the \"No serial found for selection\" case.\n2) In the failing run, there is no call to DataOffer::Receive() (in the Ash process). This might be a consequence of (1).",
      "parentUuid": "e0c128ff_012d02df",
      "range": {
        "startLine": 121,
        "startChar": 0,
        "endLine": 121,
        "endChar": 106
      },
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b31da28b_ff8ef516",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/image_paste.go",
        "patchSetId": 2
      },
      "lineNbr": 121,
      "author": {
        "id": 1474010
      },
      "writtenOn": "2022-09-02T01:45:54Z",
      "side": 1,
      "message": "I could get this test pass by simulating this alt+tab twice when there are 2 windows (Lacros only). If thats the only way to get this working. I can send in the same. Please confirm",
      "parentUuid": "ff8b3956_087f689b",
      "range": {
        "startLine": 121,
        "startChar": 0,
        "endLine": 121,
        "endChar": 106
      },
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "675394f6_fc21ad61",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/image_paste.go",
        "patchSetId": 2
      },
      "lineNbr": 121,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2022-09-02T02:58:55Z",
      "side": 1,
      "message": "Given Nick\u0027s answer, having the test do some user interaction such as the double alt+tab sounds good to me. But please add a comment with explanation.\n\n(You can probably also get rid of the CloseWithURL code.)",
      "parentUuid": "b31da28b_ff8ef516",
      "range": {
        "startLine": 121,
        "startChar": 0,
        "endLine": 121,
        "endChar": 106
      },
      "revId": "7a06996f525f7f4b7941f76ce16e4889b24363ea",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}