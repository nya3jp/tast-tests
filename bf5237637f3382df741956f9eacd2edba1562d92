{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "18d53968_3278d0d5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 19
      },
      "lineNbr": 9,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2021-03-09T03:52:40Z",
      "side": 1,
      "message": "nit: be more verbose with the body.\n\nThis is not a trivial CL. Add more context in the body helps the reviewer, and also good for reference in the future.\n\ne.g:\nmention that a new APK is being added. The APK does all the download, and that the Tast code just calls it/fetches the results from it... The downloaded file is read, etc...\n\nMention that two new methods are added to ADB, and mention why they are needed...\n\netc.",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 71
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "78faab8e_e81da01c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 19
      },
      "lineNbr": 9,
      "author": {
        "id": 1394308
      },
      "writtenOn": "2021-03-09T16:32:40Z",
      "side": 1,
      "message": "Sorry for the insufficient description. Updated the commit message.",
      "parentUuid": "18d53968_3278d0d5",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 71
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d37d49d1_8b89c606",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 19
      },
      "lineNbr": 0,
      "author": {
        "id": 1394308
      },
      "writtenOn": "2021-03-08T22:53:55Z",
      "side": 1,
      "message": "Thanks for your review, Greg!",
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f67f2fa4_1bc0661d",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 162,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2021-03-09T03:52:40Z",
      "side": 1,
      "message": "nit:\ndownloadFileWithApp implies that are you using an App, but the description doesn\u0027t say anything about it. Either I\u0027d rename it to \"downloadFile\"... or I\u0027d add that you are using an App in the description",
      "range": {
        "startLine": 162,
        "startChar": 3,
        "endLine": 162,
        "endChar": 22
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bde73968_1ac536e4",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 162,
      "author": {
        "id": 1394308
      },
      "writtenOn": "2021-03-09T16:32:40Z",
      "side": 1,
      "message": "Updated the description so that what the function does gets clearer.",
      "parentUuid": "f67f2fa4_1bc0661d",
      "range": {
        "startLine": 162,
        "startChar": 3,
        "endLine": 162,
        "endChar": 22
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "774d4773_5e669a06",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 164,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2021-03-09T03:52:40Z",
      "side": 1,
      "message": "I\u0027d shuffle a bit these functions.\n\nfunc downloadFile() {\n  setupADBPorts();       // optional: move the setup ports to its own function (probably it should return a \"cleanup\" function...)\n  downloadFileWithAppFromLocalAndroidPort();\n  waitForDownloadComplete(); // basically all this function from downloadFile() instead of from downloadFileWtihAppFromLocal...()\n}",
      "range": {
        "startLine": 164,
        "startChar": 5,
        "endLine": 164,
        "endChar": 24
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "73f4dfaa_01ad7292",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 164,
      "author": {
        "id": 1394308
      },
      "writtenOn": "2021-03-09T16:32:40Z",
      "side": 1,
      "message": "I agree that the suggested restructuring will make it easier to see the overall picture of the function.\n\nOn the other hand, splitting waitForDownloadComplete() from download...Port() might complicate things a little, since we\u0027d like to (1) stop the app\u0027s MainActivity, (2) close the app\u0027s MainActivity, and (3) uninstall the app after the download is completed.\nIn order to achieve that with the restructuring, I think we make download...Port() return either (a) a cleanup function which has some duplicates with its body or (b) the started MainActivity (and possibly the apk name). I wonder whether it\u0027s clearly better than the current design.\n\nWhat do you think?",
      "parentUuid": "774d4773_5e669a06",
      "range": {
        "startLine": 164,
        "startChar": 5,
        "endLine": 164,
        "endChar": 24
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ba3fe674_2e6cbed3",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 164,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2021-03-09T23:55:59Z",
      "side": 1,
      "message": "it is a good practice return a cleanup function for certain operations.\nit is being used in different parts of the code. e.g:\nhttps://source.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/power/setup/setup_app.go;l\u003d32?q\u003dlang:go%20setup_app.go\u0026sq\u003dpackage:%5Echromeos_(public%7Cinternal)\n\n\nif you return \"cleanups\", the function could look something like the following:\n\n  // only as an example...\n  func downloadFileWithApp() {\n    cleanup, err :\u003d setupPorts()\n    cleanup, err :\u003d installAndLaunchApp()\n    cleanup, err :\u003d waitForDownload()\n  }\n\nAnd it will be easier to understand what\u0027s happening. As it is now, it takes time to understand who is calling what.",
      "parentUuid": "73f4dfaa_01ad7292",
      "range": {
        "startLine": 164,
        "startChar": 5,
        "endLine": 164,
        "endChar": 24
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8f69ab14_befda3eb",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 164,
      "author": {
        "id": 1394308
      },
      "writtenOn": "2021-03-10T17:33:19Z",
      "side": 1,
      "message": "Done. It indeed looks much better now. Thank you for the suggestion!",
      "parentUuid": "ba3fe674_2e6cbed3",
      "range": {
        "startLine": 164,
        "startChar": 5,
        "endLine": 164,
        "endChar": 24
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b6e2aa9d_0a90d58e",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 184,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2021-03-09T03:52:40Z",
      "side": 1,
      "message": "here and below:\n\nyou are checking for `retErr`, but the value is `err`.\nI\u0027d just avoid returning a named variable here, since returning \"error\" is good enough.",
      "range": {
        "startLine": 184,
        "startChar": 6,
        "endLine": 184,
        "endChar": 12
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a7164e6_93db5e88",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 184,
      "author": {
        "id": 1394308
      },
      "writtenOn": "2021-03-09T16:32:40Z",
      "side": 1,
      "message": "Could you elaborate a little more on your suggestion?\nIs it to (1) stop using `retErr`, and (2) just log the `err` returned by RemoveReverseTCP() when it fails, like:\n  defer func(ctx context.Context, androidPort int) {\n    if err :\u003d a.RemoveReverseTCP(ctx, androidPort); err !\u003d nil {\n      testing.ContextLog(ctx, \"Failed to ...\")\n    }\n  }(cleanupCtx, androidPort)\n\n?",
      "parentUuid": "b6e2aa9d_0a90d58e",
      "range": {
        "startLine": 184,
        "startChar": 6,
        "endLine": 184,
        "endChar": 12
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bca1ed3a_1f46541a",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 184,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2021-03-09T23:55:59Z",
      "side": 1,
      "message": "my bad, I misunderstood the code. But it seems that the check `if retErr \u003d\u003d nil` is not needed ?\n\nIt is needed in the downloadFileWithAppFromLocalAndroidPort function, but not in this one(?)",
      "parentUuid": "8a7164e6_93db5e88",
      "range": {
        "startLine": 184,
        "startChar": 6,
        "endLine": 184,
        "endChar": 12
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7829ce86_06086248",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 184,
      "author": {
        "id": 1394308
      },
      "writtenOn": "2021-03-10T17:33:19Z",
      "side": 1,
      "message": "Removed the use of `retErr` from both functions.",
      "parentUuid": "bca1ed3a_1f46541a",
      "range": {
        "startLine": 184,
        "startChar": 6,
        "endLine": 184,
        "endChar": 12
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "455f1253_20c46219",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 195,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2021-03-09T03:52:40Z",
      "side": 1,
      "message": "add docstring to all non-trivial functions",
      "range": {
        "startLine": 195,
        "startChar": 5,
        "endLine": 195,
        "endChar": 44
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "91c5f576_6363bac4",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 195,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2021-03-09T03:52:40Z",
      "side": 1,
      "message": "ditto above",
      "range": {
        "startLine": 195,
        "startChar": 151,
        "endLine": 195,
        "endChar": 157
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "66d19f50_71144a5d",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 195,
      "author": {
        "id": 1394308
      },
      "writtenOn": "2021-03-09T16:32:40Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "455f1253_20c46219",
      "range": {
        "startLine": 195,
        "startChar": 5,
        "endLine": 195,
        "endChar": 44
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aec76fae_e93c4d31",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/download_manager.go",
        "patchSetId": 19
      },
      "lineNbr": 195,
      "author": {
        "id": 1394308
      },
      "writtenOn": "2021-03-10T17:33:19Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "91c5f576_6363bac4",
      "range": {
        "startLine": 195,
        "startChar": 151,
        "endLine": 195,
        "endChar": 157
      },
      "revId": "bf5237637f3382df741956f9eacd2edba1562d92",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}