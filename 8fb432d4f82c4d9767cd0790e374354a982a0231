{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e8640a5e_40c48878",
        "filename": "src/chromiumos/tast/local/bundles/cros/crostini/share_movies.go",
        "patchSetId": 3
      },
      "lineNbr": 49,
      "author": {
        "id": 1414348
      },
      "writtenOn": "2020-11-18T05:42:08Z",
      "side": 1,
      "message": "Optin could take up to 90 seconds (see link below).  Based on offline discussion, context shortened to 30 seconds may cause failures due to context deadline exceeded.  Maybe longer context timeout could allow optin extension page to show to complete provisioning process?\n\nhttps://source.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/arc/auth_perf.go;rcl\u003d74b64b01222e9d75568c338d31d7a45582879132;l\u003d295\n\n```\nError at share_movies.go:55: Failed to optin to Play Store: failed to find optin extension page: failed to find chrome-extension://cnbgggchhmkkdmeppjobngjoejnihlei/_generated_background_page.html: context deadline exceeded; last error follows: no targets matched\n2020/11/18 15:49:31 [15:49:31.726] Stack trace:\nFailed to optin to Play Store\n\tat chromiumos/tast/local/bundles/cros/crostini.ShareMovies (share_movies.go:55)\n\tat chromiumos/tast/internal/planner.runTestWithRoot.func3 (run.go:709)\n\tat chromiumos/tast/internal/planner.safeCall.func2 (safe.go:92)\n\tat runtime.goexit (asm_amd64.s:1357)\n```",
      "revId": "8fb432d4f82c4d9767cd0790e374354a982a0231",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "081caa6b_2ec339ec",
        "filename": "src/chromiumos/tast/local/bundles/cros/crostini/share_movies.go",
        "patchSetId": 3
      },
      "lineNbr": 49,
      "author": {
        "id": 1398801
      },
      "writtenOn": "2020-11-18T07:47:23Z",
      "side": 1,
      "message": "I deleted the 48 ~ 50, got the same error. When put \"chrome-extension://cnbgggchhmkkdmeppjobngjoejnihlei/_generated_background_page.html\" into browser in the DUTs, got \"cnbgggchhmkkdmeppjobngjoejnihlei is blocked\", what blocked it?",
      "parentUuid": "e8640a5e_40c48878",
      "revId": "8fb432d4f82c4d9767cd0790e374354a982a0231",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ca56f466_b986164d",
        "filename": "src/chromiumos/tast/local/bundles/cros/crostini/share_movies.go",
        "patchSetId": 3
      },
      "lineNbr": 49,
      "author": {
        "id": 1414348
      },
      "writtenOn": "2020-11-18T08:53:39Z",
      "side": 1,
      "message": "Arc needs to be enabled with play store gaia optin using chrome.ARCSupported().  Does `crostini.StartedARCEnabled()` ensure this?  Seems like this maybe the first crostini test to use optin.Perform() ðŸ˜Š\n\nFrom .../crostini/pre.go, it looks like only ARCEnabled() is set?  http://cs/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/crostini/pre.go?l\u003d369\u0026rcl\u003d153084fabd45255e58eb783c35492426b0f28376\n\n```\n// ARCEnabled returns an Option that can be passed to New to enable ARC (without Play Store)\n// for the user session with mock GAIA account.\nfunc ARCEnabled() Option {\n\treturn func(c *Chrome) { c.arcMode \u003d arcEnabled }\n}\n\n// ARCSupported returns an Option that can be passed to New to allow to enable ARC with Play Store gaia opt-in for the user\n// session with real GAIA account.\n// In this case ARC is not launched by default and is required to be launched by user policy or from UI.\nfunc ARCSupported() Option {\n\treturn func(c *Chrome) { c.arcMode \u003d arcSupported }\n}\n```\n\nUsing play_store.go as example, arc.DisableSyncFlags() would also be good to prevent flakiness.\n\n```\ncr, err :\u003d chrome.New(ctx, chrome.GAIALogin(), chrome.Auth(username, password, \"gaia-id\"), chrome.ARCSupported(), chrome.ExtraArgs(arc.DisableSyncFlags()...))\n```\n--arc-disable-app-sync  - prevents syncing installed apps from the previous sessions.\n--arc-disable-play-auto-install - disable PAI flow that downloads and installs apps in the background.\n--arc-disable-locale-sync - donâ€™t propagate locale sync for the account that might cause reconfiguration updates.\n--arc-play-store-auto-update\u003doff - prevents Play Store and GMS Core from third party app update and prevents self-updates and downloadable content. \n\nhttps://source.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/arc/play_store.go;rcl\u003dd0c05f37e71d8ce91515503faf8c4e05ed7867eb;l\u003d46",
      "parentUuid": "081caa6b_2ec339ec",
      "revId": "8fb432d4f82c4d9767cd0790e374354a982a0231",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d0aa11f2_81ec202e",
        "filename": "src/chromiumos/tast/local/bundles/cros/crostini/share_movies.go",
        "patchSetId": 3
      },
      "lineNbr": 49,
      "author": {
        "id": 1398801
      },
      "writtenOn": "2020-11-18T23:54:20Z",
      "side": 1,
      "message": "added, got the same error. The difference is that Crostini has chrome.ExtraArgs(\"--vmodule\u003dcrostini*\u003d1\").",
      "parentUuid": "ca56f466_b986164d",
      "revId": "8fb432d4f82c4d9767cd0790e374354a982a0231",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d265528b_7e639053",
        "filename": "src/chromiumos/tast/local/bundles/cros/crostini/share_movies.go",
        "patchSetId": 3
      },
      "lineNbr": 49,
      "author": {
        "id": 1414348
      },
      "writtenOn": "2020-11-22T07:34:34Z",
      "side": 1,
      "message": "What was added?  I saw you added arc.DisableSyncFlags() but what about chrome.ARCSupported() instead of chrome.ARCEnabled()?",
      "parentUuid": "d0aa11f2_81ec202e",
      "revId": "8fb432d4f82c4d9767cd0790e374354a982a0231",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "07361292_e4046b19",
        "filename": "src/chromiumos/tast/local/bundles/cros/crostini/share_movies.go",
        "patchSetId": 3
      },
      "lineNbr": 49,
      "author": {
        "id": 1398801
      },
      "writtenOn": "2020-11-22T23:16:59Z",
      "side": 1,
      "message": "chrome.ExtraArgs(arc.DisableSyncFlags()...) was added.\n\nIf changing chrome.ARCEnabled() to chrome.ARCSupported(), optin.Perform,  optin.WaitForPlayStoreShown and the test case ran without error. However, the DUTs is in this https://drive.google.com/file/d/1IE4XRqMaZwlG6kQM4Hk7DNo8vP9wa0Tn/view?usp\u003dsharing.\n\nIf using both chrome.ARCEnabled() and chrome.ARCSupported(), got the same error as before.",
      "parentUuid": "d265528b_7e639053",
      "revId": "8fb432d4f82c4d9767cd0790e374354a982a0231",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7f18ed5_3452c1c3",
        "filename": "src/chromiumos/tast/local/bundles/cros/crostini/share_movies.go",
        "patchSetId": 3
      },
      "lineNbr": 49,
      "author": {
        "id": 1414348
      },
      "writtenOn": "2020-11-23T04:22:29Z",
      "side": 1,
      "message": "I think that prompt is to be expected for unmanaged CrOS accounts.  You can follow the optin.FindOptInExtensionPageAndAcceptTerms(...) example below to accept and finish optin.  \n\nI think you will need both existing `arcEnabled` option (for current use cases in crotini) and another `arcSupported` option for optin with Play Store in your case.\n\nBut as khmel@ mentioned, please add comment in code for justifying why optin is needed in this case.\n\nhttps://source.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/arc/opt_in_after_interruption.go;rcl\u003d803d65d59ae2056942f8342f881025140d4a1248;l\u003d229",
      "parentUuid": "07361292_e4046b19",
      "revId": "8fb432d4f82c4d9767cd0790e374354a982a0231",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "85c0d3bf_2b7fe445",
        "filename": "src/chromiumos/tast/local/bundles/cros/crostini/share_movies.go",
        "patchSetId": 3
      },
      "lineNbr": 49,
      "author": {
        "id": 1398801
      },
      "writtenOn": "2020-11-23T23:58:36Z",
      "side": 1,
      "message": "Use ARCSupported, not ARCEnabled. Will still get the same error if use both.\n\nLine 55 and 56 give reason why option.Perform and optin.WaitForPlayStoreShown are needed here.\n\noptin.FindOptInExtensionPageAndAcceptTerms(...) does not accept the terms and threw error: Failed to find optin extension page: failed to wait for port !\u003d null: context deadline exceeded; last error follows: \"!!(port !\u003d null)\" is false",
      "parentUuid": "e7f18ed5_3452c1c3",
      "revId": "8fb432d4f82c4d9767cd0790e374354a982a0231",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "19592cc6_73649fa1",
        "filename": "src/chromiumos/tast/local/bundles/cros/crostini/share_movies.go",
        "patchSetId": 3
      },
      "lineNbr": 49,
      "author": {
        "id": 1414348
      },
      "writtenOn": "2020-11-24T00:53:10Z",
      "side": 1,
      "message": "\"Use ARCSupported, not ARCEnabled.\" - I assume this is working now?",
      "parentUuid": "85c0d3bf_2b7fe445",
      "revId": "8fb432d4f82c4d9767cd0790e374354a982a0231",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}