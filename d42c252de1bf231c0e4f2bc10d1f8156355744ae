{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "76b41fba_5c28d9f6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1400377
      },
      "writtenOn": "2021-04-26T17:22:06Z",
      "side": 1,
      "message": "Shuhei, could you review this change? CUJ tries to use KeepState() option in fixtures but the account doesn\u0027t have device ownership if it is pre-owned by other account.",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f379be6b_f99d1321",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2021-04-27T09:51:01Z",
      "side": 1,
      "message": "I\u0027m not sure what it means to keep user directories while clearing ownership.\n\nVictor, what do you think?\n",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "767d3899_aaf537f9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2021-04-27T10:01:29Z",
      "side": 1,
      "message": "For enrolled devices this makes no sense whatsoever, clearing ownership will break the device in subtle ways.\n\nFor consumer devices I\u0027m not sure if ownership can be transferred. Why not simply create the user + its state after ownership is cleared?",
      "parentUuid": "f379be6b_f99d1321",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4417903f_bd33ebfc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1400377
      },
      "writtenOn": "2021-04-27T16:12:16Z",
      "side": 1,
      "message": "Thanks Victor and Shuhei for your comments.\n\nWe want to use KeepState between multiple tast runs to avoid some time consuming configuration setup and app installation for the same account. (It\u0027s ok to do the setup in the initial run.) But with KeepState, if the DUT was logged in with another account before the first run, the ownership remains to the old account and we see some undesired behavior. I hope this problem statement makes sense.\n\nDo you know if there is an API in ChromeOS to query the current owner of the device? If so, I think we can compare the login account with the device owner. If they are the same, then keep state / ownership. Otherwise, clear the ownership and also remove user directories.\n\nAnother question: If the ownership should not be cleared for an enrolled device, how do we avoid running most of the tast tests, which clears ownership, on those devices?",
      "parentUuid": "767d3899_aaf537f9",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f4496612_cbc320bd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2021-04-27T16:54:35Z",
      "side": 1,
      "message": "Tast runs on consumer owned devices (and fails some tests if not), but there is a fixture that performs enrollment. All tests using that fixture need to use KeepEnrollment when starting Chrome.\n\nRegarding your tests, ready.go already clears ownership before tests start. You can simply use KeepState in that case.\nhttps://osscs.corp.google.com/chromiumos/chromiumos/codesearch/+/main:src/platform/tast-tests/src/chromiumos/tast/local/ready/ready.go;l\u003d347?q\u003dfile:ready.go\n\nWhat kind of tests are you writing? What undesired behavior are you encountering when running your tests?",
      "parentUuid": "4417903f_bd33ebfc",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "608e9e53_9e41c8db",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1400377
      },
      "writtenOn": "2021-04-27T17:25:08Z",
      "side": 1,
      "message": "Hi Victor, I\u0027ve add comments in crbug.com/1202797 for more information of what we encountered during our critical user journey (CUJ test). More discussion about this issue (along with other issues) can be found at b:184890503\n\nAlso, per my test, I don\u0027t think the ready.go policy cleanup takes effect - the policy.1 file under /var/lib/whitelist still has the account of the previous device owner when KeepState is used. \n\nThe ClearDeviceOwnership() has a comment:\n\n// The UI must be stopped while we do this, or the session_manager will\n// write the policy and key files out again.\n\nI guess in ready.go, UI is not stopped so policy.1 is re-written.",
      "parentUuid": "f4496612_cbc320bd",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dc3e024d_8b314dca",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2021-04-28T08:22:02Z",
      "side": 1,
      "message": "This still seems like the wrong way to fix the encountered issues and hiding other problems. This is not how Chrome OS devices normally operate.\n\nUsers should still be able log in even if they are not the owner of the device. That seems like the issue that needs to be fixed. Clearing the Welcome screen should also be added to tast as it will impact more tests.\n\nnya@:\n Are you aware of any issues with GAIA login with other existing users?\n Should all dialogs already be cleared by tast?\n Do we want to merge this change until the other issues are fixed in tast?\n\nxiliu@:\n  Are the tests designed to only be run manually?\n  Do you actually need the users to be device owners for the tests (for the extra permissions)? I would expect meet to work in other accounts.\n  From the test I see you just do a GAIA login. Will this change in the future? \nhttps://osscs.corp.google.com/chromiumos/chromiumos/codesearch/+/main:src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/ui/conference_service.go;l\u003d110?q\u003dRunGoogleMeetScenario",
      "parentUuid": "608e9e53_9e41c8db",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b9fa62b4_ee688dcf",
        "filename": "src/chromiumos/tast/local/chrome/option.go",
        "patchSetId": 1
      },
      "lineNbr": 161,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2021-04-27T10:01:29Z",
      "side": 1,
      "message": "This also needs to be updated.",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "07bb8a54_5cc7987a",
        "filename": "src/chromiumos/tast/local/chrome/option.go",
        "patchSetId": 1
      },
      "lineNbr": 161,
      "author": {
        "id": 1400377
      },
      "writtenOn": "2021-04-27T16:12:16Z",
      "side": 1,
      "message": "I\u0027m not quite sure what change to make for this code line. I think we should keep it because we don\u0027t want to clear ownership when KeepEnrollment() is called.",
      "parentUuid": "b9fa62b4_ee688dcf",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "43045d5a_8a3b2c01",
        "filename": "src/chromiumos/tast/local/chrome/option.go",
        "patchSetId": 1
      },
      "lineNbr": 161,
      "author": {
        "id": 1368736
      },
      "writtenOn": "2021-04-27T16:54:35Z",
      "side": 1,
      "message": "Add for consistency:\ncfg.KeepState \u003d false",
      "parentUuid": "07bb8a54_5cc7987a",
      "revId": "d42c252de1bf231c0e4f2bc10d1f8156355744ae",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}