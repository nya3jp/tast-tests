{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "93f833b9_1f446c5d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 12
      },
      "lineNbr": 15,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T10:15:32Z",
      "side": 1,
      "message": "Cool!",
      "range": {
        "startLine": 14,
        "startChar": 11,
        "endLine": 15,
        "endChar": 27
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f9c6defb_26d26ae4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T10:15:32Z",
      "side": 1,
      "message": "Oh it\u0027s much more complex now!",
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7ab2ea67_e32268b9",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/data/ppds_all.tar.xz.external",
        "patchSetId": 12
      },
      "lineNbr": 2,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T12:42:34Z",
      "side": 1,
      "message": "FYI: the top directory (ppds_all) has permission 0644, thus non-root users can\u0027t access files under the directory. It works, but sounds weird...",
      "range": {
        "startLine": 2,
        "startChar": 10,
        "endLine": 2,
        "endChar": 87
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3d650dcf_0b4d3dc6",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/data/ppds_all.tar.xz.external",
        "patchSetId": 12
      },
      "lineNbr": 2,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-10T10:13:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7ab2ea67_e32268b9",
      "range": {
        "startLine": 2,
        "startChar": 10,
        "endLine": 2,
        "endChar": 87
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b011253_fc8f6874",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T10:15:32Z",
      "side": 1,
      "message": "General comment: This test is getting complicated, so I recommend defining more functions with proper signatures for readability.\n\nI want functions for each of these bullet items at least:\n\n - Extracting ppds_all.tar.xz to a directory\n - Running tests for all PPDs in parallel\n - Running tests for PPDs on a goroutine\n - Running a test for a single PPD",
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "92a655d2_30ec5034",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-10T10:13:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6b011253_fc8f6874",
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11c6ccd2_ad86b199",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 44,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T10:15:32Z",
      "side": 1,
      "message": "Let\u0027s avoid mutable global variables. Can you define a type that encapsulates map and mutex, and construct it in the test?\n\nAlso I couldn\u0027t understand what this caches. Code comments about the background is appreciated.",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 44,
        "endChar": 22
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5d0455d0_2b71253f",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 44,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-09T11:21:07Z",
      "side": 1,
      "message": "I\u0027m tempted to use sync.Map which is optimized for the use case of a cache that only grows, the only drawback being the lack of type safety, instead of defining a custom type. How does that sound?",
      "parentUuid": "11c6ccd2_ad86b199",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 44,
        "endChar": 22
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "85d36e26_3684c12c",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 44,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-09T11:28:49Z",
      "side": 1,
      "message": "Another option is removing the cache entirely. The difference between 20 and 40 seconds is not very much. The main reason I added it is back when the code was single threaded it was necessary for the test to finish in time.",
      "parentUuid": "5d0455d0_2b71253f",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 44,
        "endChar": 22
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ed580801_16f5a59f",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 44,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T12:42:34Z",
      "side": 1,
      "message": "I think halving the runtime would be a good reason to have a cache. Both sync.Map and custom map type sound good to me.",
      "parentUuid": "85d36e26_3684c12c",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 44,
        "endChar": 22
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "13649fe5_4db6d4ab",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 44,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-10T10:13:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ed580801_16f5a59f",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 44,
        "endChar": 22
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be5b3188_f08c122b",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 46,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T10:15:32Z",
      "side": 1,
      "message": "I don\u0027t recommend calling testing.State.Fatal on goroutines since it behaves differently (it terminates the current goroutine without aborting the test).\n\nI also don\u0027t recommend calling testing.State.Error either because the error message won\u0027t be deterministic and difficult to compare in reporting UI.\n\nMy recommendation is to define a result type and sending it back to the main goroutine by a channel.",
      "range": {
        "startLine": 46,
        "startChar": 35,
        "endLine": 46,
        "endChar": 51
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c1617b2_bb5ac87a",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 46,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-10T10:13:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "be5b3188_f08c122b",
      "range": {
        "startLine": 46,
        "startChar": 35,
        "endLine": 46,
        "endChar": 51
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dc385131_97b05b7e",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 52,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T10:15:32Z",
      "side": 1,
      "message": "Can you introduce a separate function that processes a single file for better readability?",
      "range": {
        "startLine": 52,
        "startChar": 1,
        "endLine": 52,
        "endChar": 26
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "567ba2e7_0f80f2ae",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 52,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-10T10:13:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dc385131_97b05b7e",
      "range": {
        "startLine": 52,
        "startChar": 1,
        "endLine": 52,
        "endChar": 26
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "843755d4_2481270d",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 69,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T10:15:32Z",
      "side": 1,
      "message": "Handling .gz here makes the logic more complicated. Is it possible to put uncompressed PPD files in the archive? I believe putting .gz files in .tar.xz is not useful anyway.",
      "range": {
        "startLine": 57,
        "startChar": 0,
        "endLine": 69,
        "endChar": 3
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "348680ec_faf82435",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 69,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-09T11:21:07Z",
      "side": 1,
      "message": "The PPD files are plain text and decompressing them uses up a ton of disk space. The main advantage of putting gz files in a tar.xz archive is so that they can be decompressed one by one as in the code below in order to save disk space. That said, if the try bots have plenty of available disk space and you think it would be a good idea, I can definitely put uncompressed PPD files into archive.",
      "parentUuid": "843755d4_2481270d",
      "range": {
        "startLine": 57,
        "startChar": 0,
        "endLine": 69,
        "endChar": 3
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6094cb0c_c801276b",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 69,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T12:42:34Z",
      "side": 1,
      "message": "I see. Local tests run on the DUT, some of which may have very limited storage like 3-4GB. So it\u0027s nice to minimize the disk usage.\n\nI thought about using .zip which allows random access (thus we don\u0027t need to extract all files at the beginning). But zip has lower compression ratio.\n\nSo I now agree that putting .gz in .tar.xz is good in this case.",
      "parentUuid": "348680ec_faf82435",
      "range": {
        "startLine": 57,
        "startChar": 0,
        "endLine": 69,
        "endChar": 3
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eab3cdf2_4240a2e5",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 148,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T10:15:32Z",
      "side": 1,
      "message": "This selection would introduce bias (i.e. some PPDs are selected more frequently than others).\n\nHow about just picking a stride of a prime number? Then bias should be minimal regardless what n is.",
      "range": {
        "startLine": 138,
        "startChar": 0,
        "endLine": 148,
        "endChar": 2
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f94fa2b7_2ffe8bcc",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 148,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-09T11:04:25Z",
      "side": 1,
      "message": "All PPDs should be selected exactly once as the stride (a power of 2) is coprime to n (odd), the number of PPDs.",
      "parentUuid": "eab3cdf2_4240a2e5",
      "range": {
        "startLine": 138,
        "startChar": 0,
        "endLine": 148,
        "endChar": 2
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "46865317_17768186",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 148,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-11-09T12:42:34Z",
      "side": 1,
      "message": "Ah you\u0027re right. Is it a common trick? I thought just using a prime number stride is easier...",
      "parentUuid": "f94fa2b7_2ffe8bcc",
      "range": {
        "startLine": 138,
        "startChar": 0,
        "endLine": 148,
        "endChar": 2
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1f89dd98_aff5f620",
        "filename": "src/chromiumos/tast/local/bundles/cros/printer/test_ppds.go",
        "patchSetId": 12
      },
      "lineNbr": 148,
      "author": {
        "id": 1432569
      },
      "writtenOn": "2020-11-10T10:13:30Z",
      "side": 1,
      "message": "They\u0027re both pretty similar, but using a power of 2 instead of a prime makes it a bit easier to adjust the stride to eg 128 or 32 without having to lookup the closest prime to these numbers.",
      "parentUuid": "46865317_17768186",
      "range": {
        "startLine": 138,
        "startChar": 0,
        "endLine": 148,
        "endChar": 2
      },
      "revId": "735cdd53d934f66c4b829b8ab75b73b17c743b22",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}