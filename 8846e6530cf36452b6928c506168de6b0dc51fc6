{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "be28c15c_eb6a5bfc",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/boot_perf_service.go",
        "patchSetId": 1
      },
      "lineNbr": 60,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2022-08-24T21:37:10Z",
      "side": 1,
      "message": "I\u0027m as (or more) confused as you about $BUG, but do we *really* expect tlsdated to still be executing after it has \"stopped\"?\n\nMy understanding of the upstart cookbook matches my observations, which say the post-stop clause should be completely done by the time \u0027stop tlsdated\u0027 returns:\n\nhttps://upstart.ubuntu.com/cookbook/#viewing-state-transitions\n\n```\n# initctl log-priority -v info\n# tail -f /var/log/upstart.log \u0026\n...\n# stop tlsdated\n2022-08-24T21:30:15.987220Z INFO kernel: [610169.841905] init: Connection from private client\n2022-08-24T21:30:15.991560Z INFO kernel: [610169.848813] init: tlsdated goal changed from start to stop\n2022-08-24T21:30:15.991672Z INFO kernel: [610169.849417] init: tlsdated state changed from running to pre-stop\n2022-08-24T21:30:15.992491Z INFO kernel: [610169.850496] init: tlsdated state changed from pre-stop to stopping\n2022-08-24T21:30:15.994561Z INFO kernel: [610169.851983] init: Handling stopping event\n2022-08-24T21:30:15.996520Z INFO kernel: [610169.853772] init: tlsdated state changed from stopping to killed\n2022-08-24T21:30:15.998766Z INFO kernel: [610169.855162] init: Sending TERM signal to tlsdated main process (4206)\n2022-08-24T21:30:16.004525Z INFO kernel: [610169.862257] init: tlsdated main process (4206) exited normally\n2022-08-24T21:30:16.004624Z INFO kernel: [610169.862512] init: tlsdated state changed from killed to post-stop\n2022-08-24T21:30:16.009524Z INFO kernel: [610169.866998] init: tlsdated post-stop process (3450)\n2022-08-24T21:30:16.158514Z INFO kernel: [610170.016386] init: tlsdated post-stop process (3450) exited normally\n2022-08-24T21:30:16.158595Z INFO kernel: [610170.016542] init: tlsdated state changed from post-stop to waiting\n2022-08-24T21:30:16.160494Z INFO kernel: [610170.018395] init: Handling stopped event\n/// \u0027stop\u0027 command returned\n```\n\nI guess it can be OK to do something like this speculatively, but I\u0027m not all that optimistic.\n\nOr maybe you don\u0027t _really_ think this needs polling, but you want to catch the failure sooner? In which case, you could drop the testing.Poll() and make this just a single check/error.",
      "range": {
        "startLine": 60,
        "startChar": 11,
        "endLine": 60,
        "endChar": 43
      },
      "revId": "8846e6530cf36452b6928c506168de6b0dc51fc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "61c69ac4_5103740c",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/boot_perf_service.go",
        "patchSetId": 1
      },
      "lineNbr": 60,
      "author": {
        "id": 1294890
      },
      "writtenOn": "2022-08-25T07:21:19Z",
      "side": 1,
      "message": "Right, the post-stop stanza should already finished. I took the approach by checking that tlsdated is in a valid state and restart it if it\u0027s not in PS#3.",
      "parentUuid": "be28c15c_eb6a5bfc",
      "range": {
        "startLine": 60,
        "startChar": 11,
        "endLine": 60,
        "endChar": 43
      },
      "revId": "8846e6530cf36452b6928c506168de6b0dc51fc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d6570e94_587fab11",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/boot_perf_service.go",
        "patchSetId": 1
      },
      "lineNbr": 60,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2022-08-25T20:44:56Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "61c69ac4_5103740c",
      "range": {
        "startLine": 60,
        "startChar": 11,
        "endLine": 60,
        "endChar": 43
      },
      "revId": "8846e6530cf36452b6928c506168de6b0dc51fc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f38b2a6a_4d51cf5d",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/boot_perf_service.go",
        "patchSetId": 1
      },
      "lineNbr": 63,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2022-08-24T22:10:49Z",
      "side": 1,
      "message": "also, if we were worrying about pre-reboot persisting to disk (as floated on $BUG), this isn\u0027t really the file to look for. yes we want this file to exist; but it\u0027s in tmpfs and not \"flushing\" anywhere, and the _real_ thing we want is for this to run afterward:\n\nhttps://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/platform2/init/chromeos_shutdown;l\u003d156;drc\u003d9e40a92f3d7343c519753451b0c69b4e5391a691\n\nOf course, we can\u0027t really poll for that one...\n\n... so again, I don\u0027t really know if polling this file gets us very far.",
      "range": {
        "startLine": 63,
        "startChar": 0,
        "endLine": 63,
        "endChar": 52
      },
      "revId": "8846e6530cf36452b6928c506168de6b0dc51fc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "121c6488_9bda9578",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/boot_perf_service.go",
        "patchSetId": 1
      },
      "lineNbr": 63,
      "author": {
        "id": 1267126
      },
      "writtenOn": "2022-08-24T22:25:22Z",
      "side": 1,
      "message": "Is the problem that the script (https://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/platform2/bootstat/bootstat_archive;l\u003d26;drc\u003d9c78bfe80aaf8ae7d3cea311d99599612d538ead) can\u0027t follow symlinks in `/tmp`? Do we do something differently with `/tmp` when testing?",
      "parentUuid": "f38b2a6a_4d51cf5d",
      "range": {
        "startLine": 63,
        "startChar": 0,
        "endLine": 63,
        "endChar": 52
      },
      "revId": "8846e6530cf36452b6928c506168de6b0dc51fc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e978544_04da24e2",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/boot_perf_service.go",
        "patchSetId": 1
      },
      "lineNbr": 63,
      "author": {
        "id": 1294890
      },
      "writtenOn": "2022-08-25T07:21:19Z",
      "side": 1,
      "message": "Right, this is unlikely a file flush timing issue. When the failure is seen, rtc-sync-tlsdated-start is also missing, and the test won\u0027t find the file in the bootstat.\n\nI proposed restarting tlsdated if the sync-rtc files is not found before reboot. It\u0027s still unknown why tlsdated is running but the sync-rtc file is missing, but restarting tlsdated may help given that some failures are found in reboot iteration 2 or 3.\n\nI don\u0027t think the bug is related to symlinks under /tmp since the bootstat files are not symlinks.",
      "parentUuid": "121c6488_9bda9578",
      "range": {
        "startLine": 63,
        "startChar": 0,
        "endLine": 63,
        "endChar": 52
      },
      "revId": "8846e6530cf36452b6928c506168de6b0dc51fc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4d0be00f_7d96e596",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/boot_perf_service.go",
        "patchSetId": 1
      },
      "lineNbr": 71,
      "author": {
        "id": 1132414
      },
      "writtenOn": "2022-08-24T21:37:10Z",
      "side": 1,
      "message": "seems slightly long to penalize for a miss",
      "range": {
        "startLine": 71,
        "startChar": 12,
        "endLine": 71,
        "endChar": 23
      },
      "revId": "8846e6530cf36452b6928c506168de6b0dc51fc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f692ff7d_727225c2",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/boot_perf_service.go",
        "patchSetId": 1
      },
      "lineNbr": 71,
      "author": {
        "id": 1294890
      },
      "writtenOn": "2022-08-25T07:21:19Z",
      "side": 1,
      "message": "This is removed in PS#3.",
      "parentUuid": "4d0be00f_7d96e596",
      "range": {
        "startLine": 71,
        "startChar": 12,
        "endLine": 71,
        "endChar": 23
      },
      "revId": "8846e6530cf36452b6928c506168de6b0dc51fc6",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}