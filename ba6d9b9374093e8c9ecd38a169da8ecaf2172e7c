{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "bb7f772f_00396b8f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2020-10-31T00:16:25Z",
      "side": 1,
      "message": "vm?",
      "range": {
        "startLine": 9,
        "startChar": 28,
        "endLine": 9,
        "endChar": 30
      },
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "152ef60c_828ea5a8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-11-02T02:55:59Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bb7f772f_00396b8f",
      "range": {
        "startLine": 9,
        "startChar": 28,
        "endLine": 9,
        "endChar": 30
      },
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b736b67_9b4f0d59",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 10,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2020-10-31T00:16:25Z",
      "side": 1,
      "message": "This is similar to src/chromiumos/tast/local/bundles/cros/crostini/run_with_arc.go (but seems more generic). Once you finish this, you might want to delete run_with_arc.go. Please talk to niwa@ (author of the test) too.",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e60af5e_00b98cb1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 10,
      "author": {
        "id": 1256179
      },
      "writtenOn": "2020-11-02T00:39:31Z",
      "side": 1,
      "message": "nice!\n\nFYI, b/141783450 is a tracking bug for generalizing run_with_arc.go",
      "parentUuid": "0b736b67_9b4f0d59",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3bcc01ce_81264a66",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 10,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-11-02T02:55:59Z",
      "side": 1,
      "message": "Yeah, I starting trying to write memory tests with crostini.StartedARCEnabled, but it was buggy because it didn\u0027t clean up ARCVM between tests, and didn\u0027t expose *arc.ARC on the PreData, so I wrote this.\n\nI think crostini.RunWithARC is the only test that uses StartedARCEnabled. And I think the multivm.Login.arc_crostini does the same thing as RunWithArc, so I\u0027ll update that bug to mention that it\u0027s OK to delete that test (and the crostini.StartedARCEnabled precondition)",
      "parentUuid": "7e60af5e_00b98cb1",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d252c2f7_f5f394c0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 10,
      "author": {
        "id": 1256179
      },
      "writtenOn": "2020-11-02T04:16:02Z",
      "side": 1,
      "message": "SGTM. Thanks!",
      "parentUuid": "3bcc01ce_81264a66",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "55cd846d_955c0696",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 10,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-11-04T03:52:52Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "d252c2f7_f5f394c0",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "980c0cb7_f9118c96",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-10-28T07:27:24Z",
      "side": 1,
      "message": "Please do a full review.\n\nI\u0027ve got some WIP tests based on top of this, so I can evaluate any changes now with much more confidence.",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ff6beb7c_5135ad4d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2020-10-31T00:16:25Z",
      "side": 1,
      "message": "the concept seems fine. I\u0027m not too familiar with tast internals though. Some questions below:",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "82b2acf0_f54f5d5f",
        "filename": "src/chromiumos/tast/local/bundles/cros/multivm/login.go",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2020-10-31T00:16:25Z",
      "side": 1,
      "message": "Does this start both VMs in parallel? Or does this start ARCVM, wait for the package manager to be ready, and then start Crostini?\n\nAssuming it is the latter, can you add \"crostini_arc\"? In the past, we had issues where one VM prevented the other from starting e.g. due to vsock port conflict.",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "97e429db_ebf055a7",
        "filename": "src/chromiumos/tast/local/bundles/cros/multivm/login.go",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-11-02T02:55:59Z",
      "side": 1,
      "message": "The order is defined by StateManager.Activate in src/chromiumos/tast/local/multivm/state_manager.go.\n\nWe wait for ARC to complete booting and then start Crostini.\n\nSince ARC starts as part of the ChromeOS login, I don\u0027t know how you could make a crostini_arc variant.\n\nMy plan for tests that rely on specific ordering of VM startup would be to only use this precondition for the parts where ordering doesn\u0027t matter, and then launch the VM (using the same helpers that are used to implement this precondition) within the tests themselves.\n\nDoes this make sense? If we need to support arbitrary ordering of VM startup in the precondition, it will need to be refactored.",
      "parentUuid": "82b2acf0_f54f5d5f",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d537eed2_dc4d5b94",
        "filename": "src/chromiumos/tast/local/bundles/cros/multivm/login.go",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2020-11-02T07:29:02Z",
      "side": 1,
      "message": "\u003e Since ARC starts as part of the ChromeOS login,\n\nThis is not always true. When the user who hasn\u0027t opted into ARC++ signs in, ARCVM doesn\u0027t start automatically. In that case, ARCVM only starts when the user opts into ARC++ via Settings. The crostini_arc variant ensures that such an opt-in would never fail (because of Crostini.)\n\nYury (khmel@) should know how to trigger opt-in in Tast tests.",
      "parentUuid": "97e429db_ebf055a7",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93baf2b4_9b4d4e26",
        "filename": "src/chromiumos/tast/local/bundles/cros/multivm/login.go",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1000303
      },
      "writtenOn": "2020-11-03T21:39:15Z",
      "side": 1,
      "message": "niwa@\u0027s test might be doing a similar thing already? It starts Crostini first, then ARCVM IIRC.",
      "parentUuid": "d537eed2_dc4d5b94",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "29ca4a39_bd440550",
        "filename": "src/chromiumos/tast/local/bundles/cros/multivm/login.go",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-11-04T03:52:52Z",
      "side": 1,
      "message": "OK, so it\u0027s OK to have the ARCVM opt-in code in a helper somewhere, and then use that for tests that care about ordering, and rely on multivm preconditions for tests where ordering doesn\u0027t matter?\n\nWhich is niwa@\u0027s test?",
      "parentUuid": "93baf2b4_9b4d4e26",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ddc9d1c3_574af596",
        "filename": "src/chromiumos/tast/local/bundles/cros/multivm/login.go",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1256179
      },
      "writtenOn": "2020-11-04T04:13:12Z",
      "side": 1,
      "message": "run_with_arc.go is the one.",
      "parentUuid": "29ca4a39_bd440550",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d9fdccb_2b98d98d",
        "filename": "src/chromiumos/tast/local/multivm/state_manager.go",
        "patchSetId": 6
      },
      "lineNbr": 273,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-10-28T07:27:24Z",
      "side": 1,
      "message": "Matthew, would it be possible to reboot the VM and restore to a previous disk snapshot? How fast would that be?\n\nI\u0027m worries that if we don\u0027t clean up, files/services/programs left over from previous tests will make the results unstable.",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7c70b986_dfbaec03",
        "filename": "src/chromiumos/tast/local/multivm/state_manager.go",
        "patchSetId": 6
      },
      "lineNbr": 273,
      "author": {
        "id": 1370239
      },
      "writtenOn": "2020-10-28T23:15:05Z",
      "side": 1,
      "message": "currently the Crostini tests don\u0027t do any formal restore between tests, generally we haven\u0027t seen significant problems from state leaked between tests.\n\nMost of the crostini tests clean up the files they create, but it hasn\u0027t een a significant issue yet.\n\nThe backup restore test takes ~3 minutes to run.  I\u0027m not sure how much of that is the actual restore, but if it is significant it is not realistic to run it each time.",
      "parentUuid": "3d9fdccb_2b98d98d",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4c80fb1f_439b537d",
        "filename": "src/chromiumos/tast/local/multivm/state_manager.go",
        "patchSetId": 6
      },
      "lineNbr": 273,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-10-29T01:18:23Z",
      "side": 1,
      "message": "Yeah, three minutes per test is too much. I will just make sure we have careful cleanup logic in the Crostini tests I add.",
      "parentUuid": "7c70b986_dfbaec03",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4e4da26d_75c2a514",
        "filename": "src/chromiumos/tast/local/multivm/state_manager.go",
        "patchSetId": 6
      },
      "lineNbr": 330,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-10-28T07:27:24Z",
      "side": 1,
      "message": "Matthew, any input on what we should do here? Is stopping the VM enough?",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "95826f03_7d206371",
        "filename": "src/chromiumos/tast/local/multivm/state_manager.go",
        "patchSetId": 6
      },
      "lineNbr": 330,
      "author": {
        "id": 1370239
      },
      "writtenOn": "2020-10-28T23:15:05Z",
      "side": 1,
      "message": "Clarified with the engineers, there is no longer any need to stop Concierge.  I will e updating the precondition when I get some time.",
      "parentUuid": "4e4da26d_75c2a514",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dace6632_2c31d894",
        "filename": "src/chromiumos/tast/local/multivm/state_manager.go",
        "patchSetId": 6
      },
      "lineNbr": 330,
      "author": {
        "id": 1368712
      },
      "writtenOn": "2020-11-02T02:55:59Z",
      "side": 1,
      "message": "Could you add an item to update this precondition with whatever you decide to do? I\u0027d like to keep this in sync with what crostini does.\n\nMaybe expose helpers like arc does with StateManager, so that it\u0027s easy to use the same code in both the crostini and multivm preconditions.\n\nI\u0027m happy to the work if it\u0027s already well scoped and not too complicated.",
      "parentUuid": "95826f03_7d206371",
      "revId": "ba6d9b9374093e8c9ecd38a169da8ecaf2172e7c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}