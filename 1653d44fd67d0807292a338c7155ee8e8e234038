{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "01d933da_88e4e943",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1346383
      },
      "writtenOn": "2022-09-14T08:08:27Z",
      "side": 1,
      "message": "Thanks for the review! PTAL, thanks.",
      "revId": "1653d44fd67d0807292a338c7155ee8e8e234038",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d45157a6_d66d8027",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/dns/dns.go",
        "patchSetId": 5
      },
      "lineNbr": 535,
      "author": {
        "id": 1307765
      },
      "writtenOn": "2022-09-15T00:21:06Z",
      "side": 1,
      "message": "how reasonable would it be to make this the single cleanup method for this function and just set it here on success? e.g.\n\ncleanup :\u003d func() {\n  ...\n}\nclean :\u003d true\n\ndefer {\n  if !clean return\n  cleanup()\n}\n\n...\n\nclean \u003d false\nreturn Env {\n   ..\n   Cleanup: cleanup\n}\n\n\nthat would get rid of the stacked cleanup defers you\u0027re accumulating...",
      "range": {
        "startLine": 522,
        "startChar": 11,
        "endLine": 535,
        "endChar": 4
      },
      "revId": "1653d44fd67d0807292a338c7155ee8e8e234038",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7daf303a_7bd2739d",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/dns/dns.go",
        "patchSetId": 5
      },
      "lineNbr": 535,
      "author": {
        "id": 1346383
      },
      "writtenOn": "2022-09-15T01:30:40Z",
      "side": 1,
      "message": "Unfortunately this doesn\u0027t work :(\nI tried something similar to this to make the code cleaner earlier.\n\nThis reason it does not work is because the cleanup can only be run if the action_to_be_cleaned_up is done e.g. the certs cleanup can only be done after certs creation and if the failure happened prior to the certs creation the cleanup can\u0027t be done.\n\nFor methods like shill\u0027s ProfilePropertyCheckPortalList where it does not care about the prior action, this can be done. However, the shill call is the only one within the bunch of defers here.",
      "parentUuid": "d45157a6_d66d8027",
      "range": {
        "startLine": 522,
        "startChar": 11,
        "endLine": 535,
        "endChar": 4
      },
      "revId": "1653d44fd67d0807292a338c7155ee8e8e234038",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0c9fde22_393ca193",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/dns/dns.go",
        "patchSetId": 5
      },
      "lineNbr": 535,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-09-15T01:38:47Z",
      "side": 1,
      "message": "I will make Cleanup as a member function on Struct Env, i.e.,\n```\nfunc (e *Env) Cleanup(ctx) error {\n  ...\n}\n```\nThen make the cleanupCert also as a member in Env, and call that only when it is not nil in Cleanup().",
      "parentUuid": "7daf303a_7bd2739d",
      "range": {
        "startLine": 522,
        "startChar": 11,
        "endLine": 535,
        "endChar": 4
      },
      "revId": "1653d44fd67d0807292a338c7155ee8e8e234038",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "712cfa5b_dbd12f5a",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/dns/dns.go",
        "patchSetId": 5
      },
      "lineNbr": 535,
      "author": {
        "id": 1307765
      },
      "writtenOn": "2022-09-15T03:08:15Z",
      "side": 1,
      "message": "Yea if you have all the state in Env that\u0027s nice. This wouldn\u0027t be an unreasonable spot to use those name returns either for example:\n\nNew()... (env *Env, error) {\n e :\u003d \u0026Env{}\n defer func() {\n   if e !\u003d nil {\n     e.Cleanup()\n   }\n }\n ..stuff...\n e.X \u003d ...\n ...\n ...all good...\n env \u003d e\n e \u003d nil\n}",
      "parentUuid": "0c9fde22_393ca193",
      "range": {
        "startLine": 522,
        "startChar": 11,
        "endLine": 535,
        "endChar": 4
      },
      "revId": "1653d44fd67d0807292a338c7155ee8e8e234038",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "050419b5_611f3ab2",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/dns/dns.go",
        "patchSetId": 5
      },
      "lineNbr": 535,
      "author": {
        "id": 1346383
      },
      "writtenOn": "2022-09-15T04:02:25Z",
      "side": 1,
      "message": "Looks nice! Sorry I couldn\u0027t catch this earlier and thanks for the suggestions! Done.",
      "parentUuid": "712cfa5b_dbd12f5a",
      "range": {
        "startLine": 522,
        "startChar": 11,
        "endLine": 535,
        "endChar": 4
      },
      "revId": "1653d44fd67d0807292a338c7155ee8e8e234038",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93f63b61_8f523fe9",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/dns/dns.go",
        "patchSetId": 5
      },
      "lineNbr": 540,
      "author": {
        "id": 1307765
      },
      "writtenOn": "2022-09-15T00:21:06Z",
      "side": 1,
      "message": "nit: is it possible to make the naming consistent between SetupDNSEnv and this func? It looks like they are the same general thing, so maybe call them both either Setup or Create (or New). Also, I would drop the \"DNS\" part since these are already in the dns package, so dns.NewEnv and dns.NewServerEnv look better to me.",
      "range": {
        "startLine": 540,
        "startChar": 5,
        "endLine": 540,
        "endChar": 23
      },
      "revId": "1653d44fd67d0807292a338c7155ee8e8e234038",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "928853a0_121c9974",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/dns/dns.go",
        "patchSetId": 5
      },
      "lineNbr": 540,
      "author": {
        "id": 1346383
      },
      "writtenOn": "2022-09-15T01:30:40Z",
      "side": 1,
      "message": "SGTM, I changed it to `CreateEnv` (creating DNS environment) and `CreateServer` (creating DNS/DoH server). Let me know if this does not work, thanks!",
      "parentUuid": "93f63b61_8f523fe9",
      "range": {
        "startLine": 540,
        "startChar": 5,
        "endLine": 540,
        "endChar": 23
      },
      "revId": "1653d44fd67d0807292a338c7155ee8e8e234038",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}