{
  "comments": [
    {
      "key": {
        "uuid": "723d1f81_410e1503",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "please name this test MIDIClient instead: https://github.com/golang/go/wiki/CodeReviewComments#initialisms",
      "range": {
        "startLine": 24,
        "startChar": 16,
        "endLine": 24,
        "endChar": 26
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f38df217_b88bbf19",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 24,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "723d1f81_410e1503",
      "range": {
        "startLine": 24,
        "startChar": 16,
        "endLine": 24,
        "endChar": 26
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e47b029c_153b4165",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "i initially interpreted this as being a normal tcp/udp port and wondered why it wasn\u0027t an int instead. looking at the example output, it seems like it might be e.g. \"14:0\" instead. mind describing the format here to make it clearer?",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5daeb8b1_8665da86",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 34,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e47b029c_153b4165",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "264ca265_f1bcbf11",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 36,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "please pass ctx to this function instead and make it return (int, error). then errors can be handled (e.g. by failing the test) from your main test function.",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7c032bc8_7c875540",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 36,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "264ca265_f1bcbf11",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4f05ad2a_1c333825",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 37,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: please use testexec.CommandContext instead (which handles test timeouts properly)",
      "range": {
        "startLine": 37,
        "startChar": 13,
        "endLine": 37,
        "endChar": 25
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9d23e14d_36633396",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 37,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4f05ad2a_1c333825",
      "range": {
        "startLine": 37,
        "startChar": 13,
        "endLine": 37,
        "endChar": 25
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a7f84446_cbcda299",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 50,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: can just do this:\n\n  for _, line :\u003d range strings.Split(...)",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64f7f2a9_d296794f",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 50,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T20:17:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a7f84446_cbcda299",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "eddb7b66_c7fb0fe7",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 51,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "can you use a regular expression here instead? based on the example output above, something like the following seems like it might work for capturing the port and client name:\n\n  ^(\\d+:\\d+)\\s\\s+(.+)\\s\\s+",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4179ca68_41b92cac",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 51,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2019-01-28T03:02:07Z",
      "side": 1,
      "message": "+1. Just a nitpick, but \\s\\s+ \u003d \\s{2,}",
      "parentUuid": "eddb7b66_c7fb0fe7",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5fe566ec_5a82ff50",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 51,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-28T23:22:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4179ca68_41b92cac",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "466aa983_32eb6918",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 52,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "see above regexp comment, but otherwise, please continue if len(fields) \u003c 2 here to avoid crashes on unexpected output",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f48cb3b4_86a41224",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 52,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-28T23:22:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "466aa983_32eb6918",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a69f8e5b_a3af3f05",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2019-01-28T03:02:07Z",
      "side": 1,
      "message": "You can do just: client \u003d\u003d \"Midi Through\"",
      "range": {
        "startLine": 53,
        "startChar": 5,
        "endLine": 53,
        "endChar": 51
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86f3f636_719f3fa6",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 53,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-28T23:22:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a69f8e5b_a3af3f05",
      "range": {
        "startLine": 53,
        "startChar": 5,
        "endLine": 53,
        "endChar": 51
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8270a056_3f32038e",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 69,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: \u003d\u003d 0? lengths can\u0027t be negative",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b487073c_d8768286",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 69,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Ack\n\nChanged to using error return values, so this isn\u0027t needed anymore.",
      "parentUuid": "8270a056_3f32038e",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3aad3298_b8bd5151",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 70,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: no trailing periods in log/error messages:\n\nhttps://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/writing_tests.md#Formatting",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9df682d0_91580cbd",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 70,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3aad3298_b8bd5151",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "79684d00_660aeb67",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: i think that a tast-specific base is already used here, so something like \"arc.MIDIClient.\" may be better",
      "range": {
        "startLine": 74,
        "startChar": 31,
        "endLine": 74,
        "endChar": 46
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ac3d89a6_14c8bf1a",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "79684d00_660aeb67",
      "range": {
        "startLine": 74,
        "startChar": 31,
        "endLine": 74,
        "endChar": 46
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2674da2d_54dcda08",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 79,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "i suspect that you don\u0027t need this chmod call",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "39e19235_fde01647",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 79,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2674da2d_54dcda08",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9a8c1483_48ef9e52",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 85,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: please use testexec.CommandContext here too",
      "range": {
        "startLine": 85,
        "startChar": 8,
        "endLine": 85,
        "endChar": 20
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8c624c76_cf1eaaec",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 85,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9a8c1483_48ef9e52",
      "range": {
        "startLine": 85,
        "startChar": 8,
        "endLine": 85,
        "endChar": 20
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a4f951c_edd00f3f",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 89,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2019-01-28T03:02:07Z",
      "side": 1,
      "message": "Once cmd.Start() succeeds, we have to make sure cmd.Wait() is called exactly once and wait for it to return in order to release associated resources.",
      "range": {
        "startLine": 89,
        "startChar": 0,
        "endLine": 89,
        "endChar": 46
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e5f90c49_36c51483",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 89,
      "author": {
        "id": 1181480
      },
      "writtenOn": "2019-02-18T21:35:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1a4f951c_edd00f3f",
      "range": {
        "startLine": 89,
        "startChar": 0,
        "endLine": 89,
        "endChar": 46
      },
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0d187977_5e598909",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T10:31:19Z",
      "side": 1,
      "message": "i don\u0027t think you need to do this in a goroutine. you should probably be able to just do something like this later:\n\n  if err :\u003d cmd.Wait(); err !\u003d nil {\n      s.Fatal(...)\n  }\n\nbut i\u0027m wondering if the whole thing could instead look like this:\n\n  testing.Poll to wait for file to be nonempty\n  cmd.Kill\n\nor are you never seeing arecordmidi write anything to the log until you explicitly send it SIGINT?",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f7c60b7_4e0f26ac",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T11:00:27Z",
      "side": 1,
      "message": "(I had written a long comment explaining this, but I accidentally closed the tab without saving :/ )\n\nI tried using the testing.Poll() construct you suggested, but even with a 10 second timeout, with a 1 second interval, I couldn\u0027t see any data in the file. So it\u0027s highly likely the latter, i.e SIGINT is required to dump out the contents to the file.",
      "parentUuid": "0d187977_5e598909",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2e4b8f4b_92377d11",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T12:22:40Z",
      "side": 1,
      "message": "hmm. so there\u0027s no way to tell when it\u0027s safe to make the process exit since it doesn\u0027t actually write the received events until it exits? that\u0027s pretty unfortunate. :-(\n\ndoes the android activity exit after it writes the message, and if so, is there any way you can wait for it to exit? then the logic could be more like this, which seems safer:\n\n- start activity\n- wait for activity to exit\n- wait 5 seconds for arecordmidi to receive event (or some amount that\u0027s plenty long)\n- send SIGINT to arecordmidi\n- if needed, use testing.Poll to wait for file to be nonempty\n- read file\n\ni\u0027m not sure how big of a program arecordmidi is, but i wonder if it\u0027d be easier to just fix whatever causes the delay before the file is written and add a flag that can be used to tell it to exit automatically after receiving and writing an event. that\u0027d simplify this test and make it faster and more robust, at least.",
      "parentUuid": "2f7c60b7_4e0f26ac",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05fbdb75_c93fd9b1",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T20:17:00Z",
      "side": 1,
      "message": "\u003e\u003e wait for activity to exit\nThe one way I can think of is to just do \"ps | grep \u003cpackage name\u003e\" and a nil output means the app has exited (although currently we don\u0027t exit it, but I can update the app to do so). WDYT?\n\n\u003e\u003e wait 5 seconds for arecordmidi to receive event (or some amount that\u0027s plenty long)\nSure. I think 5 seconds might be more than sufficient (the concern here is adding more time to overall test execution time; which in turn might affect CQ times...).\n\nRE: arecordmidi, IMO it\u0027ll :\n- be non-trivial to get a fix in regarding the buffering (assuming it is a bug; I\u0027ve not seen arecordmidi source so it might actually be WAI for efficiency reasons)\n- be a tough sell to add the flag to exit after receiving a single event (the intended use-case for arecordmidi seems to be to record regular MIDI files with \u003e than 1 message; not sure if the author may want to add a flag for this specific use case).\n\nGiven the above, I don\u0027t believe it is worth the effort.\n\nOverall, I think the current version you\u0027ve outlined in the comment would be of sufficient robustness. Thoughts? If we have concurrence, I can go ahead and can work on the remaining comments.",
      "parentUuid": "2e4b8f4b_92377d11",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "185b4971_7669da33",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-27T00:47:46Z",
      "side": 1,
      "message": "looking at http://git.alsa-project.org/?p\u003dalsa-utils.git;a\u003dblob;f\u003dseq/aplaymidi/arecordmidi.c;hb\u003dHEAD, it seems trivial to add a flag to main() to exit after a single event (which seems like it has a good chance of fixing any buffering issues too):\n\n- add a new switch (\"1\"?) to short_options\n- add a var and a case statement that sets it\n- make the main for loop break after reading an event if the var is set\n\nthis doesn\u0027t necessarily need to be upstreamed; it\u0027s fine to just apply the patch in our ebuild file.\n\ni prefer this approach, since it will also make the test faster, simpler, and less likely to be flaky.",
      "parentUuid": "05fbdb75_c93fd9b1",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b4120544_5943c5b4",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-28T21:02:49Z",
      "side": 1,
      "message": "Thanks for the comments Dan.\n\nI agree that the above approach makes the test faster (not sure about less flaky, since the flush ensures the file is written out and all test iterations pass).\n\nI have reservations about maintaining an ebuild patch for upstream libraries. If this patch isn\u0027t upstreamed, there is a maintenance overhead:\n- If upstream alsa-utils owners re-organize the directory structure.\n- Re-arrange code within the file.\n- Make legitimate changes to the file.\n\nAdmittedly most of the above is unlikely given the log history of this file. But I don\u0027t feel comfortable signing up for fixing a conflict that may arise say 18 months in the future, when  potentially someone else could be handling this feature (maintaining the APK against Android API changes itself is a maintenance overhead, but that is unavoidable).\n\nI understand ebuild patches are common elsewhere in Chrome OS, but I\u0027d like to understand \u0026 set expectations about the maintenance responsibility of the ebuild patch file.\n\nI\u0027d be happy to discuss this over IM, if that is the more appropriate forum for this discussion.",
      "parentUuid": "185b4971_7669da33",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "31b4933d_f61a259d",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-28T23:22:27Z",
      "side": 1,
      "message": "FWIW, since people are in other time zones / OOO, I thought I\u0027d speculatively create the CL which adds the functinality: crrev.com/c/1440846",
      "parentUuid": "b4120544_5943c5b4",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f1c31b8_1b83f83a",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 118,
      "author": {
        "id": 1181480
      },
      "writtenOn": "2019-02-18T21:35:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "31b4933d_f61a259d",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f97dd13f_0f0d4038",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 120,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "instead of sleeping, which is likely to result in a flaky test (because sometimes it will take longer), can you make the test wait just as long as in necessary?\n\nfor example, can you use testing.Poll to repeatedly stat the file and wait for it to have a nonzero size?",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c0bf3e8_2f874153",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 120,
      "author": {
        "id": 1181480
      },
      "writtenOn": "2019-02-18T21:35:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f97dd13f_0f0d4038",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "beb32b58_405de4bc",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 124,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: remove trailing period",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d188efda_4ec405d8",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 124,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "beb32b58_405de4bc",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e89afc71_ba36cd4c",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 131,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "does this actually do anything? i\u0027d expect any buffering to be happening in arecordmidi, so i\u0027m not sure that opening and syncing from the test helps.",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "60f03dc5_0fedee45",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 131,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T03:57:47Z",
      "side": 1,
      "message": "Without this sync, I ran this test 5 times on a loop and it was flaky (50% of the time when then file was read on L144, the file didn\u0027t have any contents).\n\nWith the sync, it contains the valid byte data on every run. For some reason, terminating the process with SIGINT (which is the prescribed way to stop arecordmidi, according the it\u0027s doc page) causes some raciness w.r.t buffering the data and writing it to the file.",
      "parentUuid": "e89afc71_ba36cd4c",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87e64363_60751ce1",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 131,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T10:31:19Z",
      "side": 1,
      "message": "i wonder if there\u0027s just some other cause of a delay between the process exiting and the data being present in the file. for example, maybe arecordmidi could be launching a child process that actually does the writing, and calling Sync just adds a long enough delay that the write typically happens before you read the file later.\n\ncan you try adding a testing.Poll call to figure out if there\u0027s just a delay? something like the following might work (untested):\n\n  if err :\u003d testing.Poll(ctx, func(ctx context.Context) error {\n      fi, err :\u003d os.Stat(midiFile)\n      if err !\u003d nil {\n          log.Printf(\"Failed to stat %v: %v\", midiFile, err)  // debug\n          return err\n      }\n      if fi.Size() \u003d\u003d 0 {\n          log.Print(midiFile, \" is empty\")  // debug\n          return errors.New(\"file is empty\")\n      }\n      return nil\n  }, nil); err !\u003d nil {\n      s.Fatal(\"Failed to wait for arecordmidi log: \", err)\n  }",
      "parentUuid": "60f03dc5_0fedee45",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7f56cbd7_69d076ee",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 131,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T11:00:27Z",
      "side": 1,
      "message": "I think my previous response addresses this comment, but in short, sounds like SIGINT is what triggers the actually copying of data to the file.\n\nSo, that could be the cause of the race I was seeing earlier (and calling sync probably eliminates that / makes it less likely).",
      "parentUuid": "87e64363_60751ce1",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9a63a486_bc90d7f5",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 131,
      "author": {
        "id": 1181480
      },
      "writtenOn": "2019-02-18T21:35:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7f56cbd7_69d076ee",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c96f612b_0be626f9",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 135,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "in select statements, please also include a \"case \u003c-ctx.Done\" case to handle test timeouts",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "35d1566a_8dc6f0e9",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 135,
      "author": {
        "id": 1181480
      },
      "writtenOn": "2019-02-18T21:35:03Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "c96f612b_0be626f9",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "86fed135_47172e1a",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 139,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: slightly shorter with as single constant:\n\n  const minLen \u003d 43 // ...",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "609f8b52_d8cc2676",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 139,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "86fed135_47172e1a",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bd20dbb1_03bb653e",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 146,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: how about using Fatalf and including the path?",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c2d09e8f_e83c551a",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 146,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T11:00:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bd20dbb1_03bb653e",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "264a8c97_b4aa0794",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 150,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: delete trailing period; please also add spaces before \u0027(\u0027",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70c39edf_d7459b21",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 150,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T10:48:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "264a8c97_b4aa0794",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "340d1c94_6f3a7f02",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 156,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-01-26T03:48:32Z",
      "side": 1,
      "message": "nit: please include space after \u0027expected:\u0027, but i\u0027d also follow the usual go style:\n\n  \"Got MIDI message %v; want %v\"",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c2a23949_a7d6fd20",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/midi_client.go",
        "patchSetId": 3
      },
      "lineNbr": 156,
      "author": {
        "id": 1181774
      },
      "writtenOn": "2019-01-26T11:00:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "340d1c94_6f3a7f02",
      "revId": "33615daa7f10845529b25102177a07aa81bb7af3",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}