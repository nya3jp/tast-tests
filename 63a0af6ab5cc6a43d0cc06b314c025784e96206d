{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e6ed439f_5d85eec1",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 24,
      "author": {
        "id": 1163499
      },
      "writtenOn": "2022-09-16T04:33:33Z",
      "side": 1,
      "message": "nit: Please add \u0027arc-framework+tast@google.com\u0027 as well.",
      "range": {
        "startLine": 24,
        "startChar": 80,
        "endLine": 24,
        "endChar": 84
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "67604c20_f2d1ca94",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 24,
      "author": {
        "id": 1553967
      },
      "writtenOn": "2022-09-16T05:52:16Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e6ed439f_5d85eec1",
      "range": {
        "startLine": 24,
        "startChar": 80,
        "endLine": 24,
        "endChar": 84
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d46e78b_ffe10b68",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 75,
      "author": {
        "id": 1163499
      },
      "writtenOn": "2022-09-16T04:33:33Z",
      "side": 1,
      "message": "nit: Let\u0027s use activity.SetWindowState() instead. It\u0027s easier to read and have better support for multiple ARC++ versions.\n```\nif _, err :\u003d act.SetWindowState(ctx, tconn, ash.WMEventMaximize); err !\u003d nil {\n  ...\n}\n```",
      "range": {
        "startLine": 75,
        "startChar": 14,
        "endLine": 75,
        "endChar": 39
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6f2ee9e_4511a53e",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 75,
      "author": {
        "id": 1553967
      },
      "writtenOn": "2022-09-16T05:52:16Z",
      "side": 1,
      "message": "Thank you! I added some changes, could you check it?",
      "parentUuid": "2d46e78b_ffe10b68",
      "range": {
        "startLine": 75,
        "startChar": 14,
        "endLine": 75,
        "endChar": 39
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7ed07914_944224a3",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 75,
      "author": {
        "id": 1553967
      },
      "writtenOn": "2022-09-16T08:27:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a6f2ee9e_4511a53e",
      "range": {
        "startLine": 75,
        "startChar": 14,
        "endLine": 75,
        "endChar": 39
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab4bfec5_e8b580d3",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1163499
      },
      "writtenOn": "2022-09-16T04:33:33Z",
      "side": 1,
      "message": "Using ash.WaitForARCAppWindowState() is probably more robust. Could you try that?\n```\nif err :\u003d ash.WaitForARCAppWindowState(ctx, tconn, act.PackageName(), ash.WMEventMaximize); err !\u003d nil {\n  ...\n}\n```",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aec38a20_37af2d90",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1553967
      },
      "writtenOn": "2022-09-16T05:52:16Z",
      "side": 1,
      "message": "I added some changes, could you check it? Thank you!",
      "parentUuid": "ab4bfec5_e8b580d3",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "64c51d6b_de90ef70",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1510928
      },
      "writtenOn": "2022-09-16T06:01:44Z",
      "side": 1,
      "message": "I think here we use Sleep because we need wait until \"WM animation finish\". However there isn\u0027t a way to indicate it. ash.WaitForARCAppWindowState just wait the window state change finished in exo side, and not related with animation.\n\nSince we want to trace how many frames are jankness during animation, so here I prefer Sleep an enough time gap for make sure animation won\u0027t terminated before finished.\n\nWhat do you think? Thanks.",
      "parentUuid": "aec38a20_37af2d90",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3b4ee94_d132830d",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1553967
      },
      "writtenOn": "2022-09-16T06:31:40Z",
      "side": 1,
      "message": "Thank you! So we need to sleep here to gather enough trace to see whether the frame is janky or not, is my understanding correct?",
      "parentUuid": "64c51d6b_de90ef70",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8e4ca037_ad45fa03",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1163499
      },
      "writtenOn": "2022-09-16T06:42:26Z",
      "side": 1,
      "message": "Good point. I re-checked the implementation of activity.SetWindowState().\nIt calls ash.SetWindowState() [1] with \u0027false\u0027 for waitForStateChange.\nSo, using ash.SetARCAppWindowStateAndWait()[2] is probably better in this case. Sorry for the confusion!\n\nI am not sure whether we can remove the sleep at all by using \u0027AndWait\u0027 variant or not. It waits for animation finished on Chrome side, so might not be suitable for this case.\n\n\n[1]: https://source.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/arc/activity.go;l\u003d876\n[2]: https://source.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/chrome/ash/wm.go;l\u003d313?q\u003dWaitForARCAppWindowState",
      "parentUuid": "b3b4ee94_d132830d",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b18ce9f1_e62f064d",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1510928
      },
      "writtenOn": "2022-09-16T07:06:00Z",
      "side": 1,
      "message": "Check that the animating tag in ash.SetARCAppWindowStateAndWait marked here [1]. Seems like it indicating if ui::LayerAnimator in animating. I\u0027m not sure if ARC animation use this Layer. Leave it to takise san.\n\n[1](https://source.chromium.org/chromium/chromium/src/+/main:chrome/browser/chromeos/extensions/autotest_private/autotest_private_api.cc;drc\u003dffbdfec17809781ad37c9fd1a5ee8dc3062c2767;l\u003d4397)",
      "parentUuid": "8e4ca037_ad45fa03",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e6bf4a6_2088b15e",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1298257
      },
      "writtenOn": "2022-09-16T07:13:30Z",
      "side": 1,
      "message": "I don\u0027t think either SetWindowState or SetARCAppWindowStateAndWait is sufficient but in a case like this we usually use window.IsAnimating in wm.go. Would you mind trying that?\n\nhttps://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/platform/tast-tests/src/chromiumos/tast/local/chrome/ash/wm.go;l\u003d177;drc\u003d8fbf2c53960bc8917a6a01fda5405cad7c17201e\n\nFor example, our PIP tast tests use this inside a Poll() function to wait for animation to finish:\n\nhttps://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/platform/tast-tests/src/chromiumos/tast/local/bundles/cros/arc/pip.go;l\u003d802-834;drc\u003d8fbf2c53960bc8917a6a01fda5405cad7c17201e",
      "parentUuid": "b18ce9f1_e62f064d",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0d83e220_b196e932",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1163499
      },
      "writtenOn": "2022-09-16T07:28:53Z",
      "side": 1,
      "message": "SetWindowStateAndWait() (and SetARCAppWindowStateAndWait()) waits until window.IsAnimating becomes false. SetWindowStateAndWait() and polling window.IsAnimating should have the same result.",
      "parentUuid": "7e6bf4a6_2088b15e",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b53e99d0_f2dd726d",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1510928
      },
      "writtenOn": "2022-09-16T07:31:10Z",
      "side": 1,
      "message": "AFAIK SetARCAppWindowStateAndWait also check this window.IsAnimating See https://source.corp.google.com/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/chrome/ash/wm.go;rcl\u003d8fbf2c53960bc8917a6a01fda5405cad7c17201e;l\u003d422\n\nThanks, let me clarify my question.\n\nIsAnimating generated from https://source.chromium.org/chromium/chromium/src/+/main:chrome/browser/chromeos/extensions/autotest_private/autotest_private_api.cc;drc\u003dffbdfec17809781ad37c9fd1a5ee8dc3062c2767;l\u003d4397, so I just wonder if this var can indicate \"android animation is finished\".",
      "parentUuid": "7e6bf4a6_2088b15e",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a50f24a4_fa616d3b",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1298257
      },
      "writtenOn": "2022-09-16T07:35:46Z",
      "side": 1,
      "message": "Oh sorry I didn\u0027t know that *Wait() function also checks the field.\n\nYeah to answer Tan\u0027s question, ARC uses the same animation as the one for chrome windows for maximize/restore, so *Wait() function should be sufficent.",
      "parentUuid": "0d83e220_b196e932",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a837ee49_10ec6905",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 80,
      "author": {
        "id": 1553967
      },
      "writtenOn": "2022-09-16T08:27:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a50f24a4_fa616d3b",
      "range": {
        "startLine": 80,
        "startChar": 5,
        "endLine": 80,
        "endChar": 11
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7d3e3e85_d271bb85",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 83,
      "author": {
        "id": 1163499
      },
      "writtenOn": "2022-09-16T04:33:33Z",
      "side": 1,
      "message": "ditto",
      "range": {
        "startLine": 83,
        "startChar": 32,
        "endLine": 83,
        "endChar": 40
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5dbc10b7_576453b1",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 83,
      "author": {
        "id": 1553967
      },
      "writtenOn": "2022-09-16T08:27:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7d3e3e85_d271bb85",
      "range": {
        "startLine": 83,
        "startChar": 32,
        "endLine": 83,
        "endChar": 40
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c418c4a5_5b6caa99",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 87,
      "author": {
        "id": 1163499
      },
      "writtenOn": "2022-09-16T04:33:33Z",
      "side": 1,
      "message": "ditto",
      "range": {
        "startLine": 87,
        "startChar": 11,
        "endLine": 87,
        "endChar": 21
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "186308e5_aba08884",
        "filename": "src/chromiumos/tast/local/bundles/cros/arc/perfetto_wm_jankness.go",
        "patchSetId": 8
      },
      "lineNbr": 87,
      "author": {
        "id": 1553967
      },
      "writtenOn": "2022-09-16T08:27:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c418c4a5_5b6caa99",
      "range": {
        "startLine": 87,
        "startChar": 11,
        "endLine": 87,
        "endChar": 21
      },
      "revId": "63a0af6ab5cc6a43d0cc06b314c025784e96206d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}