{
  "comments": [
    {
      "key": {
        "uuid": "a6214aff_4d921c42",
        "filename": "src/chromiumos/tast/local/ready/ready.go",
        "patchSetId": 2
      },
      "lineNbr": 117,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-06-02T10:12:19Z",
      "side": 1,
      "message": "I wonder what is a guarantee this snapshot gives to tests. Could you remind me when local_tpm_data is modified and when we have to rollback local_tpm_data?\n\nready.Wait is called on the beginning of a local bundle executable, but a local bundle executable may be executed multiple times to run local tests, e.g. when a local test crashed in the middle of execution. Thus having this code does not guarantee that the snapshot is taken before all local tests.",
      "range": {
        "startLine": 115,
        "startChar": 0,
        "endLine": 117,
        "endChar": 2
      },
      "revId": "3121b7915c4e341b5253a2e6460bc3d6d6399865",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "90300082_b6a79d7d",
        "filename": "src/chromiumos/tast/local/ready/ready.go",
        "patchSetId": 2
      },
      "lineNbr": 117,
      "author": {
        "id": 1322146
      },
      "writtenOn": "2020-06-03T01:23:47Z",
      "side": 1,
      "message": "The tpm local data can be modified if someone ask tpm manager to wipe the TPM owner password. W/o Chrome I don\u0027t see any other soncumers but worth validating with the real testcase running in informational. Yet, it doesn\u0027t mean we don\u0027t need snapshot for \"*-system\" testsuite. Even if we don\u0027t have any caller to tell tpm_manager to wipe the owner password -- 1. at least the test item in the near future that test against wiping owner password would do that, and 2. One day tpm manager might be able to just wipe the owner password by itself.\n\n\n1. At the client side, there would be error handling. At least, we can have a clear message that tells us we are missing important TPM secrets as pre-condition.\n2. If in-memory solution doesn\u0027t work, we can change the implementation of the snapshot to storing the file copy on DUT in stateful partition, Yet, if I am not mistaken in 3., there should be alright?\n3. When a local test crashed in the middle of execution, with clear_tpm\u003dFalse passed into tast.py again, the ownership gets cleared. In this case, we always take ownership in ready.go, no? that\u0027 what I imagined of the current status, pls correct me if i was wrong.",
      "parentUuid": "a6214aff_4d921c42",
      "range": {
        "startLine": 115,
        "startChar": 0,
        "endLine": 117,
        "endChar": 2
      },
      "revId": "3121b7915c4e341b5253a2e6460bc3d6d6399865",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6e032659_d0438b76",
        "filename": "src/chromiumos/tast/local/ready/ready.go",
        "patchSetId": 2
      },
      "lineNbr": 117,
      "author": {
        "id": 1118346
      },
      "writtenOn": "2020-06-03T02:12:36Z",
      "side": 1,
      "message": "I see, so we want to be prepared so that any test can clear the TPM owner password without affecting other tests.\n\nWhen a local test crashes, retries are attempted by the tast command, not by its Autotest wrapper. tpm_utils.ClearTPMOwnerRequest is not called before retries.\n\nSo I think we have to store the snapshot to disk, not on memory.",
      "parentUuid": "90300082_b6a79d7d",
      "range": {
        "startLine": 115,
        "startChar": 0,
        "endLine": 117,
        "endChar": 2
      },
      "revId": "3121b7915c4e341b5253a2e6460bc3d6d6399865",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}