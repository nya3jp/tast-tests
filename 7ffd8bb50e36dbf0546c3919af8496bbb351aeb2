{
  "comments": [
    {
      "key": {
        "uuid": "5c9c9f52_8364037d",
        "filename": "src/chromiumos/tast/local/bundles/cros/ui/cuj/zram_info_tracker.go",
        "patchSetId": 1
      },
      "lineNbr": 52,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-08-13T22:42:23Z",
      "side": 1,
      "message": "We need to reset \"mem_used_max\". However, \"echo 0 \u003e /sys/block/zram0/mem_used_max\" does not work for me on my kodama\u0027s 4.19 kennel. I could only reset mm_stat when resetting the device, which could only be done when swap is off. And swap service script \"stop\" does just that.",
      "revId": "7ffd8bb50e36dbf0546c3919af8496bbb351aeb2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2bc46150_735439cc",
        "filename": "src/chromiumos/tast/local/bundles/cros/ui/cuj/zram_info_tracker.go",
        "patchSetId": 1
      },
      "lineNbr": 52,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-08-14T18:19:38Z",
      "side": 1,
      "message": "Swap restart removed.",
      "parentUuid": "5c9c9f52_8364037d",
      "revId": "7ffd8bb50e36dbf0546c3919af8496bbb351aeb2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ee662ee_aa28510e",
        "filename": "src/chromiumos/tast/local/bundles/cros/ui/cuj/zram_info_tracker.go",
        "patchSetId": 1
      },
      "lineNbr": 53,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-08-14T17:19:30Z",
      "side": 1,
      "message": "I\u0027m a bit nervous here; so it shortly stops the swap service and then start it again, which could potentially remove the data in the swap memory; are there any side effects for that?",
      "revId": "7ffd8bb50e36dbf0546c3919af8496bbb351aeb2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9be38079_0ff148cc",
        "filename": "src/chromiumos/tast/local/bundles/cros/ui/cuj/zram_info_tracker.go",
        "patchSetId": 1
      },
      "lineNbr": 53,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-08-14T17:36:12Z",
      "side": 1,
      "message": "Swapoff could be a big deal and lead to kernel panic if we don\u0027t have enough memory to hold the data.\n\nIf it does not explode, it could take some time to move the data. But it should be okay in our case since we are moving within memory. I have seen zram hold 1G data and swapoff takes about 2s.\n\nThe intention is to reset the \"mem_used_max\" counter. So far this is the only way that I found working.",
      "parentUuid": "6ee662ee_aa28510e",
      "revId": "7ffd8bb50e36dbf0546c3919af8496bbb351aeb2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7ef8a0a6_902427d1",
        "filename": "src/chromiumos/tast/local/bundles/cros/ui/cuj/zram_info_tracker.go",
        "patchSetId": 1
      },
      "lineNbr": 53,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-08-14T17:47:50Z",
      "side": 1,
      "message": "I read some more code [1]. So reset mem_used_max is resetting it to the current mem_used_total, not resetting to 0.\n\nIn this case, it seems to me that we should use the diff rather than the absolute value. The zram being used before our tests run is kind of random. We could capture two values, mem_used_max after reset at the start of test and mem_used_max after the test.\n\nWe could then remove this scary code to swapoff -\u003e swapon. WDYT?\n\n[1] https://source.corp.google.com/chromeos_public/src/third_party/kernel/v4.19/drivers/block/zram/zram_drv.c;l\u003d277?q\u003dmem_used_max\u0026sq\u003dfile:%5Esrc%20package:%5Echromeos_(internal%7Cpublic)$",
      "parentUuid": "9be38079_0ff148cc",
      "revId": "7ffd8bb50e36dbf0546c3919af8496bbb351aeb2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9e1935ad_96d2a3ab",
        "filename": "src/chromiumos/tast/local/bundles/cros/ui/cuj/zram_info_tracker.go",
        "patchSetId": 1
      },
      "lineNbr": 53,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-08-14T18:27:01Z",
      "side": 1,
      "message": "That sounds good to me",
      "parentUuid": "7ef8a0a6_902427d1",
      "revId": "7ffd8bb50e36dbf0546c3919af8496bbb351aeb2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6a130bd2_f5c4106e",
        "filename": "src/chromiumos/tast/local/bundles/cros/ui/cuj/zram_info_tracker.go",
        "patchSetId": 1
      },
      "lineNbr": 105,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-08-14T17:19:30Z",
      "side": 1,
      "message": "I\u0027m now a bit more caring about the naming of metrics :-)\nto be consistent with the namings in the design document (saying \"max MB in z-swap during the test\"), this would be TPS.RAM.Zswap.Max?  Any thoughts?",
      "range": {
        "startLine": 105,
        "startChar": 14,
        "endLine": 105,
        "endChar": 26
      },
      "revId": "7ffd8bb50e36dbf0546c3919af8496bbb351aeb2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a092f97d_dfaee46f",
        "filename": "src/chromiumos/tast/local/bundles/cros/ui/cuj/zram_info_tracker.go",
        "patchSetId": 1
      },
      "lineNbr": 105,
      "author": {
        "id": 1000101
      },
      "writtenOn": "2020-08-14T17:36:12Z",
      "side": 1,
      "message": "Zswap is not good since it is a real thing that applies compression for swapping. It could be used on some devices that does not use zram. swap.sh [1] has some reference of it. I don\u0027t actually know what are the criteria to use it.\n\nBack here, maybe we should still use \"Zram\"? Something like \"TPS.RAM.Zram.Max\" ?\n\n[1] https://source.corp.google.com/chromeos_public/src/third_party/chromiumos-overlay/chromeos-base/swap-init/files/init/swap.sh;l\u003d361",
      "parentUuid": "6a130bd2_f5c4106e",
      "range": {
        "startLine": 105,
        "startChar": 14,
        "endLine": 105,
        "endChar": 26
      },
      "revId": "7ffd8bb50e36dbf0546c3919af8496bbb351aeb2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "115925c1_8508e76a",
        "filename": "src/chromiumos/tast/local/bundles/cros/ui/cuj/zram_info_tracker.go",
        "patchSetId": 1
      },
      "lineNbr": 105,
      "author": {
        "id": 1000479
      },
      "writtenOn": "2020-08-14T18:27:01Z",
      "side": 1,
      "message": "Okay then Zram should be good enough. I thought RAM prefix would be useful, but maybe not so necessary -- anyways data scientists need the mapping of names.",
      "parentUuid": "a092f97d_dfaee46f",
      "range": {
        "startLine": 105,
        "startChar": 14,
        "endLine": 105,
        "endChar": 26
      },
      "revId": "7ffd8bb50e36dbf0546c3919af8496bbb351aeb2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}