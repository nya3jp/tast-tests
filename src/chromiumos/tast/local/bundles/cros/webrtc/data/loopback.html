<!DOCTYPE html>
<html>
<head><title>RTCPeerConnection Loopback test</title></head>
<body>
  <video id="remoteVideo" autoplay muted></video>
<script>

let streamReady = false;
let error = '';

async function start() {
  var pc1 = new RTCPeerConnection();
  var pc2 = new RTCPeerConnection();

  pc1.onicecandidate = e => pc2.addIceCandidate(e.candidate).catch(reject);
  pc2.onicecandidate = e => pc1.addIceCandidate(e.candidate).catch(reject);
  pc2.ontrack = e => {
    document.getElementById('remoteVideo').srcObject = e.streams[0];
    streamReady = true;
    return;
  };

  const offerOptions = {
    offerToReceiveAudio: 1,
    offerToReceiveVideo: 1
  };

  await navigator.mediaDevices.getUserMedia(
      {
        audio: false,
        video: {
          width: {min: 1280},
          height: {min: 720},
        },
      }
  )
  .then(stream => stream.getTracks().forEach(track => pc1.addTrack(track, stream)))
  .then(() => pc1.createOffer(offerOptions))
  .then(offer => pc1.setLocalDescription(offer))
  .then(() => pc2.setRemoteDescription(pc1.localDescription))
  .then(() => pc2.createAnswer())
  .then(offer => pc2.setLocalDescription(offer))
  .then(() => pc1.setRemoteDescription(pc2.localDescription))
  .catch(e => { error = e; });
}

window.onload = start;

</script>
</body>
</html>
