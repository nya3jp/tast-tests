{
  "comments": [
    {
      "key": {
        "uuid": "a1c37f05_682ec12c",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-02-28T01:42:25Z",
      "side": 1,
      "message": "just make this be a io.Writer. it\u0027s better to pass the minimal interface that\u0027s required instead of a specialized implementation. this function doesn\u0027t need to know whether the data is going to be compressed or not, and you also don\u0027t want it to close the writer (so hiding its Close method is preferred).",
      "range": {
        "startLine": 486,
        "startChar": 90,
        "endLine": 486,
        "endChar": 102
      },
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72668e84_e13d6d98",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2019-02-28T01:54:16Z",
      "side": 1,
      "message": "I am missing something: I started out by passing an io.Writer, but the main function needs to close the gzip.Writer to flush it, correct?  So if I create the gzip.Writer here, then I\u0027ll have to also return it, and it\u0027s messier.",
      "parentUuid": "a1c37f05_682ec12c",
      "range": {
        "startLine": 486,
        "startChar": 90,
        "endLine": 486,
        "endChar": 102
      },
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bb1bc122_80a55a2c",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-02-28T02:10:49Z",
      "side": 1,
      "message": "keep creating a *gzip.Writer on L728. just change this line to io.Writer, which is an interface that *gzip.Writer implements. it\u0027ll be implicitly cast to the interface on L730.",
      "parentUuid": "72668e84_e13d6d98",
      "range": {
        "startLine": 486,
        "startChar": 90,
        "endLine": 486,
        "endChar": 102
      },
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "12139be6_13abcff6",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 486,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2019-02-28T03:04:47Z",
      "side": 1,
      "message": "OK, thanks, I understand now, makes sense.  (In fact the type is narrowed a few lines later anyway, in the assignments.)",
      "parentUuid": "bb1bc122_80a55a2c",
      "range": {
        "startLine": 486,
        "startChar": 90,
        "endLine": 486,
        "endChar": 102
      },
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "715f009b_1eb39454",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 530,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-02-28T01:42:25Z",
      "side": 1,
      "message": "nit: \"a private Google Cloud Storage bucket\"",
      "range": {
        "startLine": 530,
        "startChar": 33,
        "endLine": 530,
        "endChar": 61
      },
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c83009e3_44f98b76",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 530,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2019-02-28T03:04:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "715f009b_1eb39454",
      "range": {
        "startLine": 530,
        "startChar": 33,
        "endLine": 530,
        "endChar": 61
      },
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "02f722f0_945ea542",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 535,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-02-28T01:42:25Z",
      "side": 1,
      "message": "nit: instead of referencing the URL here here where it\u0027s bound to get stale (like it just did), i\u0027d recommend just mentioning wprArchivePath, which has the actual value.",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "752064fd_ff1299a0",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 535,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2019-02-28T03:04:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "02f722f0_945ea542",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "feb81fa0_646df6ea",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 736,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-02-28T01:42:25Z",
      "side": 1,
      "message": "you should do this after waiting for the process to exit, as it may still be writing to the log at this point. i don\u0027t think you need s.Fatal on L744 since it\u0027s already the last thing in a deferred function in your test function (i.e. the test is done at this point, so i\u0027d just do this:\n\ndefer func() {\n    cr.Close(ctx)\n    if err :\u003d wpr.Kill(); err !\u003d nil {\n        s.Error(...)\n    }\n    wpr.Wait() // ignore error since we killed the process\n    if err :\u003d wprGzippedLog.Close(); err !\u003d nil {\n        s.Error(...)\n    }\n}",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cc0acb88_c9632c07",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 736,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2019-02-28T01:54:16Z",
      "side": 1,
      "message": "My concern was that killing wpr might close its Stdout and Stderr, which the gzip.Writer might need in order to flush the buffer.  Is that not the case?",
      "parentUuid": "feb81fa0_646df6ea",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "15a4ecad_b1d2630b",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 736,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-02-28T02:10:49Z",
      "side": 1,
      "message": "no, i don\u0027t think so (if i\u0027m understanding correctly).\n\nthe testexec.Cmd will copy the process\u0027s stdout and stderr to wprGzippedLog.Write. if you kill the process, fine, Write doesn\u0027t get called anymore. you then need to call wprGzippedLog.Close so that the writer will flush any unwritten data that it received via earlier Write calls but hasn\u0027t compressed and passed to wprLog.Write yet. then wprLog.Close needs to be called (which will happen via the defer on L727) to flush any data that wprLog hasn\u0027t written yet and close the FD.\n\nmake sense?",
      "parentUuid": "cc0acb88_c9632c07",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8d792f7b_7907b5fc",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 736,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2019-02-28T03:04:47Z",
      "side": 1,
      "message": "Yes, that\u0027s great, thanks.  I also moved the closing of the .gzip file to here so I don\u0027t have to worry about the order.  (Although it\u0027s probably reverse of deferred action creation, so it would work).",
      "parentUuid": "15a4ecad_b1d2630b",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ee2bd86e_01e1df1b",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 739,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-02-28T01:42:25Z",
      "side": 1,
      "message": "why would wpr be nil here?",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ba2b5e06_3179963f",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 739,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2019-02-28T01:54:16Z",
      "side": 1,
      "message": "wpr may be nil even when err \u003d\u003d nil, if useLiveSites is true, which it is when I record the archive.",
      "parentUuid": "ee2bd86e_01e1df1b",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "99e01bca_7c53a901",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 739,
      "author": {
        "id": 1000042
      },
      "writtenOn": "2019-02-28T02:10:49Z",
      "side": 1,
      "message": "please document that on L485 since it\u0027s non-obvious, e.g.\n\n// The returned command will be nil if useLiveSites is true or\n// an already-started wprgo process (which must be killed and waited on)\n// otherwise.",
      "parentUuid": "ba2b5e06_3179963f",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a3742b3e_0bb5fb44",
        "filename": "src/chromiumos/tast/local/bundles/cros/platform/memory_pressure.go",
        "patchSetId": 1
      },
      "lineNbr": 739,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2019-02-28T03:04:47Z",
      "side": 1,
      "message": "OK.  I am omitting the last sentence because I don\u0027t think it\u0027s true---if a left-over wpr process is running, we may end up with two of them, or some other error (like the http ports are already taken).",
      "parentUuid": "99e01bca_7c53a901",
      "revId": "4dc423a8348f3ea08a0d8950e09fd33b9f33d172",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}