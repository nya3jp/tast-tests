{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "654afc68_cd76ec17",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1282737
      },
      "writtenOn": "2021-05-14T16:43:55Z",
      "side": 1,
      "message": "Looking good! Thanks.",
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f02c8852_a97c4927",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1459753
      },
      "writtenOn": "2021-05-15T03:29:43Z",
      "side": 1,
      "message": "Thanks for the comments!",
      "parentUuid": "654afc68_cd76ec17",
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7e78b128_e9485988",
        "filename": "src/chromiumos/tast/local/bundles/cros/video/contents.go",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1282737
      },
      "writtenOn": "2021-05-14T16:43:55Z",
      "side": 1,
      "message": "You also need a _lacros variant of this so that we can test exotic crop rectangles with overlays.",
      "range": {
        "startLine": 50,
        "startChar": 10,
        "endLine": 50,
        "endChar": 34
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0cd95317_68da8f64",
        "filename": "src/chromiumos/tast/local/bundles/cros/video/contents.go",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1459753
      },
      "writtenOn": "2021-05-15T03:29:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7e78b128_e9485988",
      "range": {
        "startLine": 50,
        "startChar": 10,
        "endLine": 50,
        "endChar": 34
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "72a15d65_dea3e4bf",
        "filename": "src/chromiumos/tast/local/bundles/cros/video/contents.go",
        "patchSetId": 1
      },
      "lineNbr": 176,
      "author": {
        "id": 1282737
      },
      "writtenOn": "2021-05-14T16:43:55Z",
      "side": 1,
      "message": "nit: Remove blank line.",
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "115f6b99_65bc7c3c",
        "filename": "src/chromiumos/tast/local/bundles/cros/video/contents.go",
        "patchSetId": 1
      },
      "lineNbr": 176,
      "author": {
        "id": 1459753
      },
      "writtenOn": "2021-05-15T03:29:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "72a15d65_dea3e4bf",
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff1831ac_d690c830",
        "filename": "src/chromiumos/tast/local/bundles/cros/video/play/play.go",
        "patchSetId": 1
      },
      "lineNbr": 414,
      "author": {
        "id": 1282737
      },
      "writtenOn": "2021-05-14T16:43:55Z",
      "side": 1,
      "message": "Do you have a way to test this works when using LaCrOS? I\u0027m not sure if tconn has the same capabilities in that case.",
      "range": {
        "startLine": 411,
        "startChar": 1,
        "endLine": 414,
        "endChar": 2
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "66bf5a05_0898b975",
        "filename": "src/chromiumos/tast/local/bundles/cros/video/play/play.go",
        "patchSetId": 1
      },
      "lineNbr": 414,
      "author": {
        "id": 1459753
      },
      "writtenOn": "2021-05-15T03:29:43Z",
      "side": 1,
      "message": "Thanks! I just tested it with a volteer in portrait orientation. It failed with \"TestPlayAndScreenshot failed: failed to set display to landscape-primary orientation: the display is not in the expected landscape-primary orientation\". Do we need to test anything else?",
      "parentUuid": "ff1831ac_d690c830",
      "range": {
        "startLine": 411,
        "startChar": 1,
        "endLine": 414,
        "endChar": 2
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ff76411a_4869b5aa",
        "filename": "src/chromiumos/tast/local/bundles/cros/video/play/play.go",
        "patchSetId": 1
      },
      "lineNbr": 414,
      "author": {
        "id": 1459753
      },
      "writtenOn": "2021-05-18T23:43:06Z",
      "side": 1,
      "message": "It fails in ash too, with the same error. Taking a look into the function RotateDisplayToLandscapePrimary() I saw that it fails here [1] when, after rotating the display with SetDisplayRotationSync() [2], it checks that the resulting orientation is \"landscape-primary\". The call to SetDisplayRotationSync() does not fail, but it leaves the display orientation unchanged, that is \"portrait-primary\". I tested changing the degrees the display is rotated when calling SetDisplayRotationSync(). It currently tries to rotate the display 270 degrees. I tried 180 and that set the orientation to \"landscape-secondary\". So with 0 degrees rotation the orientation was set to \"landscape-primary\" and the test finally passed. This is very counterintuitive... I wonder if this is maybe because it is rotating the display using \"landscape-primary\" as the original rotation always...\n\n[1] https://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/platform/tast-tests/src/chromiumos/tast/local/graphics/screen.go;l\u003d42\n[2] https://source.chromium.org/chromiumos/chromiumos/codesearch/+/main:src/platform/tast-tests/src/chromiumos/tast/local/graphics/screen.go;l\u003d33",
      "parentUuid": "66bf5a05_0898b975",
      "range": {
        "startLine": 411,
        "startChar": 1,
        "endLine": 414,
        "endChar": 2
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5cd4dbca_6f89a95e",
        "filename": "src/chromiumos/tast/local/bundles/cros/video/play/play.go",
        "patchSetId": 1
      },
      "lineNbr": 414,
      "author": {
        "id": 1282737
      },
      "writtenOn": "2021-05-19T00:32:44Z",
      "side": 1,
      "message": "Thanks for checking!\n\nI remember getting confused about all these orientations when writing that rotation code. I forgot what all of them mean. I think I was just trying to make it work with devices in the lab, so I\u0027d say the code is brittle and should be revisited at some point.\n\nFor now, we don\u0027t need to take any action for that here. Let\u0027s see how the test behaves in the lab.",
      "parentUuid": "ff76411a_4869b5aa",
      "range": {
        "startLine": 411,
        "startChar": 1,
        "endLine": 414,
        "endChar": 2
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f62cde06_cc3dd0b4",
        "filename": "src/chromiumos/tast/local/media/pre/fixture.go",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1282737
      },
      "writtenOn": "2021-05-14T16:43:55Z",
      "side": 1,
      "message": "I\u0027m not sure if we want this. Can we ask Robert what this flag does in the case of lacros? Will lacros flatten everything before sending the content to Wayland? Or does it just ignore this flag?",
      "range": {
        "startLine": 134,
        "startChar": 3,
        "endLine": 134,
        "endChar": 61
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "28ecf438_369ef580",
        "filename": "src/chromiumos/tast/local/media/pre/fixture.go",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1459753
      },
      "writtenOn": "2021-05-15T03:29:43Z",
      "side": 1,
      "message": "I talked to Rob and Kramer about this. Lacros does use this flag. By default it is:\n--enable-hardware-overlays\u003dsingle-fullscreen,single-on-top,underlay\nKramer and I tested it and --enable-hardware-overlays\u003d\"\" disables overlays and everything is composited.",
      "parentUuid": "f62cde06_cc3dd0b4",
      "range": {
        "startLine": 134,
        "startChar": 3,
        "endLine": 134,
        "endChar": 61
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "114a4041_d363dd0f",
        "filename": "src/chromiumos/tast/local/media/pre/fixture.go",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1273510
      },
      "writtenOn": "2021-05-17T18:22:02Z",
      "side": 1,
      "message": "Thanks for checking! Based on that, I\u0027m concerned about the different combinations:\n\n1) Overlays are enabled in both lacros and ash.\n\n2) Overlays are enabled in lacros but not ash.\n\n3) Overlays are enabled in ash but not lacros.\n\n4) Overlays are disabled in both.\n\nWith the chromeCompositedVideoLacros fixture, you\u0027re only taking care of case (4). So some follow-up points of discussion:\n\n- What happens in case (3)? Does lacros flatten everything (including the video) into a framebuffer before sending it through Wayland? If so, this probably ends up being the same as case (4).\n\n- In real usage, which component is in charge of demoting videos to non-overlay? If it\u0027s only ash, then we don\u0027t really care too much about testing cases (3) and (4). If both ash and lacros can demote videos, then we might need to test cases (2) and (3) because they follow different paths for the framebuffer_size change you have in progress.",
      "parentUuid": "28ecf438_369ef580",
      "range": {
        "startLine": 134,
        "startChar": 3,
        "endLine": 134,
        "endChar": 61
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7eead322_7a3f2320",
        "filename": "src/chromiumos/tast/local/media/pre/fixture.go",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1459753
      },
      "writtenOn": "2021-05-18T23:43:06Z",
      "side": 1,
      "message": "I checked with Kramer and:\n- If overlays are disabled in lacros but enabled in ash, lacros still flattens everything (including video) into a frambuffer and sends it through Wayland.\n- Both, lacros and ash, can demote videos to non-overlay.",
      "parentUuid": "114a4041_d363dd0f",
      "range": {
        "startLine": 134,
        "startChar": 3,
        "endLine": 134,
        "endChar": 61
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84df77cc_8c30d126",
        "filename": "src/chromiumos/tast/local/media/pre/fixture.go",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1282737
      },
      "writtenOn": "2021-05-19T00:32:44Z",
      "side": 1,
      "message": "Thanks for checking!\n\nBased on that, I\u0027d say that we should have two variations of the lacros fixture: one where only lacros disables overlays and one where only ash disables overlays. The reason is that the two paths handle video visible rectangles differently. On one path, the visible rectangle gets propagated only up to the lacros compositor and then it\u0027s used to draw the video onto the framebuffer. On the other, I\u0027d expect it gets propagated to the ash compositor through Wayland.\n\nSo maybe having something like chromeLacrosCompositedVideoLacros and chromeAshCompositedVideoLacros and having one test for each?",
      "parentUuid": "7eead322_7a3f2320",
      "range": {
        "startLine": 134,
        "startChar": 3,
        "endLine": 134,
        "endChar": 61
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cc64f70c_51bd7ab0",
        "filename": "src/chromiumos/tast/local/media/pre/fixture.go",
        "patchSetId": 1
      },
      "lineNbr": 134,
      "author": {
        "id": 1459753
      },
      "writtenOn": "2021-05-19T22:33:25Z",
      "side": 1,
      "message": "Thanks! Done.",
      "parentUuid": "84df77cc_8c30d126",
      "range": {
        "startLine": 134,
        "startChar": 3,
        "endLine": 134,
        "endChar": 61
      },
      "revId": "b34ac52cbc008480ef61751bc5dc41ba4d0f6ca7",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}