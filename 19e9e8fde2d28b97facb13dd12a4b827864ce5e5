{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "707c99ea_a9811fc0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1520127
      },
      "writtenOn": "2022-03-28T18:43:55Z",
      "side": 1,
      "message": "Thanks for this cleanup, Hyung. I rebased my work and indeed it became much easier and clean now to use the SetUpWithNewChrome semantics.\n\nOne issue I\u0027ve noticed though is that I can\u0027t use Rootfs and LacrosPrimary configuration now without explicitly passing \"var\u003dlacrosDeployedBinary\u003d/usr/local/lacros-chrome\". It hangs in lacros.LaunchFromShelf -\u003e ash.LaunchAppFromShelf. Can you check if you\u0027re seeing this problem as well?",
      "revId": "19e9e8fde2d28b97facb13dd12a4b827864ce5e5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9efbc81c_cc5b09f6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-28T21:59:18Z",
      "side": 1,
      "message": "Tiago, it\u0027s not reproducible on my end and hard to tell what to look at without any failure log. Can you grab one?\n\nI just synced to HEAD, cherrypicked your CL (https://crrev.com/c/3508772) then ran `tast run lacros.LoginPerf*` with or without -var\u003dlacrosDeployedBinary, but it all passed.\nOne thing that I suspect is did you see --lacros-chrome-path added in /etc/chrome_dev.conf (probably by deploy_chrome)? If that\u0027s the case either -var should be passed in together or simply --lacros-chrome-path could be removed. Otherwise both would conflict and let the test fail to pass this check: http://cs/chromeos_public/src/platform/tast-tests/src/chromiumos/tast/local/chrome/lacros/lacrosfixt/util.go?l\u003d145\nI think we can follow up on this in your CL review.",
      "parentUuid": "707c99ea_a9811fc0",
      "revId": "19e9e8fde2d28b97facb13dd12a4b827864ce5e5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1759e4f5_b3830949",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1520127
      },
      "writtenOn": "2022-03-29T14:44:24Z",
      "side": 1,
      "message": "I was actually referring to the new example.BrowserWithNewChrome test. Sorry to not be specific before.\n\nI\u0027ve just synced now the repos and I\u0027m using an up to date chroot. Then I\u0027ve double checked that `--lacros-chrome-path` is not present in `/etc/chrome_dev.conf` file. I\u0027m still catching the following when running using `tast run device example.BrowserWithNewChrome`:\n\n```\n2022-03-29T14:37:00.600193Z [14:37:00.458] Error at browser_with_new_chrome.go:54: BrowserWithNewChrome browser: lacros, cfg: \u0026{SetupMode:Rootfs LacrosMode:LacrosPrimary deployed:false deployedPath:}: Failed to connect to lacros browser: failed to launch lacros-chrome: failed to launch lacros via shelf: failed to wait for the app to be launched: context deadline exceeded; last error follows: app is not shown yet\n2022-03-29T14:37:00.600246Z [14:37:00.458] Stack trace:\nBrowserWithNewChrome browser: lacros, cfg: \u0026{SetupMode:Rootfs LacrosMode:LacrosPrimary deployed:false deployedPath:}: Failed to connect to lacros browser\n\tat chromiumos/tast/local/bundles/cros/example.BrowserWithNewChrome.func1 (browser_with_new_chrome.go:54)\n\tat chromiumos/tast/internal/testing.(*State).Run.func1 (state.go:640)\n\tat runtime.goexit (asm_amd64.s:1581)\nfailed to launch lacros-chrome\n\tat chromiumos/tast/local/chrome/browser/browserfixt.SetUpWithNewChrome (browserfixt.go:139)\n\tat chromiumos/tast/local/bundles/cros/example.BrowserWithNewChrome.func1 (browser_with_new_chrome.go:52)\n\tat chromiumos/tast/internal/testing.(*State).Run.func1 (state.go:640)\n\tat runtime.goexit (asm_amd64.s:1581)\nfailed to launch lacros via shelf\n\tat chromiumos/tast/local/chrome/lacros.LaunchFromShelf (launch.go:88)\n\tat chromiumos/tast/local/chrome/browser/browserfixt.SetUpWithNewChrome (browserfixt.go:136)\n\tat chromiumos/tast/local/bundles/cros/example.BrowserWithNewChrome.func1 (browser_with_new_chrome.go:52)\n\tat chromiumos/tast/internal/testing.(*State).Run.func1 (state.go:640)\n\tat runtime.goexit (asm_amd64.s:1581)\nfailed to wait for the app to be launched\n\tat chromiumos/tast/local/chrome/ash.LaunchAppFromShelf (shelf.go:782)\n\tat chromiumos/tast/local/chrome/lacros.LaunchFromShelf (launch.go:87)\n\tat chromiumos/tast/local/chrome/browser/browserfixt.SetUpWithNewChrome (browserfixt.go:136)\n\tat chromiumos/tast/local/bundles/cros/example.BrowserWithNewChrome.func1 (browser_with_new_chrome.go:52)\n\tat chromiumos/tast/internal/testing.(*State).Run.func1 (state.go:640)\n\tat runtime.goexit (asm_amd64.s:1581)\ncontext deadline exceeded; last error follows\n\tat chromiumos/tast/internal/testingutil.Poll (poll.go:87)\n\tat chromiumos/tast/testing.Poll (util.go:43)\n\tat chromiumos/tast/local/chrome/ash.WaitForAppCondition (shelf.go:546)\n\tat chromiumos/tast/local/chrome/ash.WaitForApp (shelf.go:531)\n\tat chromiumos/tast/local/chrome/ash.LaunchAppFromShelf (shelf.go:781)\n\tat chromiumos/tast/local/chrome/lacros.LaunchFromShelf (launch.go:87)\n\tat chromiumos/tast/local/chrome/browser/browserfixt.SetUpWithNewChrome (browserfixt.go:136)\n\tat chromiumos/tast/local/bundles/cros/example.BrowserWithNewChrome.func1 (browser_with_new_chrome.go:52)\n\t...\napp is not shown yet\n\tat chromiumos/tast/local/chrome/ash.WaitForAppCondition.func1 (shelf.go:550)\n\tat chromiumos/tast/internal/testingutil.Poll (poll.go:64)\n\tat chromiumos/tast/testing.Poll (util.go:43)\n\tat chromiumos/tast/local/chrome/ash.WaitForAppCondition (shelf.go:546)\n\tat chromiumos/tast/local/chrome/ash.WaitForApp (shelf.go:531)\n\tat chromiumos/tast/local/chrome/ash.LaunchAppFromShelf (shelf.go:781)\n\tat chromiumos/tast/local/chrome/lacros.LaunchFromShelf (launch.go:87)\n\tat chromiumos/tast/local/chrome/browser/browserfixt.SetUpWithNewChrome (browserfixt.go:136)\n\t...\n```",
      "parentUuid": "9efbc81c_cc5b09f6",
      "revId": "19e9e8fde2d28b97facb13dd12a4b827864ce5e5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1ff94bbd_ac1fc4b8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-29T23:57:24Z",
      "side": 1,
      "message": "AFAICT this is still not reproducible locally on my end and in continuous testing now that it is enabled to be run on every build on ToT.\nI was wondering if this could be related to this open issue (https://crbug.com/1277898). Alternatively, Eliot is planning to update the way of launching lacros with https://crrev.com/c/3524047. It would be worth trying this CL to see if it could help mitigate your issue.",
      "parentUuid": "1759e4f5_b3830949",
      "revId": "19e9e8fde2d28b97facb13dd12a4b827864ce5e5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a1ec85f7_3931a06f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1520127
      },
      "writtenOn": "2022-04-07T19:53:17Z",
      "side": 1,
      "message": "Just for completeness: I could get a working environment that doesn\u0027t return the hang I was referring after all. All I needed to do is to re-flash my DUT :-) Super simple.\n\nThanks for the help here, Hyung (and sorry to steal this CL to address that!).",
      "parentUuid": "1ff94bbd_ac1fc4b8",
      "revId": "19e9e8fde2d28b97facb13dd12a4b827864ce5e5",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}