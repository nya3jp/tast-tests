{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "1a4a0eb7_bcd0ea5d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1310429
      },
      "writtenOn": "2021-05-26T00:12:18Z",
      "side": 1,
      "message": "Hi Hiroki,\n\nDo you mind reviewing this change for me? I\u0027m hoping that this will stabilize the SpeechMonitor so that it can be used for other tests too.\n\nThanks!",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "472fbc37_c2d186ed",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1355245
      },
      "writtenOn": "2021-05-26T03:17:16Z",
      "side": 1,
      "message": "Thank you for improving this!\n\nI wonder if we can split this CL into two:\n- finding the correct tts extension\n- other obvious changes\n\nI think we need to be careful for the first one. For the second one, already lgtm.",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fd9692ad_c7f8d6ed",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1310429
      },
      "writtenOn": "2021-05-26T23:20:05Z",
      "side": 1,
      "message": "Thanks! If it\u0027s possible, I would prefer to keep this in one change. The other obvious changes are needed to keep the code clean.",
      "parentUuid": "472fbc37_c2d186ed",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fb1513e4_4edaabe8",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 226,
      "author": {
        "id": 1355245
      },
      "writtenOn": "2021-05-26T03:17:16Z",
      "side": 1,
      "message": "As I mentioned in another thread, I think an utterance \"tab created\" is one cause of the flakiness.\nI don\u0027t think doing this here doesn\u0027t solve the issue.\n\nAlso, if the second connection is the correct one, the tts would have two \"Testing\" utterance and I\u0027m afraid this would make another source of flakiness.",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2bd15841_5b1924cb",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 226,
      "author": {
        "id": 1310429
      },
      "writtenOn": "2021-05-26T23:20:05Z",
      "side": 1,
      "message": "This new strategy fixes a different error, like below:\n\nExpected utterances: [ \"ChromeVox Options\" ], but got: []\n\nIn the error above, we never received any utterances because we weren\u0027t connecting to the correct background page.\n\nI\u0027d also like to comment on the situation below:\n\nExpected utterances: [ \"ChromeVox Options\" ], but got [ \"Tab created\"]\n\nWith the way that SpeechMonitor is currently implemented, extra utterances shouldn\u0027t cause failures because they are thrown out if they do not match the expected utterance (see the consume function).\n\nThe more likely explanation is that ChromeVox isn\u0027t reading \"ChromeVox Options\" at all, which is why we get a failure.",
      "parentUuid": "fb1513e4_4edaabe8",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d327b97a_4816387b",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 226,
      "author": {
        "id": 1355245
      },
      "writtenOn": "2021-05-27T01:41:56Z",
      "side": 1,
      "message": "Thanks for the explanation. That\u0027s right, I understand this resolves the case where we aren\u0027t connecting to the correct extension.",
      "parentUuid": "2bd15841_5b1924cb",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7b8aba31_c5990e43",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 299,
      "author": {
        "id": 1355245
      },
      "writtenOn": "2021-05-26T03:17:16Z",
      "side": 1,
      "message": "How about making it a member of SpeechMonitor?",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b69afbbe_c9e41835",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 299,
      "author": {
        "id": 1310429
      },
      "writtenOn": "2021-05-26T23:20:05Z",
      "side": 1,
      "message": "We need this inside NewSpeechMonitor(), so that\u0027s why I kept this separate of SpeechMonitor.",
      "parentUuid": "7b8aba31_c5990e43",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e48181d4_1d6688a8",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 299,
      "author": {
        "id": 1355245
      },
      "writtenOn": "2021-05-27T01:41:56Z",
      "side": 1,
      "message": "Can we create SpeechMonitor before calling waitForUtterance() in NewSpeechMonitor() and return the instance when waitForUtterance successes?",
      "parentUuid": "b69afbbe_c9e41835",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "735314ec_9d0481ab",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 299,
      "author": {
        "id": 1310429
      },
      "writtenOn": "2021-06-01T22:31:24Z",
      "side": 1,
      "message": "Yes, I can do that. The new approach is:\n\n1. Create a SpeechMonitor\n2. Check for test utterance using consume\n3. If it\u0027s the incorrect SpeechMonitor, close it\n4. If it\u0027s the correct one, return it\n\nThe benefit of doing this is that we can remove waitForUtterance() completely and just use consume()",
      "parentUuid": "e48181d4_1d6688a8",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "76d42afd_47eed4b4",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 321,
      "author": {
        "id": 1355245
      },
      "writtenOn": "2021-05-26T03:17:16Z",
      "side": 1,
      "message": "Is it possible to listen both of onSpeak and onSpeakWithAudioStream? It\u0027s much simple.",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0723fe43_6f7591f2",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 321,
      "author": {
        "id": 1310429
      },
      "writtenOn": "2021-05-26T23:20:05Z",
      "side": 1,
      "message": "If we listen to both, we run the risk of getting duplicate utterances. In my experience, it\u0027s best to listen to onSpeak for Google TTS and to onSpeakWithAudioStream for eSpeak. I think there a small differences between their code that might explain this difference.",
      "parentUuid": "76d42afd_47eed4b4",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ec3a22ae_4ccd4ad4",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 321,
      "author": {
        "id": 1355245
      },
      "writtenOn": "2021-05-27T01:41:56Z",
      "side": 1,
      "message": "I\u0027m reading the implementation:\nhttps://source.chromium.org/chromium/chromium/src/+/main:chrome/browser/speech/extension_api/tts_engine_extension_api_chromeos.cc;l\u003d46;drc\u003d9fb42d79b70e2be3e1a9d687d122ba6e951c26d9\n\nIt looks like when there is an onSpeakWithAudioStream listener, only it is called. Otherwise, only onSpeak is called.\n\nAlso from the API proposal in https://docs.google.com/document/d/1Yg9g2f74ycei5GH7J1_SX0P0edfFDKgn2-TwugfyKno/edit#, apparently we eventually want to migrate GoogleTTS to use onSpeakWithAudioStream.\n\nHow about generalizing this by defining the struct TtsEngine like below?:\n\n  type TtsEngine struct {\n    ExtensionID string\n    UseSpeakWithAudioStream bool\n  }",
      "parentUuid": "0723fe43_6f7591f2",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "540cd118_9b448fab",
        "filename": "src/chromiumos/tast/local/a11y/a11y.go",
        "patchSetId": 5
      },
      "lineNbr": 321,
      "author": {
        "id": 1310429
      },
      "writtenOn": "2021-06-01T22:31:24Z",
      "side": 1,
      "message": "Thanks for the additional context, that helps explain the behavior I\u0027m seeing. I followed your suggestion, so please let me know if it looks okay.",
      "parentUuid": "ec3a22ae_4ccd4ad4",
      "revId": "57d38b6ec952e764b414ce7444bc6b2506f5389d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}