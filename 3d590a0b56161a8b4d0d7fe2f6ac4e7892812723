{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "2816c912_7def66dd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 13
      },
      "lineNbr": 0,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-07-02T02:56:09Z",
      "side": 1,
      "message": "Still LGTM % some nits",
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8cbb47cf_b2045740",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 13
      },
      "lineNbr": 0,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2022-07-02T03:04:20Z",
      "side": 1,
      "message": "Generally looks good but I would like to avoid hardcoding IPv4 only behavior. We should really make sure this test will be easy to extend to the IPv6 only case and dual stack case. ",
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f3e9d9ee_6590dfa4",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 13
      },
      "lineNbr": 23,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2022-07-02T03:04:20Z",
      "side": 1,
      "message": "We should maybe add here that this also requires forcing the DNS queries made by portal detection to be pointed to that server. Otherwise the http server only listening on its namespace address alone would not be enough to achieve redirection of the http traffic.",
      "range": {
        "startLine": 23,
        "startChar": 13,
        "endLine": 23,
        "endChar": 179
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "74934927_2e320867",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 13
      },
      "lineNbr": 23,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f3e9d9ee_6590dfa4",
      "range": {
        "startLine": 23,
        "startChar": 13,
        "endLine": 23,
        "endChar": 179
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "77c836ba_ef73def9",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 13
      },
      "lineNbr": 41,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-07-02T02:56:09Z",
      "side": 1,
      "message": "I think we don\u0027t really need to create cleanupCtx for each cleanup. Just using one with reserving enough time for all of them should be fine. (and moving the creation of cleanupCtx to the beginning of the test should be cleaner)",
      "range": {
        "startLine": 41,
        "startChar": 1,
        "endLine": 41,
        "endChar": 27
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "727e09ad_437a52ec",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 13
      },
      "lineNbr": 41,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-07-05T16:58:56Z",
      "side": 1,
      "message": "Agreed, a single shortened cleanup context (maybe give 5 seconds instead of 1) should be sufficient and can be passed to each of the cleanup functions.",
      "parentUuid": "77c836ba_ef73def9",
      "range": {
        "startLine": 41,
        "startChar": 1,
        "endLine": 41,
        "endChar": 27
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0029b3ed_3103fe86",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 13
      },
      "lineNbr": 41,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "727e09ad_437a52ec",
      "range": {
        "startLine": 41,
        "startChar": 1,
        "endLine": 41,
        "endChar": 27
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5226984d_2d6c614e",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 13
      },
      "lineNbr": 99,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-07-02T02:56:09Z",
      "side": 1,
      "message": "Now that we are using shillReset fixture now, I guess this cleanup is not necessary. WDYT?",
      "range": {
        "startLine": 94,
        "startChar": 0,
        "endLine": 99,
        "endChar": 7
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cbbfdf53_8affe41e",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 13
      },
      "lineNbr": 99,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-07-05T16:58:56Z",
      "side": 1,
      "message": "Hmm, it looks like the shillReset fixture does remove the default profile (I didn\u0027t realize that, I guess that explains why we always need to enable this in the first place). So you\u0027re right, this isn\u0027t strictly necessary, but it\u0027s never a bad idea to include cleanup in a test. A comment noting that we are relying on shillReset to restore this would however also suffice.\n\nI also suspect this will be generally helpful and could be part of shill.Manager.",
      "parentUuid": "5226984d_2d6c614e",
      "range": {
        "startLine": 94,
        "startChar": 0,
        "endLine": 99,
        "endChar": 7
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "36adf267_c1b6975a",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go",
        "patchSetId": 13
      },
      "lineNbr": 99,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "Done. Added this to the shill.Manager and just did not assign the cleanup function since we assume that shillreset test fixture will do it for us",
      "parentUuid": "cbbfdf53_8affe41e",
      "range": {
        "startLine": 94,
        "startChar": 0,
        "endLine": 99,
        "endChar": 7
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ced3aca_36a32746",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/dnsmasq/dnsmasq.go",
        "patchSetId": 13
      },
      "lineNbr": 51,
      "author": {
        "id": 1000191
      },
      "writtenOn": "2022-07-05T16:58:56Z",
      "side": 1,
      "message": "nit: s/the host you are running dnsmasq on/the host that is running dnsmasq/",
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b8d46207_a557f0c4",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/dnsmasq/dnsmasq.go",
        "patchSetId": 13
      },
      "lineNbr": 51,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1ced3aca_36a32746",
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e1254ab1_42573ead",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 22,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2022-07-02T03:04:20Z",
      "side": 1,
      "message": "Shouldn\u0027t we obtain a temporary directory from the testing context at runtime ?",
      "range": {
        "startLine": 22,
        "startChar": 1,
        "endLine": 22,
        "endChar": 36
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "98c5ed3c_11042c06",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 22,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "Honestly, I wasn\u0027t entirely sure about this one. I figured I would keep it consistent by doing exactly what the dnsmasq.go package did, but for httpserver. It does write the logs in the temporary chroot, which the chroot file system gets removed at the end of the test. If you think we should do what you suggested instead, LMK.",
      "parentUuid": "e1254ab1_42573ead",
      "range": {
        "startLine": 22,
        "startChar": 1,
        "endLine": 22,
        "endChar": 36
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "19ad82a5_07739d03",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 22,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-07-07T01:50:25Z",
      "side": 1,
      "message": "Yes, this is the path in chroot (mentioned in the above comment). Sorry I should answer to this comment earlier.",
      "parentUuid": "98c5ed3c_11042c06",
      "range": {
        "startLine": 22,
        "startChar": 1,
        "endLine": 22,
        "endChar": 36
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f30644ad_c5148137",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 23,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2022-07-02T03:04:20Z",
      "side": 1,
      "message": "I would suggest making this a configuration parameter so that you don\u0027t have to write asserts in test case that have to hardcode this url for the redirect property exposed by shill.",
      "range": {
        "startLine": 23,
        "startChar": 1,
        "endLine": 23,
        "endChar": 35
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dab9bf79_ca70e77f",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 23,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "In the second CL in this chain, I pulled out the entire handler function from the httpserver and made it so you can more precisely configure how the httpserver will handle requests within each test. Seen here: https://chromium-review.googlesource.com/c/chromiumos/platform/tast-tests/+/3739230/1/src/chromiumos/tast/local/bundles/cros/network/shill_captive_portal_http.go \n\nLMK if that achieves what you were looking for here.",
      "parentUuid": "f30644ad_c5148137",
      "range": {
        "startLine": 23,
        "startChar": 1,
        "endLine": 23,
        "endChar": 35
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "178041cf_f7c406de",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 27,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-07-02T02:56:09Z",
      "side": 1,
      "message": "(Here and other places) Comments should be sentences and thus a period is needed at the end.\nhttps://github.com/golang/go/wiki/CodeReviewComments#comment-sentences",
      "range": {
        "startLine": 27,
        "startChar": 64,
        "endLine": 27,
        "endChar": 66
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "91cb64bd_2464fbf1",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 27,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2022-07-02T03:04:20Z",
      "side": 1,
      "message": "Actually this variable is an IP address, not a hostname. A TCP listener will typically not know about its own hostname. This field name should ideally be changed to net.IP.\n\nMore generally do we really need to control this value ? afaiu the namespace will always have only 1 relevant virtual interface wrt what the ChromeOS host can see, so it seems correct to always listen on 0.0.0.0 or ::",
      "range": {
        "startLine": 27,
        "startChar": 4,
        "endLine": 27,
        "endChar": 8
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e65b31a2_431b4b1b",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 27,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "\u003e More generally do we really need to control this value ?\n\nGood point. For this instance, no. I removed the |host| value and have the http server listen on port 80.",
      "parentUuid": "91cb64bd_2464fbf1",
      "range": {
        "startLine": 27,
        "startChar": 4,
        "endLine": 27,
        "endChar": 8
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8ad46028_46e1cadb",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 27,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "178041cf_f7c406de",
      "range": {
        "startLine": 27,
        "startChar": 64,
        "endLine": 27,
        "endChar": 66
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7903a337_da26a734",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 27,
      "author": {
        "id": 1364246
      },
      "writtenOn": "2022-07-07T01:50:25Z",
      "side": 1,
      "message": "nit: \"port\" should be used here instead of \"Port\" to match the var name although it is at the beginning of a sentence. Sorry for not being clear in my previous comment.",
      "parentUuid": "8ad46028_46e1cadb",
      "range": {
        "startLine": 27,
        "startChar": 64,
        "endLine": 27,
        "endChar": 66
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c9f335a5_2aa94e1e",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/httpserver/httpserver.go",
        "patchSetId": 13
      },
      "lineNbr": 27,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-07T16:38:43Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7903a337_da26a734",
      "range": {
        "startLine": 27,
        "startChar": 64,
        "endLine": 27,
        "endChar": 66
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7f5ff90c_7c5b527b",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/virtualnet.go",
        "patchSetId": 13
      },
      "lineNbr": 38,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2022-07-02T03:04:20Z",
      "side": 1,
      "message": "We should avoid hardcoding anything IPv4-only.\n\nTo support well IPv4-only or IPv6-only or dual stack, I would suggest choosing one approach between:\n\na) if HTTPServer \u003d\u003d true \u0026\u0026 EnableDHCP \u003d\u003d true \u003d\u003e http server listen on \"0.0.0.0\" +  HTTPServer \u003d\u003d true \u0026\u0026 RAServer \u003d\u003d true \u003d\u003e http server listen on \"::\" (equivalent of 0.0.0.0 for IPv6). a) does not support http server with static IPv4 configuration.\n\nb) if HTTPServer \u003d\u003d true, http server listen both on \"0.0.0.0\" and \"::\" regardless of IP configuration. This supports http server with static IPv4 configuration.\n\nc) introduce two separate variables IPv4HTTPServer and IPv6HTTPServer. i.e in this patch you should rename HTTPServer to IPv4HTTPServer.\n\nTo listen over IPv6 you will need a separate instance of httpserver.New(). This is going to point out all the place in the code where hardcoding the fact of listening on IPv4 will not extend well to listening on both address families.",
      "range": {
        "startLine": 37,
        "startChar": 0,
        "endLine": 38,
        "endChar": 16
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5def689d_1cd42e64",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/virtualnet.go",
        "patchSetId": 13
      },
      "lineNbr": 38,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "It appears that the http.server will listen on ipv4 and ipv6 by default (http.ServeType \u003d tcp by default, which you can configure to tcp4 or tcp6 if you want only one address family). So by removing the host (or what I used as the IP), it should be listening on both address families.",
      "parentUuid": "7f5ff90c_7c5b527b",
      "range": {
        "startLine": 37,
        "startChar": 0,
        "endLine": 38,
        "endChar": 16
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "41d34c01_d22c2e76",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/virtualnet.go",
        "patchSetId": 13
      },
      "lineNbr": 39,
      "author": {
        "id": 1238096
      },
      "writtenOn": "2022-07-02T03:04:20Z",
      "side": 1,
      "message": "What does \"forcing an address\" means here concretely in term of traffic exchanged ? We should be more specific.",
      "range": {
        "startLine": 39,
        "startChar": 29,
        "endLine": 39,
        "endChar": 65
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e5720053_01c25223",
        "filename": "src/chromiumos/tast/local/bundles/cros/network/virtualnet/virtualnet.go",
        "patchSetId": 13
      },
      "lineNbr": 39,
      "author": {
        "id": 1530382
      },
      "writtenOn": "2022-07-06T21:00:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "41d34c01_d22c2e76",
      "range": {
        "startLine": 39,
        "startChar": 29,
        "endLine": 39,
        "endChar": 65
      },
      "revId": "3d590a0b56161a8b4d0d7fe2f6ac4e7892812723",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}