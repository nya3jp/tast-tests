{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "5a01d0c4_399202cf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2022-03-03T10:14:39Z",
      "side": 1,
      "message": "As an alternative approach, would it be possible to use the standard chrome/lacros fixture, possibly with additional cleanup code at the end of a subtest (if needed)?",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4de0025a_151278d8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2022-03-03T13:20:20Z",
      "side": 1,
      "message": "Eliot is working on a proposal to get rid of command line lacros execution, and I think that will help this CL significantly simplified.\n\nWDYT to put the effort together?",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc249d7b_2846599a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-03T17:34:03Z",
      "side": 1,
      "message": "Is there any doc or pointer to know more about what/how it\u0027s planning to solve? It\u0027s a bit difficult to say without knowing the detail, if it\u0027s for changing/simplifying the default way of launching lacros it would help with some parts but maybe not all in this CL.\n\nI think exposing common chrome options to outside of lacros fixture conditionally by checking vars and the structure of having a convenient util that launches lacros from shelf for use by tests in this CL may be still useful. Do you think it can just go in parallel with that effort?\n\nAside, given that a number of the tests are in this scenario, it would be nice to have one working solution sooner than later to increase test coverage with tight schedule. Please advise.",
      "parentUuid": "4de0025a_151278d8",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae52fa95_8568fa05",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-03T17:34:03Z",
      "side": 1,
      "message": "Not sure if I\u0027m quite following your point and how to address it in this CL. Did you mean making (all or part of) the fixture available for use directly in test body? Could you explain a bit further?",
      "parentUuid": "5a01d0c4_399202cf",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "85cc5780_5333f34c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-03T23:43:31Z",
      "side": 1,
      "message": "For cleaning up tests with no fixture, I was told that Tast is going to gracefully reset ash-chrome between tests to ensure fresh chrome restart by purging user data dir upon creation that also wipes out the one for lacros as well. Please correct me if I understood incorrectly.",
      "parentUuid": "ae52fa95_8568fa05",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0c3cb37_646db531",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1119597
      },
      "writtenOn": "2022-03-04T08:21:47Z",
      "side": 1,
      "message": "My understanding is that the existing holdingspace.Download test manually restarts Chrome in order to make sure the holding space (something related to where downloads end up) is clean. So I\u0027m wondering if we can\u0027t simply change the test to use the standard chromeLoggedIn fixture plus possibly some cleanup code at the end that resets this holding space (this is needed if chrome.ResetState doesn\u0027t already reset the holding space).\n\nIf that works, then we can easily add a Lacros variant by using the existing lacrosPrimary fixture.",
      "parentUuid": "85cc5780_5333f34c",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0ef52c35_853f06f0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1210707
      },
      "writtenOn": "2022-03-04T17:07:30Z",
      "side": 1,
      "message": "Holding space state is closely tied to file system state; a change to the file system in a previous test can prevent holdingspace.Download.* tests from beginning from first run state. That is why these tests intentionally clear cryptohome and do not use the chromeLoggedIn fixture",
      "parentUuid": "e0c3cb37_646db531",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "de672f86_55649948",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-04T18:46:03Z",
      "side": 1,
      "message": "Thanks David for clarifying that the fixture is not intended to be used in this test in order to explicitly ensure a fresh start.\n\nGeorg, I see your point that chromeLoggedIn fixture could be an alternative approach in similar scenarios. However, like this test (and a number of other tests), not all test writers may want extra fixtures and change test code more than necessary just to add a lacros variant.\n\nI believe this CL could address that concern by the new convenient util that encapsulates chrome.New and common lacros setup exposed from lacrosfixt.\n\nAll reviewers, is there anything we\u0027d need to address? Many other tests in the similar migration path can benefit from this.",
      "parentUuid": "0ef52c35_853f06f0",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c3f83d31_53ae2b8d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-04T18:46:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bc249d7b_2846599a",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9745779f_7792932f",
        "filename": "src/chromiumos/tast/local/chrome/lacros/lacrosfixt/setup.go",
        "patchSetId": 6
      },
      "lineNbr": 26,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2022-03-03T13:20:20Z",
      "side": 1,
      "message": "nit/style: let\u0027s use swtich to avoid createing unneeded array.",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3fc2f373_f08820d7",
        "filename": "src/chromiumos/tast/local/chrome/lacros/lacrosfixt/setup.go",
        "patchSetId": 6
      },
      "lineNbr": 26,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-03T17:34:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9745779f_7792932f",
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5fb13676_c484373c",
        "filename": "src/chromiumos/tast/local/chrome/lacros/lacrosfixt/util.go",
        "patchSetId": 6
      },
      "lineNbr": 75,
      "author": {
        "id": 1115919
      },
      "writtenOn": "2022-03-03T13:20:20Z",
      "side": 1,
      "message": "instead, could you pass values directly?",
      "range": {
        "startLine": 74,
        "startChar": 0,
        "endLine": 75,
        "endChar": 26
      },
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6d95d685_e036b0b6",
        "filename": "src/chromiumos/tast/local/chrome/lacros/lacrosfixt/util.go",
        "patchSetId": 6
      },
      "lineNbr": 75,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-03T17:34:03Z",
      "side": 1,
      "message": "IIUC will it leave some boilerplates in call site (eg, test or fixture)?\n\n```\n// boilerplate?\nif bt :\u003d browser.TypeLacros {\n  deployedPath, deployed :\u003d s.Var(LacrosDeployedBinary)\n  if mode \u003d\u003d External {\n    dataArtifactPath \u003d s.DataPath(dataArtifact)\n  }\n  vars :\u003d NewSetupVars(deployed, deployedPath, dataArtifactPath)\n}\n\ncr, br, ... :\u003d browserfixt.SetUpWithNewChrome(ctx, bt, vars, opts ...chrome.Option)\n```\n\nI have run into some situations where common utils can\u0027t be easily sharable between tests and fixtures just because they take *testing.FixtState or *testing.State. Is there any better way to address it with no boilerplate or are we good with this approach for now?",
      "parentUuid": "5fb13676_c484373c",
      "range": {
        "startLine": 74,
        "startChar": 0,
        "endLine": 75,
        "endChar": 26
      },
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d826416_72ca7e12",
        "filename": "src/chromiumos/tast/local/chrome/lacros/lacrosfixt/util.go",
        "patchSetId": 6
      },
      "lineNbr": 75,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-03T19:16:49Z",
      "side": 1,
      "message": "Posted another patchset to let `CheckVars` be the only one sharable between test and fixture that takes StateMixin interface arg in order to hide the boilerplate from test/fixture and support the scenario with no chrome/lacros fixture.\n\nI believe this will make it easier for us to revisit/refactor it when needed. Is it okay to move on with this for now?",
      "parentUuid": "6d95d685_e036b0b6",
      "range": {
        "startLine": 74,
        "startChar": 0,
        "endLine": 75,
        "endChar": 26
      },
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4ab118ea_804a929f",
        "filename": "src/chromiumos/tast/local/chrome/lacros/lacrosfixt/util.go",
        "patchSetId": 6
      },
      "lineNbr": 75,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-04T18:46:03Z",
      "side": 1,
      "message": "Resolving this. Please reopen if you think this is a blocker.",
      "parentUuid": "2d826416_72ca7e12",
      "range": {
        "startLine": 74,
        "startChar": 0,
        "endLine": 75,
        "endChar": 26
      },
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5a5f58b3_dcf68788",
        "filename": "src/chromiumos/tast/local/chrome/lacros/lacrosfixt/util.go",
        "patchSetId": 6
      },
      "lineNbr": 75,
      "author": {
        "id": 1507611
      },
      "writtenOn": "2022-03-09T19:41:18Z",
      "side": 1,
      "message": "Uploaded a new patchset to pass a struct var of LacrosConfig to SetUpWithNewChrome. PTAL.",
      "parentUuid": "4ab118ea_804a929f",
      "range": {
        "startLine": 74,
        "startChar": 0,
        "endLine": 75,
        "endChar": 26
      },
      "revId": "09c8515c606831e655b71c912f22b2ead60fce5d",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}