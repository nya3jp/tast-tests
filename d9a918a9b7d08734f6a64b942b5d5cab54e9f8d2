{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6419658d_069e5401",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 97,
      "author": {
        "id": 1000985
      },
      "writtenOn": "2021-08-25T20:41:13Z",
      "side": 1,
      "message": "This will cause flake if vm_concierge fails to start. I don\u0027t think we want to do this -- this test needs to be rock-solid.\n\nInstead this should be best effort -- if vm_concierge exists and it starts within one second or so, we should expect the mount, and if it exists but it doesn\u0027t start within one second, we should treat the mount existing as not an error.",
      "range": {
        "startLine": 92,
        "startChar": 0,
        "endLine": 97,
        "endChar": 2
      },
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52902d2e_2176d889",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 97,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2021-08-26T21:19:45Z",
      "side": 1,
      "message": "SGTM. The current behavior of the test is that if an expected mount is not found, it is logged but does not fail the test. In that case, we can add /run/arcvm to ARCExpectedSharedMountsCommon regardless of whether vm_concierge is present/running. \n\nI think we should still keep the WaitForJobStatus (with 1 second like you suggested) to make it less racy and catch the vm_concierge mounts more often.",
      "parentUuid": "6419658d_069e5401",
      "range": {
        "startLine": 92,
        "startChar": 0,
        "endLine": 97,
        "endChar": 2
      },
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "04e93706_27062531",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 97,
      "author": {
        "id": 1445173
      },
      "writtenOn": "2021-08-27T21:59:39Z",
      "side": 1,
      "message": "That SGTM.",
      "parentUuid": "52902d2e_2176d889",
      "range": {
        "startLine": 92,
        "startChar": 0,
        "endLine": 97,
        "endChar": 2
      },
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6d8c586a_888e0d7b",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 149,
      "author": {
        "id": 1445173
      },
      "writtenOn": "2021-08-25T21:23:59Z",
      "side": 1,
      "message": "Looks like /run/arc/media is also showing up (likely for the same reason?) so go ahead and add that too.",
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ca42e776_078a50ea",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 149,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2021-08-26T21:19:45Z",
      "side": 1,
      "message": "So I added a testing.Sleep(30s) call right before testBody to see what other mounts we might be missing because we check right after starting the guest session. In addition to /run/arc/media and /run/arcvm, I also see (from guest-shared_mounts.txt):\n\n  /run/arc/shared_mounts\n  /run/arc/sdcard\n  /run/arc/obb\n  /run/arc/adbd\n  \nThis kinda makes sense because most of these are created in ArcSetup::OnSetup, which IIUC is called before login [1] to set up the mini-container. I guess we should move these from ARCExpectedSharedMountsUser to ARCExpectedSharedMountsCommon.\n\nIt appears that ArcSetup::OnSetup usually doesn\u0027t finish before the guest session is started, so the test usually misses these mounts (which is probably why we haven\u0027t detected them until now). \n\nTo address this, should I add any sort of wait/sleep after starting the session but before we call testBody? It\u0027s not strictly necessary because the test won\u0027t fail if the mounts are expected but absent, but it would allow us to get a more accurate snapshot of the mounts on the system.\n\n[1] https://source.corp.google.com/chromeos_public/src/platform2/arc/setup/arc_setup.cc;rcl\u003d751b9acde5eafdffbc2acfb2df100bc38b9a3c9f;l\u003d1442",
      "parentUuid": "6d8c586a_888e0d7b",
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54b5ef94_faa5ed07",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 149,
      "author": {
        "id": 1445173
      },
      "writtenOn": "2021-08-27T21:59:39Z",
      "side": 1,
      "message": "Hmmm, I think that tast guidance tends to warn against using sleep in tests. Is there any way to have this check that ArcSetup has completed before calling the testBody?\n\nDefinitely adding the mounts to ARCExpectedSharedMountsCommon is the right move and I\u0027m guessing that ARCSetup also doesn\u0027t really need to happen in a guest session (in order to add to the other tracking bug for changing that that I created)?",
      "parentUuid": "ca42e776_078a50ea",
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b2d35c4_582ce17b",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 149,
      "author": {
        "id": 1000985
      },
      "writtenOn": "2021-08-27T22:55:09Z",
      "side": 1,
      "message": "No sleep in tests, for sure. We have mechanisms for waiting on conditions but those still require a timeout and therefore can still result in the test failing because of races.\n\nI would not conflate finding and fixing those paths with the objective of this CL. We can file a bug and track that separately.",
      "parentUuid": "54b5ef94_faa5ed07",
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "57f3b5db_35c2669b",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 149,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2021-08-31T19:45:02Z",
      "side": 1,
      "message": "Sounds good, I will just add the paths to ARCExpectedSharedMountsCommon.",
      "parentUuid": "3b2d35c4_582ce17b",
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4011d162_fb16bca0",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 170,
      "author": {
        "id": 1445173
      },
      "writtenOn": "2021-08-25T21:23:59Z",
      "side": 1,
      "message": "Remove this.",
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "53665416_19e65c0a",
        "filename": "src/chromiumos/tast/local/bundles/cros/security/shared_filesystem_state.go",
        "patchSetId": 2
      },
      "lineNbr": 170,
      "author": {
        "id": 1303273
      },
      "writtenOn": "2021-08-26T21:19:45Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4011d162_fb16bca0",
      "revId": "d9a918a9b7d08734f6a64b942b5d5cab54e9f8d2",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}