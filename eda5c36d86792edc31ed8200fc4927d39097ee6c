{
  "comments": [
    {
      "key": {
        "uuid": "f051e210_da48fc5d",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 2
      },
      "lineNbr": 179,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-05T15:13:32Z",
      "side": 1,
      "message": "nit:\n\nfor concistency, either use `ac.pkgName` or `ac.PackageName()` in both",
      "range": {
        "startLine": 179,
        "startChar": 52,
        "endLine": 179,
        "endChar": 59
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "54f71ce8_939b64a0",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 2
      },
      "lineNbr": 179,
      "author": {
        "id": 1195459
      },
      "writtenOn": "2020-06-09T07:09:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f051e210_da48fc5d",
      "range": {
        "startLine": 179,
        "startChar": 52,
        "endLine": 179,
        "endChar": 59
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "42c7025f_a482ed94",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 2
      },
      "lineNbr": 184,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-05T15:13:32Z",
      "side": 1,
      "message": "this could have an unwanted side-effect:\n\nStart:\nStart() activity starts an activity.\nAnd then waits until at least ONE window with the PackageName is visible.\nIf you launch a second activity (that belongs to that PackageName), WaitForVisible() will return true regardless of whether that window is visible (assuming the first activity is still visible).\n\nStop:\nIf you only have one activity, and you stop it, this CL will work Ok.\nHowever if you have two activities that belong to the same package, and you only want to stop one, Stop() will fail.\n\nThis is because the ash.Windows don\u0027t know about activities names, they only know about package names.\n(this is a long standing bug that we should fix).\n\n\nAFAIK, our tests are simple, and we are not launching more than one activity from the same package. But we shouldn\u0027t limit that. Or at least the API should be clear regarding what it does.\n\n\nOne possible solution is:\n\n  func Stop(...) error {\n     count \u003d numberOfWindowsWithPackageName(ac.PackageName())\n     Command(\"am force-stop\", ac.PackageName())\n     wait_until( numberOfWindowsWithPackageName()  \u003c count )\n  }",
      "range": {
        "startLine": 182,
        "startChar": 1,
        "endLine": 184,
        "endChar": 2
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8dd44e9a_bb5d2580",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 2
      },
      "lineNbr": 184,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-05T15:14:19Z",
      "side": 1,
      "message": "And if we do this, then we should fix Start() in a similar way",
      "parentUuid": "42c7025f_a482ed94",
      "range": {
        "startLine": 182,
        "startChar": 1,
        "endLine": 184,
        "endChar": 2
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5d8cfc40_8be32de3",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 2
      },
      "lineNbr": 184,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-05T17:59:06Z",
      "side": 1,
      "message": "Any my proposal might fail with race conditions (what if you decide to stop or start two activities at the same time (?)",
      "parentUuid": "8dd44e9a_bb5d2580",
      "range": {
        "startLine": 182,
        "startChar": 1,
        "endLine": 184,
        "endChar": 2
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d62e6aaf_05cabe53",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 2
      },
      "lineNbr": 184,
      "author": {
        "id": 1358595
      },
      "writtenOn": "2020-06-08T18:18:19Z",
      "side": 1,
      "message": "If this is meant to close all activities of a package(which I would say should be expected behavior given the use of package name), then maybe we should simply add \"am force-stop\" into the polling. Basically, poll that no windows are open for this package and if any are open, keep sending \"am force-stop\". I think this is a simple solution with a clear effect.\n\nIf we need to be able to close a single activity, maybe that would be best dealt with in a different method when the bug Ricardo mentioned is fixed?\n\nOtherwise, for Ricardo\u0027s solution, we need to also modify start to check the number of windows and ensure that the count goes up. That would make things always wait for synchronous state before moving on(note: that solution would still have race conditions if someone is using goroutines to start or stop multiple activities, but I have never seen this done in any test. If someone decides to do that, they can deal with the race condition in the specific goroutines.)",
      "parentUuid": "5d8cfc40_8be32de3",
      "range": {
        "startLine": 182,
        "startChar": 1,
        "endLine": 184,
        "endChar": 2
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7a1be6be_2d35160c",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 2
      },
      "lineNbr": 184,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-08T22:19:44Z",
      "side": 1,
      "message": "disregard my comment about Stop(). Brendan I correct.\nSince we are calling \"am force-stop package-name\", we don\u0027t need the activity name.\n\nMy comment about Start() is still valid, but it should not be addressed in this CL. Couldn\u0027t find the bug I was mentioning, I\u0027ll file a new one.",
      "parentUuid": "d62e6aaf_05cabe53",
      "range": {
        "startLine": 182,
        "startChar": 1,
        "endLine": 184,
        "endChar": 2
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8be316dd_e2015df3",
        "filename": "src/chromiumos/tast/local/arc/activity.go",
        "patchSetId": 2
      },
      "lineNbr": 184,
      "author": {
        "id": 1195459
      },
      "writtenOn": "2020-06-09T07:09:32Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "7a1be6be_2d35160c",
      "range": {
        "startLine": 182,
        "startChar": 1,
        "endLine": 184,
        "endChar": 2
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "363c36ce_a1275d7f",
        "filename": "src/chromiumos/tast/local/chrome/ash/wm.go",
        "patchSetId": 2
      },
      "lineNbr": 291,
      "author": {
        "id": 1202079
      },
      "writtenOn": "2020-06-05T15:13:32Z",
      "side": 1,
      "message": "nit:\n\"there is still a visible window\"  perhaps?",
      "range": {
        "startLine": 291,
        "startChar": 46,
        "endLine": 291,
        "endChar": 56
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d178c0d0_90db36d3",
        "filename": "src/chromiumos/tast/local/chrome/ash/wm.go",
        "patchSetId": 2
      },
      "lineNbr": 291,
      "author": {
        "id": 1195459
      },
      "writtenOn": "2020-06-09T07:09:32Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "363c36ce_a1275d7f",
      "range": {
        "startLine": 291,
        "startChar": 46,
        "endLine": 291,
        "endChar": 56
      },
      "revId": "eda5c36d86792edc31ed8200fc4927d39097ee6c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}