{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "c5a976a0_b6e80ce0",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/util/cross_version_login_data.go",
        "patchSetId": 1
      },
      "lineNbr": 82,
      "author": {
        "id": 1126309
      },
      "writtenOn": "2022-07-08T16:42:25Z",
      "side": 0,
      "message": "So I don\u0027t know if it was a hard requirement to write all the decompression code in vanilla Golang...\n\nFor this CL this code lacked the correct application of permissions, i.e., it created all files as root, which made it impossible for Chrome to work with /home/chronos/. While it could be possible to fix the code here accordingly, I just thought - why don\u0027t we just call \"tar\" that already implements all this.",
      "revId": "9d6cd629f47b4ce5c0bb208f431c877a11effa12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2e3bd202_ccef2591",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/util/cross_version_login_data.go",
        "patchSetId": 1
      },
      "lineNbr": 82,
      "author": {
        "id": 1391582
      },
      "writtenOn": "2022-07-11T09:18:46Z",
      "side": 0,
      "message": "Originally, the tast-test owner pefer not to depend on command line in general, so I write the compress/decompress with `archive/tar` package. Ideally, we should use archive/tar to handle compression, but we need to take care of many things (such as permissions, owners and selinux attributes) since the archive/tar only implement the fundamental part. I actually support to use `tar` command now, as long as the tast owner is okay with that.\n\nIf we are going to use command line `tar`, would you like to also change the compression part?",
      "parentUuid": "c5a976a0_b6e80ce0",
      "revId": "9d6cd629f47b4ce5c0bb208f431c877a11effa12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "76e6f0ba_378ef6fc",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/util/cross_version_login_data.go",
        "patchSetId": 1
      },
      "lineNbr": 82,
      "author": {
        "id": 1413373
      },
      "writtenOn": "2022-07-11T23:25:36Z",
      "side": 0,
      "message": "Yes the general guidance is to use the golang packages as much as possible. Idiomatic go is easier to follow then exec\u0027ing out to a utility. This generally helps with being more readable and understandable.\n\nI think in this case give nthe additional complexity required just to get the same functionality as `--preserve-permissions` I\u0027d be happy to CR+2. What I would ask is you break the command out to separate lines and comment each flag and what you\u0027re trying to achieve by using it, e.g.\n```\ntestexec.CommandContext(ctx, \"tar\"\n  \"--extract\", // Extracts the supplied source to stdout.\n  \"--gzip\",    // Use gzip to decode the archive whilst extracting.\n...\n}\n```",
      "parentUuid": "2e3bd202_ccef2591",
      "revId": "9d6cd629f47b4ce5c0bb208f431c877a11effa12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1318bd5b_db4a326d",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/util/cross_version_login_data.go",
        "patchSetId": 1
      },
      "lineNbr": 82,
      "author": {
        "id": 1126309
      },
      "writtenOn": "2022-07-12T03:13:46Z",
      "side": 0,
      "message": "Thanks for the insights and the guidance!\n\nAs a quick update, I realized I\u0027ll need to change the compression code to use the \"tar\" program as well, since there the vanilla Go code didn\u0027t store directory permissions in the archive. Without this, this chain CLs won\u0027t land: other tests, like security.StatefulFiles, start complaining about wrong permissions on /home/.shadow/. I suppose there are many other subtle cases, like symlinks, that the \"tar\" program just handles better.\n\nI think I\u0027m going to create another CL that will change the compression code to use \"tar\". I\u0027ll also need to regenerate all snapshots with that change, because without it \"untar\"ing old snapshots will corrupt permissions on /home/.shadow/.",
      "parentUuid": "76e6f0ba_378ef6fc",
      "revId": "9d6cd629f47b4ce5c0bb208f431c877a11effa12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1d93f42a_06370d73",
        "filename": "src/chromiumos/tast/local/bundles/cros/hwsec/util/cross_version_login_data.go",
        "patchSetId": 1
      },
      "lineNbr": 82,
      "author": {
        "id": 1126309
      },
      "writtenOn": "2022-07-12T14:57:18Z",
      "side": 0,
      "message": "Done (kept the \"tar\"-related changes in this CL, and will extract the \"/home/chronos\" part into a separate one)",
      "parentUuid": "1318bd5b_db4a326d",
      "revId": "9d6cd629f47b4ce5c0bb208f431c877a11effa12",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}