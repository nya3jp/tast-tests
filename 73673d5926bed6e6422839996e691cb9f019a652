{
  "comments": [
    {
      "key": {
        "uuid": "f28e3cef_29ec31a9",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 80,
      "author": {
        "id": 1136349
      },
      "writtenOn": "2020-06-15T13:49:59Z",
      "side": 1,
      "message": "this is renamed to SSID in crosreview.com/2237017",
      "range": {
        "startLine": 80,
        "startChar": 119,
        "endLine": 80,
        "endChar": 123
      },
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c4c070da_c57d939a",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 80,
      "author": {
        "id": 1373754
      },
      "writtenOn": "2020-06-15T21:15:43Z",
      "side": 1,
      "message": "Thanks :)",
      "parentUuid": "f28e3cef_29ec31a9",
      "range": {
        "startLine": 80,
        "startChar": 119,
        "endLine": 80,
        "endChar": 123
      },
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1d28f59b_73e5402a",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 80,
      "author": {
        "id": 1373754
      },
      "writtenOn": "2020-06-16T20:39:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c4c070da_c57d939a",
      "range": {
        "startLine": 80,
        "startChar": 119,
        "endLine": 80,
        "endChar": 123
      },
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3b2b2332_195409b5",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 89,
      "author": {
        "id": 1001853
      },
      "writtenOn": "2020-06-15T09:51:51Z",
      "side": 1,
      "message": "I think my question is not answered yet. (Please correct me if I missed something) My question was: what\u0027s the reason to perform a scan (and wait the scan finished) before kicking out the AP to perform the missing beacon test? \nFrom the issue https://crbug.com/199083, did it mean the previous scan result\u0027s cache may make wpa_supplicant think the disconnect AP is still there? Doesn\u0027t ConnectWifiAP also perform a scan to see the service in shill? What\u0027s the benefit of testing missing beacon with and without an  active scan after connect?\n\nAlso, you removed SetBgscan to none because of Matthew\u0027s comment. We have to make sure that the assumption, only one AP is scanned, holds when running the test. Otherwise, background scan could be set and the following TimedScan() could fail because of resource busy.",
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cf298bd3_645573f6",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 89,
      "author": {
        "id": 1243287
      },
      "writtenOn": "2020-06-15T20:29:32Z",
      "side": 1,
      "message": "AFAICT, the only reason to perform the scan is that it slightly delays the disconnect event, and we want to make sure it doesn\u0027t delay it too much. As I mentioned, I\u0027m not too convinced that we need it, but a) I\u0027m not confident in saying that it\u0027s definitely okay to kill, and b) it seems like it\u0027s not a big deal to keep around anyway. If you feel strongly that we should get rid of it, I\u0027m totally okay with that too.\n\nRe bgscan: note that bgscan isn\u0027t set when there\u0027s one AP on the SSID we\u0027re connecting to (not one AP in all of the scan results). We only configure one AP, so it definitely won\u0027t be set.",
      "parentUuid": "3b2b2332_195409b5",
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f3b716bd_de98657f",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 89,
      "author": {
        "id": 1373754
      },
      "writtenOn": "2020-06-15T21:15:43Z",
      "side": 1,
      "message": "Looking at the history of the test, (From https://bugs.chromium.org/p/chromium/issues/detail?id\u003d199083 and https://chromium-review.googlesource.com/c/chromiumos/third_party/hostap/+/7437/) the reason to do a scan is that a scan result\u0027s could keep the status of the AP as \"ready\" instead of \"idle\", if the AP has disappered.\n\nAlso, I agree with Matthew a scan would delay the disconnection time but not significanlty, because the test waits for 20 sec. \n\nI am okay with removing the scan or keeping it with a TODO.",
      "parentUuid": "cf298bd3_645573f6",
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "430fc7c6_10a7e53a",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 89,
      "author": {
        "id": 1373754
      },
      "writtenOn": "2020-06-15T22:17:27Z",
      "side": 1,
      "message": "I asked the test owner Paul Stewart about the reason for the scan and he said that \"We\u0027re trying to make sure that the system as a whole doesn\u0027t some sort of dependency on the scan interval for it to detect that the AP is gone.  You do one manually to try to push whatever scan interval is programmed into supplicant / client to successfully see the AP to give ourselves the \"worst case scenario\" for a system that may possibly depend on the scan interval to notice the AP going away.\n\nAnything that behaved differently based on the scan would be horribly broken, but hopefully you\u0027ve noticed by now that some really interesting stuff can happen with WiFi driviers / code.\"",
      "parentUuid": "f3b716bd_de98657f",
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "edc112f1_1077875f",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 89,
      "author": {
        "id": 1243287
      },
      "writtenOn": "2020-06-15T22:41:11Z",
      "side": 1,
      "message": "I just came to the same conclusion, but you beat me to the punch ðŸ˜Š. More specifically, stale scan results can cause wpa_supplicant to attempt to fast-reconnect to an AP even if it is no longer available. The purpose of the scan is to ensure that the AP is definitely in the scan results before the disconnect and subsequent fast-reconnect happens. When the next scan is triggered (because the client is attempting to connect), we expect the AP, which is no longer up and thus should no longer be in the scan results, to be purged from the results. The functionality to purge all scan results older than the most recent scan request time for fast-reconnect was added in this patch: https://chromium-review.googlesource.com/c/chromiumos/third_party/hostap/+/7437/.\n\nIn this case, I think there is value to continue verifying this behavior, with a couple additions/modifications:\n1. Clearly, it\u0027s not obvious why the scan happens, so there needs to be a comment explaining it.\n2. We should be parsing the result of the iw scan and verifying that the AP does indeed appear in the results.",
      "parentUuid": "430fc7c6_10a7e53a",
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d6d9dac5_66b712b8",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 89,
      "author": {
        "id": 1001853
      },
      "writtenOn": "2020-06-16T06:11:44Z",
      "side": 1,
      "message": "Thanks Arowa and Matthew to explain the reason to add the active scan. Arowa, please update the comment to summarize the review comment thread.\n\nAlso, please address why we don\u0027t need to stop bgscan: because bgscan isn\u0027t set when there\u0027s one AP on the SSID we\u0027re connecting to.",
      "parentUuid": "edc112f1_1077875f",
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "055ff4e9_11a90a6c",
        "filename": "src/chromiumos/tast/remote/bundles/cros/wifi/missing_beacons.go",
        "patchSetId": 15
      },
      "lineNbr": 89,
      "author": {
        "id": 1373754
      },
      "writtenOn": "2020-06-16T20:39:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d6d9dac5_66b712b8",
      "revId": "73673d5926bed6e6422839996e691cb9f019a652",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}